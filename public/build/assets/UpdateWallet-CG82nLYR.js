import{u as B,r as v,c as E,A,q as P,s as V,a as r,b as T,d as M,h as L,w as R,e as s,k as g,x,o as n,t as u,z as q,i as H,m as G,F as D,j as J,n as C}from"./app-DxfmXC0O.js";import{_ as K}from"./AdminLayout-B6Je0JR7.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},X={class:"text-lg font-bold text-slate-800 drop-shadow-sm mb-4"},Y={key:0,class:"block text-base font-medium text-slate-700"},Z={key:0,class:"ml-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 inline-flex items-center justify-center"},ee={key:1,class:"text-sm font-medium text-slate-600"},te={key:1,class:"mb-6 p-4 rounded-xl bg-red-100/80 border border-red-200 text-red-700 text-sm flex items-center gap-2 backdrop-blur-sm"},se={key:2,class:"mb-6"},ae={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/30"},oe={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},le={class:"text-lg font-semibold text-slate-800"},re={class:"text-lg font-semibold text-slate-800"},ne={class:"mt-4 flex flex-wrap gap-3"},de=["disabled"],ie=["disabled"],ue=["disabled"],ce=["disabled"],pe={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-white/30"},me={class:"overflow-x-auto"},ve={class:"w-full"},fe={class:"p-4 align-top"},ge={key:0,class:"text-slate-500 text-sm"},he={key:1,class:"space-y-3"},be={class:"flex items-start"},xe={key:0,class:"mr-3"},_e=["href"],we=["src"],ye={key:1,class:"mr-3 text-gray-500 text-xs"},ke={class:"flex-1"},Ue={class:"flex items-center gap-2"},Se={class:"text-sm font-medium text-slate-700"},Fe={key:0,class:"inline-flex items-center px-2 py-0.5 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full"},De={key:1,class:"ml-2 text-xs text-slate-600 italic"},Ce={class:"text-sm text-slate-700"},$e={class:"text-sm text-slate-700"},ze={class:"mt-2 flex justify-end gap-2"},Ie={key:0,class:"text-green-600 text-xs font-semibold"},Ne={key:1,class:"text-red-600 text-xs font-semibold"},Ee=["onClick"],Te=["onClick"],We={__name:"UpdateWallet",props:{deposits:{type:Array,default:()=>[]},selectedUserId:{type:[String,Number],default:null},balance:{type:[Number,String],default:0},frozen_balance:{type:[Number,String],default:0},userName:{type:String,default:null},mobile_number:{type:String,default:null}},setup(_){const i=_,f=B(),p=v([...i.deposits]),w=v(parseFloat(i.balance)||0),U=v(parseFloat(i.frozen_balance)||0),S=v(i.userName),F=v(i.mobile_number),d=v(""),l=v(""),$=E(()=>p.value.filter(a=>a.status==="pending").length),h=v(""),b=v(""),W=E(()=>({"bg-green-100 border-green-500 text-green-700":b.value==="success","bg-red-100 border-red-500 text-red-700":b.value==="error"}));A(()=>f.props.flash,a=>{a.success?(h.value=a.success,b.value="success"):a.error?(h.value=a.error,b.value="error"):(h.value="",b.value=""),h.value&&setTimeout(()=>{h.value="",f.props.flash.success&&(f.props.flash.success=null),f.props.flash.error&&(f.props.flash.error=null)},2e3)},{deep:!0});const m=async()=>{if(i.selectedUserId)try{const a=await fetch(`/admin/update-wallet?user_id=${i.selectedUserId}`,{headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);const e=await a.json();p.value=e.deposits||[],w.value=parseFloat(e.balance)||0,U.value=parseFloat(e.frozen_balance)||0,S.value=e.userName||"Unknown",F.value=e.mobile_number||"Unknown",l.value=""}catch(a){l.value=`Failed to fetch wallet data: ${a.message}. Please try again.`,setTimeout(()=>l.value="",5e3)}};P(()=>{m(),console.log("[UpdateWallet] Component mounted for user:",i.selectedUserId);const a=()=>{if(!window.Echo){console.log("[UpdateWallet] Echo not ready, waiting..."),setTimeout(a,100);return}if(!i.selectedUserId){console.log("[UpdateWallet] No user selected, skipping Echo setup");return}console.log("[UpdateWallet] Echo ready, setting up listeners"),window.Echo.channel("deposits").listen("DepositCreated",e=>{var t;console.log("[UpdateWallet] ✅ DepositCreated event received:",e),(t=e==null?void 0:e.deposit)!=null&&t.user_id&&String(e.deposit.user_id)===String(i.selectedUserId)&&(console.log("[UpdateWallet] Deposit is for current user, fetching data"),m())}).listen("DepositStatusUpdated",e=>{var t;if(console.log("[UpdateWallet] ✅ DepositStatusUpdated event received:",e),(t=e==null?void 0:e.deposit)!=null&&t.user_id&&String(e.deposit.user_id)===String(i.selectedUserId)){console.log("[UpdateWallet] Status update is for current user");const o=p.value.findIndex(c=>c.id===e.deposit.id);o!==-1&&(p.value[o].status=e.deposit.status,p.value=[...p.value]),m()}}),console.log("[UpdateWallet] Deposit channel listeners attached")};a()}),V(()=>{window.Echo&&window.Echo.leaveChannel("deposits")});const z=async(a,e)=>{if(e==="approve"){const t=p.value.find(o=>o.id===a);if(!t){l.value="Deposit not found.",setTimeout(()=>l.value="",3e3);return}try{const o=await fetch(`https://api.coinbase.com/v2/exchange-rates?currency=${t.symbol}`);if(!o.ok)throw new Error(`Failed to fetch exchange rate: ${o.status}`);const c=await o.json();if(!c.data||!c.data.rates||!c.data.rates.USDT)throw new Error("Invalid exchange rate data received");const I=parseFloat(c.data.rates.USDT),j=parseFloat(t.amount)*I;C.post(`/admin/update-deposit/${a}`,{action:e,converted_amount:j,original_amount:t.amount,symbol:t.symbol,exchange_rate:I,_token:f.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m()},onError:k=>{var N;if(k&&((N=k.message)!=null&&N.includes("419")||k.status===419)){window.location.reload();return}l.value=k.action||"Failed to approve deposit.",setTimeout(()=>l.value="",5e3),m()}})}catch(o){l.value=`Failed to get exchange rate: ${o.message}. Please try again.`,setTimeout(()=>l.value="",5e3);return}}else C.post(`/admin/update-deposit/${a}`,{action:e,_token:f.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m()},onError:t=>{var o;if(t&&((o=t.message)!=null&&o.includes("419")||t.status===419)){window.location.reload();return}l.value=t.action||"Failed to update deposit status.",setTimeout(()=>l.value="",5e3),m()}})},y=a=>{const e=parseFloat(d.value);if(isNaN(e)||e<=0){l.value="Please enter a valid amount greater than 0.",setTimeout(()=>l.value="",3e3);return}let t;a==="freeze"?t=route("admin.freeze-balance",i.selectedUserId):a==="unfreeze"?t=route("admin.unfreeze-balance",i.selectedUserId):t=`/admin/update-balance/${i.selectedUserId}`,C.post(t,{amount:e,action:a==="freeze"||a==="unfreeze"?"subtract":a,_token:f.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m(),d.value="",l.value=""},onError:o=>{var c;if(o&&((c=o.message)!=null&&c.includes("419")||o.status===419)){window.location.reload();return}l.value=o.error||o.amount||o.action||"Failed to update balance. Please check the server configuration.",setTimeout(()=>l.value="",5e3),m()}})};return(a,e)=>(n(),r(D,null,[T(M(L),{title:"Update Wallet"}),T(K,null,{default:R(()=>[s("div",Q,[s("h1",X,[e[5]||(e[5]=x(" Update Wallet ",-1)),_.selectedUserId&&S.value?(n(),r("span",Y,[x(" for "+u(S.value)+" ",1),$.value>0?(n(),r("span",Z,u($.value),1)):g("",!0)])):g("",!0),_.selectedUserId&&F.value?(n(),r("span",ee," Mobile: "+u(F.value),1)):g("",!0)]),h.value?(n(),r("div",{key:0,class:q([W.value,"mb-6 p-4 rounded-xl bg-green-100/80 border border-green-200 text-green-700 text-sm flex items-center gap-2 backdrop-blur-sm"])},u(h.value),3)):g("",!0),l.value?(n(),r("div",te,u(l.value),1)):g("",!0),_.selectedUserId?(n(),r("div",se,[s("div",ae,[s("div",oe,[s("div",null,[e[6]||(e[6]=s("p",{class:"text-sm font-medium text-slate-700"},"User Balance",-1)),s("p",le,"$"+u(w.value.toFixed(2)),1)]),s("div",null,[e[7]||(e[7]=s("p",{class:"text-sm font-medium text-slate-700"},"Frozen Balance",-1)),s("p",re,"$"+u(U.value.toFixed(2)),1)])]),H(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),type:"number",step:"0.01",min:"0.01",placeholder:"Enter amount",class:"mt-4 w-full max-w-md h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[G,d.value]]),s("div",ne,[s("button",{onClick:e[1]||(e[1]=t=>y("add")),class:"px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0}," Add ",8,de),s("button",{onClick:e[2]||(e[2]=t=>y("subtract")),class:"px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0||w.value<parseFloat(d.value)}," Subtract ",8,ie),s("button",{onClick:e[3]||(e[3]=t=>y("freeze")),class:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0||w.value<parseFloat(d.value)}," Freeze Balance ",8,ue),s("button",{onClick:e[4]||(e[4]=t=>y("unfreeze")),class:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0||U.value<parseFloat(d.value)}," Unfreeze Balance ",8,ce)])])])):g("",!0),s("div",pe,[s("div",me,[s("table",ve,[e[11]||(e[11]=s("thead",null,[s("tr",{class:"bg-white/20 text-slate-700 text-sm font-medium"},[s("th",{class:"p-4 text-left"},"Deposits")])],-1)),s("tbody",null,[s("tr",null,[s("td",fe,[p.value.length===0?(n(),r("div",ge,"No deposits")):(n(),r("div",he,[(n(!0),r(D,null,J(p.value,t=>{var o;return n(),r("div",{key:t.id,class:"bg-white/30 backdrop-blur-sm rounded-xl p-3 border border-white/30 shadow-lg"},[s("div",be,[t.slip_path?(n(),r("div",xe,[s("a",{href:"/storage/"+t.slip_path,target:"_blank"},[s("img",{src:"/storage/"+t.slip_path,alt:"Deposit Slip",class:"w-10 h-10 object-cover rounded"},null,8,we)],8,_e)])):(n(),r("div",ye,"No Image")),s("div",ke,[s("div",Ue,[s("div",Se,[e[8]||(e[8]=s("strong",null,"User:",-1)),x(" "+u(((o=t.user)==null?void 0:o.name)||"Unknown"),1)]),t.vip_level||t.title&&t.title.toLowerCase().includes("vip")?(n(),r("span",Fe," VIP Purchase ")):g("",!0),t.title?(n(),r("span",De,u(t.title),1)):g("",!0)]),s("div",Ce,[e[9]||(e[9]=s("strong",null,"Amount:",-1)),x(" "+u(t.amount)+" "+u(t.symbol),1)]),s("div",$e,[e[10]||(e[10]=s("strong",null,"Date:",-1)),x(" "+u(new Date(t.created_at).toLocaleString()),1)]),s("div",ze,[t.status==="approved"?(n(),r("span",Ie,"Approved")):t.status==="rejected"?(n(),r("span",Ne,"Rejected")):(n(),r(D,{key:2},[s("button",{onClick:c=>z(t.id,"approve"),class:"px-3 py-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg text-xs font-medium transition-all duration-200 shadow-lg"},"Approve",8,Ee),s("button",{onClick:c=>z(t.id,"reject"),class:"px-3 py-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg text-xs font-medium transition-all duration-200 shadow-lg"},"Reject",8,Te)],64))])])])])}),128))]))])])])])])])])]),_:1})],64))}},Pe=O(We,[["__scopeId","data-v-51850d60"]]);export{Pe as default};
