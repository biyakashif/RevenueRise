import{u as Z,c as U,r as p,A as N,p as k,x as ee,E as te,q as se,w as B,b as z,e,d as M,h as oe,a as g,m as S,t,y as A,l as ae,H as le,o as f,s as q,T as re,F as ne}from"./app-Dx7yjGw8.js";import{_ as ie}from"./AuthenticatedLayout-Coka9h_U.js";import{l as de}from"./lodash-C2qnWkmd.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"h-full bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-3 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 flex flex-col"},me={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-3 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 mb-3 sm:mb-6"},ve={class:"flex items-center justify-between mb-2 sm:mb-3"},xe={class:"text-base sm:text-xl font-bold text-slate-800 drop-shadow-sm"},pe={class:"inline-block mt-1 px-2 py-0.5 rounded-full bg-gradient-to-r from-emerald-400/80 to-green-400/80 text-white text-[10px] sm:text-xs font-semibold shadow-sm"},fe={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm p-2 sm:p-3 rounded-xl shadow-lg border border-white/30"},_e={class:"flex items-center justify-between gap-2"},he={class:"flex-1 space-y-1"},be={class:"flex justify-between items-center"},ge={class:"text-[10px] sm:text-xs text-slate-600 font-medium"},ye={class:"text-xs sm:text-sm font-bold text-slate-800"},we={class:"flex justify-between items-center"},ke={class:"text-[10px] sm:text-xs text-slate-600 font-medium"},Se={class:"text-xs sm:text-sm font-bold text-slate-800"},Te={class:"flex justify-between items-center"},Ce={class:"text-[10px] sm:text-xs text-slate-600 font-medium"},je={class:"text-xs sm:text-sm font-bold text-slate-800"},Pe={class:"text-[9px] sm:text-[10px] text-blue-600 font-semibold text-center leading-tight"},Me={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-3 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 mb-3 sm:mb-6"},Oe={class:"flex justify-between items-center mb-2"},Ee={class:"text-xs sm:text-sm font-semibold text-slate-800 drop-shadow-sm"},Fe={class:"text-xs sm:text-sm font-bold text-slate-700 bg-white/30 px-2 py-0.5 rounded-full backdrop-blur-sm"},De={class:"w-full h-2 sm:h-3 bg-white/20 rounded-full overflow-hidden backdrop-blur-sm"},Ie={key:0,class:"flex-1 bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-3 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl mb-0 flex flex-col justify-center"},Ue={class:"text-center mb-3"},Ne={class:"text-base sm:text-xl font-bold text-slate-800 drop-shadow-sm mb-1"},Be={key:0,class:"text-[10px] sm:text-xs text-red-600 font-medium text-center mb-1"},ze={class:"text-xs sm:text-sm text-slate-600 font-medium"},Ae={class:"flex flex-col sm:flex-row justify-center items-center gap-2 sm:gap-4 min-h-[120px] sm:min-h-[80px]"},Ve={class:"bg-white/20 backdrop-blur-sm p-2 sm:p-3 rounded-xl"},Re={class:"text-[10px] sm:text-xs text-slate-600 font-medium text-center"},He={class:"text-sm sm:text-lg font-bold text-slate-800 text-center"},Le={class:"flex-1 flex items-center justify-center"},Ge={key:0,class:"bg-gradient-to-r from-emerald-400/20 to-green-400/20 backdrop-blur-sm text-emerald-700 p-3 sm:p-4 rounded-xl text-xs sm:text-sm font-medium text-center shadow-lg max-w-xs"},Je=["aria-busy","disabled"],$e={key:0,class:"animate-spin h-3 w-3 sm:h-4 sm:w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},qe={class:"bg-white/20 backdrop-blur-sm p-2 sm:p-3 rounded-xl"},We={class:"text-[10px] sm:text-xs text-slate-600 font-medium text-center"},Xe={class:"text-sm sm:text-lg font-bold text-slate-800 text-center"},Ke={key:1,class:"flex-1 bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 text-center mb-0 flex items-center justify-center"},Qe={class:"text-xs sm:text-sm text-slate-600 font-medium"},Ye={key:0,class:"fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50 p-4 pb-20 sm:pb-4"},Ze={class:"bg-gradient-to-br from-slate-800/95 via-blue-900/95 to-indigo-900/95 backdrop-blur-xl rounded-3xl shadow-2xl max-w-sm w-full max-h-[90vh] overflow-y-auto animate-scale border border-cyan-300/20"},et={class:"bg-gradient-to-r from-cyan-400/60 via-blue-500/50 to-indigo-600/60 text-white p-4 rounded-t-3xl backdrop-blur-sm"},tt={class:"text-sm font-semibold text-center"},st={class:"p-4"},ot={class:"mb-3 text-xs"},at={class:"flex justify-between mb-1"},lt={class:"text-slate-300"},rt={class:"font-semibold text-white"},nt={class:"flex justify-between mb-1"},it={class:"text-slate-300"},dt={class:"font-semibold text-white"},ut={class:"flex justify-between"},ct={key:0,class:"text-red-400 font-medium w-full text-center"},mt={class:"text-slate-300"},vt={class:"font-semibold text-emerald-400"},xt={class:"mb-3"},pt={class:"flex items-start justify-between"},ft={class:"flex items-start"},_t=["src","alt"],ht={class:"flex-1"},bt={class:"text-xs font-semibold mb-1 text-white"},gt={class:"text-[10px] text-slate-300 mb-1 leading-tight"},yt={class:"text-xs font-bold text-cyan-400"},wt={class:"text-xs space-y-1"},kt={class:"flex justify-between"},St={class:"text-slate-300"},Tt={class:"font-semibold text-white"},Ct={class:"flex justify-between"},jt={class:"text-slate-300"},Pt={class:"font-semibold text-white"},Mt={class:"flex justify-between"},Ot={class:"text-slate-300"},Et={class:"font-semibold text-emerald-400"},Ft={class:"bg-gradient-to-r from-slate-700/50 to-blue-800/50 p-4 rounded-b-3xl backdrop-blur-sm"},Dt=["disabled"],It={__name:"Orders",props:{user:{type:Object,default:()=>({balance:0,frozen_balance:0,todays_profit:0,vip_level:"VIP1"})},tasks:{type:Array,default:()=>[]},taskTotalCount:{type:Number,default:0},confirmedCount:{type:Number,default:0},flash:{type:Object,default:()=>({})}},setup(_){const i=_,V=Z(),W=U(()=>V.props.translations||{}),r=s=>W.value[s]||s,d=p(""),y=p(""),O=p(i.user.order_reward??0),R=["Ebay","Walmart","Etsy","Shopify","Alibaba","Aliexpress","Amazon"],E=p(""),X=()=>R[Math.floor(Math.random()*R.length)],F=()=>{E.value=X()};N(()=>i.user.order_reward,s=>{typeof s=="number"&&(O.value=s)}),N(()=>i.flash,s=>{s.error&&!m.value&&(d.value=s.error,setTimeout(()=>d.value="",5e3))},{deep:!0});const H=s=>{if(!Array.isArray(s)||s.length===0)return null;const o=s.map(a=>{const l=a.product??null;return l&&typeof l=="object"?{id:l.id??l.product_id??a.product_id??null,product_id:l.product_id??l.id??a.product_id??null,title:l.title??"",description:l.description??"",purchase_price:l.purchase_price??0,selling_price:l.selling_price??0,commission_reward:l.commission_reward??0,commission_percentage:l.commission_percentage??0,image_path:l.image_path??"",type:l.type??a.product_type??"",status:a.status??"confirmed",is_forced:l.is_forced??!1}:{id:a.product_id??a.id??null,product_id:a.product_id??null,title:a.title??"",description:a.description??"",purchase_price:a.purchase_price??0,selling_price:a.selling_price??0,commission_reward:a.commission_reward??0,commission_percentage:a.commission_percentage??0,image_path:a.image_path??"",type:a.product_type??"",status:a.status??"confirmed",is_forced:a.is_forced??!1}}).filter(a=>a&&a.id!=null);return o.length===0?null:{name:s[0].name||(i.user.vip_level??"Task"),products:o}},n=p(H(i.tasks)),h=p(i.confirmedCount||0),v=p(i.taskTotalCount||0),m=p(!1),w=p(!1),c=p(!1),T=p(h.value||0),x=p(null),u=U(()=>{if(x.value)return x.value;if(n.value&&Array.isArray(n.value.products)&&n.value.products.length){const s=Math.min(Math.max(0,T.value),n.value.products.length-1);return n.value.products[s]}return null}),K=U(()=>h.value>=v.value&&v.value>0),L=()=>{var o;const s=localStorage.getItem("luckyOrderModalState");if(s)try{const a=JSON.parse(s);((o=a.modalProduct)==null?void 0:o.type)==="Lucky Order"?(x.value=a.modalProduct,m.value=!0):C()}catch{C()}},D=s=>{(s==null?void 0:s.type)==="Lucky Order"&&localStorage.setItem("luckyOrderModalState",JSON.stringify({modalProduct:s}))},C=()=>{localStorage.removeItem("luckyOrderModalState"),x.value=null,m.value=!1,y.value="",E.value=""},G=de.debounce(()=>{if(c.value||!n.value||!n.value.products||n.value.products.length===0||T.value>=n.value.products.length||m.value){d.value="No tasks available or action in progress.",setTimeout(()=>d.value="",3e3);return}c.value=!0,k.reload({only:["tasks","taskTotalCount","confirmedCount","user","flash"],preserveState:!0,preserveScroll:!0,onSuccess:s=>{j();const o=n.value.products[T.value];if(!o){d.value=r("Failed to sync the current task. Please try again."),setTimeout(()=>d.value="",4e3),c.value=!1;return}if(o.status==="pending"){x.value=o,D(x.value),F(),m.value=!0,c.value=!1;return}const a=o.id;k.post(route("orders.check-balance"),{product_id:a,task_name:n.value.name,is_forced:o.is_forced,_token:s.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:l=>{var b,P,J,$;if((P=(b=l.props)==null?void 0:b.flash)!=null&&P.success)k.reload({only:["user","tasks","taskTotalCount","confirmedCount","flash"],preserveState:!0,onSuccess:()=>{j(),x.value=n.value.products[T.value],D(x.value),F(),m.value=!0,c.value=!1},onError:()=>{d.value="Failed to refresh data after reservation.",setTimeout(()=>d.value="",4e3),c.value=!1}});else{const Y=(($=(J=l.props)==null?void 0:J.flash)==null?void 0:$.error)||"Failed to reserve order.";d.value=Y,setTimeout(()=>d.value="",4e3),c.value=!1}},onError:l=>{const b=(l==null?void 0:l.message)||"Failed to grab order";d.value=b,setTimeout(()=>d.value="",4e3),c.value=!1}})},onError:()=>{d.value=r("Failed to sync with server. Please try again."),setTimeout(()=>d.value="",4e3),c.value=!1}})},500),Q=()=>{!u.value||!n.value||w.value||(w.value=!0,k.post(route("orders.store"),{product_id:u.value.id??u.value.product_id,task_name:n.value.name,is_forced:u.value.is_forced,_token:V.props.csrf_token},{preserveScroll:!0,onSuccess:s=>{var o,a,l,b;(a=(o=s.props)==null?void 0:o.flash)!=null&&a.success?(m.value=!1,C(),x.value=null,k.reload({only:["tasks","taskTotalCount","confirmedCount","user","flash"],preserveScroll:!0,onSuccess:()=>j()})):(b=(l=s.props)==null?void 0:l.flash)!=null&&b.error&&(y.value=s.props.flash.error,setTimeout(()=>y.value="",4e3))},onError:s=>{y.value=(s==null?void 0:s.message)||r("Error saving order. Please try again."),setTimeout(()=>y.value="",4e3)},onFinish:()=>{w.value=!1}}))},j=()=>{var s,o,a,l;if(n.value=H(i.tasks),v.value=i.taskTotalCount||0,h.value=i.confirmedCount||0,T.value=Math.min(h.value,((o=(s=n.value)==null?void 0:s.products)==null?void 0:o.length)-1||0),typeof((a=i.user)==null?void 0:a.order_reward)=="number"&&(O.value=i.user.order_reward),h.value>=v.value&&v.value>0&&(m.value=!1,x.value=null,C()),n.value&&n.value.products){const b=n.value.products.find(P=>P.type==="Lucky Order"&&P.status==="pending");b?(x.value=b,D(x.value),F(),m.value=!0):((l=i.user)==null?void 0:l.balance)>=0&&!y.value&&C()}};let I=null;return ee(()=>{if(L(),j(),window.Echo&&i.user&&i.user.id)try{window.Echo.private(`orders.${i.user.id}`).listen("UserProgressReset",()=>{k.reload({only:["tasks","taskTotalCount","confirmedCount","user"],preserveState:!0,preserveScroll:!0})}).error(s=>{console.error("Echo error:",s)})}catch(s){console.error("Echo setup error:",s)}I=setInterval(()=>{!w.value&&!c.value&&!m.value&&!K.value&&k.reload({only:["tasks","taskTotalCount","confirmedCount","user"],preserveState:!0,preserveScroll:!0})},5e3)}),te(()=>{I&&clearInterval(I)}),N(()=>[i.tasks,i.taskTotalCount,i.confirmedCount,i.user,i.flash],()=>{j(),L()},{deep:!0,immediate:!0}),(s,o)=>(f(),se(ie,null,{default:B(()=>[z(M(oe),{title:r("My Orders")},null,8,["title"]),e("div",ce,[e("div",me,[e("div",ve,[e("div",null,[e("h1",xe,t(r("Hi"))+", "+t(_.user.name||r("User")),1),e("p",pe,t(_.user.vip_level),1)])]),e("div",fe,[e("div",_e,[e("div",he,[e("div",be,[e("p",ge,t(r("Total Balance")),1),e("p",ye,[A(t((_.user.balance||0).toFixed(2))+" ",1),o[1]||(o[1]=e("span",{class:"text-[9px] sm:text-xs text-slate-500"},"USDT",-1))])]),e("div",we,[e("p",ke,t(r("Frozen Balance")),1),e("p",Se,[A(t(Number(_.user.frozen_balance??0).toFixed(2))+" ",1),o[2]||(o[2]=e("span",{class:"text-[9px] sm:text-xs text-slate-500"},"USDT",-1))])]),e("div",Te,[e("p",Ce,t(r("Today's Profit")),1),e("p",je,[A(t((_.user.todays_profit||0).toFixed(2))+" ",1),o[3]||(o[3]=e("span",{class:"text-[9px] sm:text-xs text-slate-500"},"USDT",-1))])])]),z(M(ae),{href:"/balance/records",class:"flex-shrink-0 flex flex-col items-center justify-center px-2 py-1 hover:bg-white/20 rounded-lg transition-all"},{default:B(()=>[o[4]||(o[4]=e("svg",{class:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600 mb-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)),e("p",Pe,t(r("Details")),1)]),_:1})])])]),e("div",Me,[e("div",Oe,[e("h3",Ee,t(r("Today's Progress")),1),e("span",Fe,t(h.value)+"/"+t(v.value),1)]),e("div",De,[e("div",{class:"h-full bg-gradient-to-r from-emerald-400 to-green-500 transition-all duration-500 shadow-sm",style:le({width:v.value>0?h.value/v.value*100+"%":"0%"})},null,4)])]),n.value&&n.value.products&&n.value.products.length?(f(),g("div",Ie,[e("div",Ue,[e("h2",Ne,t(r("Order Task Set")),1),d.value?(f(),g("p",Be,t(d.value),1)):S("",!0),e("p",ze,t(n.value.name),1)]),e("div",Ae,[e("div",Ve,[e("p",Re,t(r("Progress")),1),e("p",He,t(h.value)+"/"+t(v.value),1)]),e("div",Le,[h.value>=v.value&&v.value>0?(f(),g("div",Ge,t(r("Congratulations you have done your today's task, your next task will be updated after midnight")),1)):(f(),g("button",{key:1,onClick:o[0]||(o[0]=(...a)=>M(G)&&M(G)(...a)),class:q(["px-10 py-2 sm:px-12 sm:py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl text-s sm:text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl flex items-center gap-2",{"opacity-70 cursor-not-allowed":c.value||w.value||m.value}]),"aria-busy":c.value,disabled:n.value.products.length===0||c.value||w.value||m.value},[c.value?(f(),g("svg",$e,[...o[5]||(o[5]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"},null,-1)])])):S("",!0),e("span",null,t(r("Grab Orders")),1)],10,Je))]),e("div",qe,[e("p",We,t(r("Reward")),1),e("p",Xe,t((_.user.order_reward&&_.user.order_reward>0?_.user.order_reward:O.value).toFixed(2))+" USDT",1)])])])):S("",!0),v.value?S("",!0):(f(),g("div",Ke,[e("p",Qe,t(r("No tasks available for your VIP level")),1)]))]),z(re,{name:"fade",mode:"out-in"},{default:B(()=>[m.value&&u.value?(f(),g("div",Ye,[e("div",Ze,[e("div",et,[e("h3",tt,t(E.value)+" - Order ("+t(u.value.commission_percentage)+"%)",1)]),e("div",st,[e("div",ot,[e("div",at,[e("span",lt,t(r("Order number:")),1),e("span",rt,"# "+t(h.value+1),1)]),e("div",nt,[e("span",it,t(r("Received Date:")),1),e("span",dt,t(new Date().toISOString().split("T")[0]),1)]),e("div",ut,[y.value?(f(),g("span",ct,t(y.value),1)):(f(),g(ne,{key:1},[e("span",mt,t(r("Balance:")),1),e("span",vt,t((_.user.balance||0).toFixed(2))+" USDT",1)],64))])]),o[7]||(o[7]=e("div",{class:"border-t border-cyan-300/30 my-3"},null,-1)),e("div",xt,[e("div",pt,[e("div",ft,[u.value.image_path?(f(),g("img",{key:0,src:"/storage/"+u.value.image_path,alt:u.value.title,class:"w-16 h-16 rounded-lg mr-3 shadow-lg border border-cyan-300/20",style:{"object-fit":"fill",width:"4rem",height:"4rem"}},null,8,_t)):S("",!0),e("div",ht,[e("h4",bt,t(u.value.title),1),e("p",gt,t(u.value.description),1),e("div",yt,t(u.value.selling_price)+" USDT",1)])]),o[6]||(o[6]=e("div",{class:"text-[10px] text-slate-400 font-medium"},"X 1",-1))])]),o[8]||(o[8]=e("div",{class:"border-t border-cyan-300/30 my-3"},null,-1)),e("div",wt,[e("div",kt,[e("span",St,t(r("Purchase Price")),1),e("span",Tt,t(u.value.purchase_price)+" USDT",1)]),e("div",Ct,[e("span",jt,t(r("Selling Price")),1),e("span",Pt,t(u.value.selling_price)+" USDT",1)]),e("div",Mt,[e("span",Ot,t(r("Commission"))+" ("+t(u.value.commission_percentage)+"%)",1),e("span",Et,t(u.value.commission_reward)+" USDT",1)])])]),e("div",Ft,[e("button",{onClick:Q,class:q(["w-full h-10 rounded-xl bg-gradient-to-r from-cyan-400/70 via-blue-500/60 to-indigo-600/70 hover:from-cyan-500/80 hover:via-blue-600/70 hover:to-indigo-700/80 text-white font-semibold text-sm transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl backdrop-blur-sm",{"opacity-50 cursor-not-allowed":w.value}]),disabled:w.value},t(r("Confirm")),11,Dt)])])])):S("",!0)]),_:1})]),_:1}))}},At=ue(It,[["__scopeId","data-v-e033f2a0"]]);export{At as default};
