import{u as H,r as c,c as K,q as W,E as Q,p as G,w as Y,e as t,a as u,k as m,i as C,m as S,o as d,t as r,F as U,j as P,y as F,n as R}from"./app-DNboHIQE.js";import{_ as Z}from"./AdminLayout-AN5kJ0Dn.js";const ee={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},te={class:"mb-6"},se={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},oe={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl rounded-2xl p-6 w-full max-w-md mx-4 border border-white/20 shadow-2xl"},le={class:"text-lg font-semibold mb-4 text-white text-center"},ae={class:"mb-4"},re={class:"mb-4"},ne={key:1,class:"mb-4 p-4 rounded-xl bg-green-100/80 border border-green-200 text-green-700 text-sm text-center backdrop-blur-sm"},ie={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-white/30"},de={class:"overflow-x-auto"},ue={class:"w-full"},ce={class:"p-4 text-sm text-slate-800 font-medium"},me={class:"p-4 text-sm text-slate-700"},pe={class:"p-4 text-sm text-slate-700"},ve={class:"p-4"},he={class:"flex flex-wrap gap-2"},be=["onClick","disabled"],fe=["onClick"],ge=["onClick"],xe=["onClick"],we={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},_e={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl rounded-2xl p-6 w-full max-w-md mx-4 border border-white/20 shadow-2xl overflow-y-auto max-h-[90vh]"},ke={class:"text-lg font-semibold mb-4 text-white text-center"},ye={key:0,class:"text-center text-white/70"},Te={key:1,class:"space-y-3 mb-6"},Ce=["src"],Se={class:"flex-1"},Ee={class:"font-semibold text-sm text-white"},Oe={class:"text-xs text-white/70 mb-1"},Le={class:"flex gap-2 text-xs"},Ne={class:"text-green-300"},$e={class:"text-blue-300"},Me={class:"text-xs text-white/50 ml-2"},Ae={key:0,class:"ml-2 bg-green-500 text-white px-2 py-1 rounded text-xs"},je=["onClick"],Ve={__name:"TaskManager",setup(Ue){const p=H(),k=p.props.users,n=c([]),f=c(!1),i=c(null),l=c("");let y=null;const w=c(""),V=K(()=>{if(!k)return[];if(!w.value)return k;const s=w.value.toLowerCase();return k.filter(e=>e.name&&e.name.toLowerCase().includes(s)||e.vip_level&&e.vip_level.toLowerCase().includes(s)||e.mobile_number&&e.mobile_number.includes(s))});function q(s){E(),y=setInterval(()=>{fetch(`/admin/tasks/${s}`).then(e=>e.json()).then(e=>{n.value=e.tasks,i.value=e.user})},2e3)}function E(){y&&clearInterval(y)}async function O(s){const a=await(await fetch(`/admin/tasks/${s}`)).json();n.value=a.tasks,i.value=a.user,f.value=!0,q(s)}function B(){f.value=!1,i.value=null,n.value=[],E()}function X(s,e){R.post(`/admin/tasks/${e}/replace/${s}`,{_token:p.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{O(e)},onError:a=>{var x;if(a&&((x=a.message)!=null&&x.includes("419")||a.status===419)){window.location.reload();return}console.error("Error replacing task:",a),alert("Failed to replace task. See console for details.")}})}async function D(s){try{const e=await fetch(`/admin/tasks/${s}/reset`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p.props.csrf_token,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({})});if(!e.ok){if(e.status===419){window.location.reload();return}throw new Error("Failed to reset tasks")}l.value="Tasks reset and reassigned successfully!",setTimeout(()=>{l.value=""},1e3)}catch(e){l.value="Error: "+e.message,setTimeout(()=>{l.value=""},2e3)}}const v=c(new Set(p.props.assignedUserIds||[]));function I(s){if(v.value.has(s.id)){l.value="Tasks already assigned to this user. Delete tasks first to reassign.",setTimeout(()=>{l.value=""},2e3);return}h.value=s,T.value=!0}async function z(){if(!h.value||g.value<=0){alert("Please enter valid inputs.");return}try{R.post("/admin/tasks/assign",{userId:h.value.id,tasksNumber:g.value,luckyOrder:_.value,_token:p.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{l.value="Tasks assigned successfully!",v.value.add(h.value.id),setTimeout(()=>{l.value=""},1e3),L()},onError:s=>{var e;if(s&&((e=s.message)!=null&&e.includes("419")||s.status===419)){window.location.reload();return}l.value="Error: "+(s?JSON.stringify(s):"Unknown error"),setTimeout(()=>{l.value=""},2e3)}})}catch(s){l.value="Error: "+s.message,setTimeout(()=>{l.value=""},2e3)}}async function J(s){try{const e=await fetch(`/admin/tasks/${s}/delete`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":p.props.csrf_token,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({})});if(!e.ok){if(e.status===419){window.location.reload();return}throw new Error("Failed to delete tasks")}l.value="Tasks deleted successfully!",v.value.delete(s),setTimeout(()=>{l.value=""},1e3),f.value=!1,n.value=[],i.value=null}catch(e){l.value="Error: "+e.message,setTimeout(()=>{l.value=""},2e3)}}const T=c(!1),h=c(null),g=c(0),_=c(0);function L(){T.value=!1,h.value=null,g.value=0,_.value=0}return W(()=>{window.Echo&&window.Echo.channel("admin.orders").listen(".OrderConfirmed",s=>{if(f.value&&i.value&&s.order.user_id===i.value.id){const e=n.value.findIndex(a=>a.product_id===s.order.product_id);e!==-1&&(n.value[e].status="confirmed")}}),i.value&&Q.private(`orders.${i.value.id}`).listen("OrderConfirmed",s=>{const e=n.value.find(a=>a.id===s.order.task_id);e&&(e.status="Success")})}),(s,e)=>(d(),G(Z,null,{default:Y(()=>{var a,x,N;return[t("div",ee,[e[6]||(e[6]=t("h1",{class:"text-lg font-bold text-slate-800 drop-shadow-sm mb-4"},"Task Manager",-1)),t("div",te,[C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),type:"text",placeholder:"Search by name, mobile, or VIP level...",class:"w-full h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[S,w.value]])]),T.value?(d(),u("div",se,[t("div",oe,[t("h2",le,"Assign Tasks to "+r((a=h.value)==null?void 0:a.name),1),t("div",ae,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-white mb-2"},"Enter Tasks Number",-1)),C(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>g.value=o),type:"number",class:"w-full h-10 rounded-lg bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-3 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[S,g.value]])]),t("div",re,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-white mb-2"},"Enter Lucky Order",-1)),C(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>_.value=o),type:"number",class:"w-full h-10 rounded-lg bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-3 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[S,_.value]])]),t("div",{class:"flex space-x-2"},[t("button",{onClick:L,class:"flex-1 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-lg text-sm hover:bg-white/30 text-white border border-white/30"}," Cancel "),t("button",{onClick:z,class:"flex-1 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded text-sm hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200"}," Assign ")])])])):m("",!0),l.value?(d(),u("div",ne,r(l.value),1)):m("",!0),t("div",ie,[t("div",de,[t("table",ue,[e[5]||(e[5]=t("thead",null,[t("tr",{class:"bg-white/20 text-slate-700 text-sm font-medium"},[t("th",{class:"p-4 text-left"},"Name"),t("th",{class:"p-4 text-left"},"Mobile Number"),t("th",{class:"p-4 text-left"},"VIP Level"),t("th",{class:"p-4 text-left"},"Actions")])],-1)),t("tbody",null,[(d(!0),u(U,null,P(V.value,o=>(d(),u("tr",{key:o.id,class:"border-t border-white/20 hover:bg-white/10 transition-all duration-200"},[t("td",ce,r(o.name),1),t("td",me,r(o.mobile_number),1),t("td",pe,r(o.vip_level),1),t("td",ve,[t("div",he,[t("button",{onClick:b=>I(o),disabled:v.value.has(o.id),class:F([v.value.has(o.id)?"from-gray-400 to-gray-500":"from-green-500 to-green-600 hover:from-green-600 hover:to-green-700","bg-gradient-to-r text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"])},r(v.value.has(o.id)?"Assigned":"Assign Tasks"),11,be),t("button",{onClick:b=>O(o.id),class:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"},"Tasks Details",8,fe),t("button",{onClick:b=>D(o.id),class:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"},"Reset Task",8,ge),t("button",{onClick:b=>J(o.id),class:"bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"},"Delete Tasks",8,xe)])])]))),128))])])])])]),f.value?(d(),u("div",we,[t("div",_e,[t("h2",ke," Tasks for "+r((x=i.value)==null?void 0:x.name)+" ("+r((N=i.value)==null?void 0:N.vip_level)+") ",1),n.value&&n.value.length===0?(d(),u("div",ye,"No tasks assigned.")):m("",!0),n.value&&n.value.length>0?(d(),u("ul",Te,[(d(!0),u(U,null,P(n.value,o=>{var b,$,M,A,j;return d(),u("li",{key:o.id,class:F(["flex items-center rounded-lg p-3 shadow-sm backdrop-blur-sm border border-white/20",o.product_type==="Lucky Order"?"bg-yellow-100/20":"bg-white/10"])},[t("img",{src:(b=o.product)!=null&&b.image_path?"/storage/"+o.product.image_path:"/default-product.png",alt:"Product",class:"w-10 h-10 object-cover rounded mr-3 border border-white/30"},null,8,Ce),t("div",Se,[t("div",Ee,r(($=o.product)==null?void 0:$.title),1),t("div",Oe,r(o.product_type),1),t("div",Le,[t("span",Ne,"Buy: "+r((M=o.product)==null?void 0:M.purchase_price),1),t("span",$e,"Sell: "+r((A=o.product)==null?void 0:A.selling_price),1)])]),t("div",Me,"#"+r(o.position),1),o.status&&o.status.toString().trim().toLowerCase()==="confirmed"?(d(),u("span",Ae," Confirmed ")):m("",!0),o.product_type!=="Lucky Order"&&o.status!=="confirmed"&&((j=i.value)!=null&&j.id)?(d(),u("button",{key:1,onClick:Pe=>X(o.id,i.value.id),class:"ml-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-2 py-1 rounded text-xs hover:from-blue-600 hover:to-blue-700 transition-all duration-200"}," Apply L/O ",8,je)):m("",!0)],2)}),128))])):m("",!0),t("button",{onClick:B,class:"w-full px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded text-sm hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition-all duration-200"},"Close")])])):m("",!0)]}),_:1}))}};export{Ve as default};
