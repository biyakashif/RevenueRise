import{u as se,c as M,r as m,A as B,n as k,q as oe,K as ae,p as le,w as O,b as E,e,d as F,h as re,a as h,k as S,t,x as A,l as ne,H as ie,o as f,z as q,T as K,F as de}from"./app-DFWQC0QO.js";import{_ as ue}from"./AuthenticatedLayout-CqNIPwpL.js";import{l as ce}from"./lodash-BCxPTgNJ.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={class:"h-full bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-3 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 flex flex-col"},ve={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-3 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 mb-3 sm:mb-6"},pe={class:"flex items-center justify-between mb-2 sm:mb-3"},fe={class:"text-base sm:text-xl font-bold text-slate-800 drop-shadow-sm"},he={class:"inline-block mt-1 px-2 py-0.5 rounded-full bg-gradient-to-r from-emerald-400/80 to-green-400/80 text-white text-[10px] sm:text-xs font-semibold shadow-sm"},_e={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm p-2 sm:p-3 rounded-xl shadow-lg border border-white/30"},be={class:"flex items-center justify-between gap-2"},ge={class:"flex-1 space-y-1"},ye={class:"flex justify-between items-center"},we={class:"text-[10px] sm:text-xs text-slate-600 font-medium"},ke={class:"text-xs sm:text-sm font-bold text-slate-800"},Se={class:"flex justify-between items-center"},Te={class:"text-[10px] sm:text-xs text-slate-600 font-medium"},Ce={class:"text-xs sm:text-sm font-bold text-slate-800"},Pe={class:"flex justify-between items-center"},je={class:"text-[10px] sm:text-xs text-slate-600 font-medium"},Me={class:"text-xs sm:text-sm font-bold text-slate-800"},Oe={class:"text-[9px] sm:text-[10px] text-blue-600 font-semibold text-center leading-tight"},Ee={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-3 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 mb-3 sm:mb-6"},Fe={class:"flex justify-between items-center mb-2"},Ie={class:"text-xs sm:text-sm font-semibold text-slate-800 drop-shadow-sm"},De={class:"text-xs sm:text-sm font-bold text-slate-700 bg-white/30 px-2 py-0.5 rounded-full backdrop-blur-sm"},Ne={class:"w-full h-2 sm:h-3 bg-white/20 rounded-full overflow-hidden backdrop-blur-sm"},Ue={key:0,class:"flex-1 bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-3 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl mb-0 flex flex-col justify-center"},ze={class:"text-center mb-3"},Be={class:"text-base sm:text-xl font-bold text-slate-800 drop-shadow-sm mb-1"},Ae={key:0,class:"text-[10px] sm:text-xs text-red-600 font-medium text-center mb-1"},Ve={class:"text-xs sm:text-sm text-slate-600 font-medium"},Re={class:"flex flex-col sm:flex-row justify-center items-center gap-2 sm:gap-4 min-h-[120px] sm:min-h-[80px]"},He={class:"bg-white/20 backdrop-blur-sm p-2 sm:p-3 rounded-xl"},Le={class:"text-[10px] sm:text-xs text-slate-600 font-medium text-center"},Ge={class:"text-sm sm:text-lg font-bold text-slate-800 text-center"},Je={class:"flex-1 flex items-center justify-center"},$e={key:0,class:"bg-gradient-to-r from-emerald-400/20 to-green-400/20 backdrop-blur-sm text-emerald-700 p-3 sm:p-4 rounded-xl text-xs sm:text-sm font-medium text-center shadow-lg max-w-xs"},qe=["aria-busy","disabled"],Ke={key:0,class:"animate-spin h-3 w-3 sm:h-4 sm:w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},We={class:"bg-white/20 backdrop-blur-sm p-2 sm:p-3 rounded-xl"},Xe={class:"text-[10px] sm:text-xs text-slate-600 font-medium text-center"},Qe={class:"text-sm sm:text-lg font-bold text-slate-800 text-center"},Ye={key:1,class:"flex-1 bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 text-center mb-0 flex items-center justify-center"},Ze={class:"text-xs sm:text-sm text-slate-600 font-medium"},et={key:0,class:"fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50 p-4 pb-20 sm:pb-4"},tt={class:"bg-gradient-to-br from-slate-800/95 via-blue-900/95 to-indigo-900/95 backdrop-blur-xl rounded-3xl shadow-2xl max-w-sm w-full max-h-[90vh] overflow-y-auto animate-scale border border-cyan-300/20"},st={class:"bg-gradient-to-r from-cyan-400/60 via-blue-500/50 to-indigo-600/60 text-white p-4 rounded-t-3xl backdrop-blur-sm"},ot={class:"text-sm font-semibold text-center"},at={class:"p-4"},lt={class:"mb-3 text-xs"},rt={class:"flex justify-between mb-1"},nt={class:"text-slate-300"},it={class:"font-semibold text-white"},dt={class:"flex justify-between mb-1"},ut={class:"text-slate-300"},ct={class:"font-semibold text-white"},mt={class:"flex justify-between"},xt={key:0,class:"text-red-400 font-medium w-full text-center"},vt={class:"text-slate-300"},pt={class:"font-semibold text-emerald-400"},ft={class:"mb-3"},ht={class:"flex items-start justify-between"},_t={class:"flex items-start"},bt=["src","alt"],gt={class:"flex-1"},yt={class:"text-xs font-semibold mb-1 text-white"},wt={class:"text-[10px] text-slate-300 mb-1 leading-tight"},kt={class:"text-xs font-bold text-cyan-400"},St={class:"text-xs space-y-1"},Tt={class:"flex justify-between"},Ct={class:"text-slate-300"},Pt={class:"font-semibold text-white"},jt={class:"flex justify-between"},Mt={class:"text-slate-300"},Ot={class:"font-semibold text-white"},Et={class:"flex justify-between"},Ft={class:"text-slate-300"},It={class:"font-semibold text-emerald-400"},Dt={class:"bg-gradient-to-r from-slate-700/50 to-blue-800/50 p-4 rounded-b-3xl backdrop-blur-sm"},Nt=["disabled"],Ut={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},zt={class:"bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl p-6 max-w-sm w-full text-center border border-white/40"},Bt={class:"text-slate-700 font-medium mb-2"},At={class:"text-xs text-slate-500"},Vt={__name:"Orders",props:{products:{type:Array,default:()=>[]},currentProductIndex:{type:Number,default:0},user:{type:Object,default:()=>({balance:0,frozen_balance:0,todays_profit:0,vip_level:"VIP1"})},tasks:{type:Array,default:()=>[]},taskTotalCount:{type:Number,default:0},confirmedCount:{type:Number,default:0},flash:{type:Object,default:()=>({})}},setup(_){const i=_,V=se(),W=M(()=>V.props.translations||{}),r=s=>W.value[s]||s,d=m(""),X=m(""),y=m(""),I=m(i.user.order_reward??0),R=["Ebay","Walmart","Etsy","Shopify","Alibaba","Aliexpress","Amazon"],D=m(""),Q=()=>R[Math.floor(Math.random()*R.length)],N=()=>{D.value=Q()};B(()=>i.user.order_reward,s=>{typeof s=="number"&&(I.value=s)}),B(()=>i.flash,s=>{s.error&&!x.value&&(d.value=s.error,setTimeout(()=>d.value="",5e3))},{deep:!0});const H=s=>{if(!Array.isArray(s)||s.length===0)return null;const o=s.map(a=>{const l=a.product??null;return l&&typeof l=="object"?{id:l.id??l.product_id??a.product_id??null,product_id:l.product_id??l.id??a.product_id??null,title:l.title??"",description:l.description??"",purchase_price:l.purchase_price??0,selling_price:l.selling_price??0,commission_reward:l.commission_reward??0,commission_percentage:l.commission_percentage??0,image_path:l.image_path??"",type:l.type??a.product_type??"",status:a.status??"confirmed",is_forced:l.is_forced??!1}:{id:a.product_id??a.id??null,product_id:a.product_id??null,title:a.title??"",description:a.description??"",purchase_price:a.purchase_price??0,selling_price:a.selling_price??0,commission_reward:a.commission_reward??0,commission_percentage:a.commission_percentage??0,image_path:a.image_path??"",type:a.product_type??"",status:a.status??"confirmed",is_forced:a.is_forced??!1}}).filter(a=>a&&a.id!=null);return o.length===0?null:{name:s[0].name||(i.user.vip_level??"Task"),products:o}};m(i.currentProductIndex);const n=m(H(i.tasks)),b=m(i.confirmedCount||0),v=m(i.taskTotalCount||0),Y=M(()=>!1),x=m(!1),w=m(!1),c=m(!1),T=m(b.value||0),p=m(null),u=M(()=>{if(p.value)return p.value;if(n.value&&Array.isArray(n.value.products)&&n.value.products.length){const s=Math.min(Math.max(0,T.value),n.value.products.length-1);return n.value.products[s]}return null}),Z=M(()=>b.value>=v.value&&v.value>0),L=()=>{var o;const s=localStorage.getItem("luckyOrderModalState");if(s)try{const a=JSON.parse(s);((o=a.modalProduct)==null?void 0:o.type)==="Lucky Order"?(p.value=a.modalProduct,x.value=!0):C()}catch{C()}},U=s=>{(s==null?void 0:s.type)==="Lucky Order"&&localStorage.setItem("luckyOrderModalState",JSON.stringify({modalProduct:s}))},C=()=>{localStorage.removeItem("luckyOrderModalState"),p.value=null,x.value=!1,y.value="",D.value=""},G=ce.debounce(()=>{if(c.value||!n.value||!n.value.products||n.value.products.length===0||T.value>=n.value.products.length||x.value){d.value="No tasks available or action in progress.",setTimeout(()=>d.value="",3e3);return}c.value=!0,k.reload({only:["tasks","taskTotalCount","confirmedCount","user","flash"],preserveState:!0,preserveScroll:!0,onSuccess:s=>{P();const o=n.value.products[T.value];if(!o){d.value=r("Failed to sync the current task. Please try again."),setTimeout(()=>d.value="",4e3),c.value=!1;return}if(o.status==="pending"){p.value=o,U(p.value),N(),x.value=!0,c.value=!1;return}const a=o.id;k.post(route("orders.check-balance"),{product_id:a,task_name:n.value.name,is_forced:o.is_forced,_token:s.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:l=>{var g,j,J,$;if((j=(g=l.props)==null?void 0:g.flash)!=null&&j.success)k.reload({only:["user","tasks","taskTotalCount","confirmedCount","flash"],preserveState:!0,onSuccess:()=>{P(),p.value=n.value.products[T.value],U(p.value),N(),x.value=!0,c.value=!1},onError:()=>{d.value="Failed to refresh data after reservation.",setTimeout(()=>d.value="",4e3),c.value=!1}});else{const te=(($=(J=l.props)==null?void 0:J.flash)==null?void 0:$.error)||"Failed to reserve order.";d.value=te,setTimeout(()=>d.value="",4e3),c.value=!1}},onError:l=>{const g=(l==null?void 0:l.message)||"Failed to grab order";d.value=g,setTimeout(()=>d.value="",4e3),c.value=!1}})},onError:()=>{d.value=r("Failed to sync with server. Please try again."),setTimeout(()=>d.value="",4e3),c.value=!1}})},500),ee=()=>{!u.value||!n.value||w.value||(w.value=!0,k.post(route("orders.store"),{product_id:u.value.id??u.value.product_id,task_name:n.value.name,is_forced:u.value.is_forced,_token:V.props.csrf_token},{preserveScroll:!0,onSuccess:s=>{var o,a,l,g;(a=(o=s.props)==null?void 0:o.flash)!=null&&a.success?(x.value=!1,C(),p.value=null,k.reload({only:["tasks","taskTotalCount","confirmedCount","user","flash"],preserveScroll:!0,onSuccess:()=>P()})):(g=(l=s.props)==null?void 0:l.flash)!=null&&g.error&&(y.value=s.props.flash.error,setTimeout(()=>y.value="",4e3))},onError:s=>{y.value=(s==null?void 0:s.message)||r("Error saving order. Please try again."),setTimeout(()=>y.value="",4e3)},onFinish:()=>{w.value=!1}}))},P=()=>{var s,o,a,l;if(n.value=H(i.tasks),v.value=i.taskTotalCount||0,b.value=i.confirmedCount||0,T.value=Math.min(b.value,((o=(s=n.value)==null?void 0:s.products)==null?void 0:o.length)-1||0),typeof((a=i.user)==null?void 0:a.order_reward)=="number"&&(I.value=i.user.order_reward),b.value>=v.value&&v.value>0&&(X.value="Congratulations you have done your today's task, your next task will be updated after midnight",x.value=!1,p.value=null,C()),n.value&&n.value.products){const g=n.value.products.find(j=>j.type==="Lucky Order"&&j.status==="pending");g?(p.value=g,U(p.value),N(),x.value=!0):((l=i.user)==null?void 0:l.balance)>=0&&!y.value&&C()}};let z=null;return oe(()=>{if(L(),P(),window.Echo&&i.user&&i.user.id)try{window.Echo.private(`orders.${i.user.id}`).listen("UserProgressReset",()=>{k.reload({only:["tasks","taskTotalCount","confirmedCount","user"],preserveState:!0,preserveScroll:!0})}).error(s=>{console.error("Echo error:",s)})}catch(s){console.error("Echo setup error:",s)}z=setInterval(()=>{!w.value&&!c.value&&!x.value&&!Z.value&&k.reload({only:["tasks","taskTotalCount","confirmedCount","user"],preserveState:!0,preserveScroll:!0})},5e3)}),ae(()=>{z&&clearInterval(z)}),B(()=>[i.tasks,i.taskTotalCount,i.confirmedCount,i.user,i.flash],()=>{P(),L()},{deep:!0,immediate:!0}),(s,o)=>(f(),le(ue,null,{default:O(()=>[E(F(re),{title:r("My Orders")},null,8,["title"]),e("div",xe,[e("div",ve,[e("div",pe,[e("div",null,[e("h1",fe,t(r("Hi"))+", "+t(_.user.name||r("User")),1),e("p",he,t(_.user.vip_level),1)])]),e("div",_e,[e("div",be,[e("div",ge,[e("div",ye,[e("p",we,t(r("Total Balance")),1),e("p",ke,[A(t((_.user.balance||0).toFixed(2))+" ",1),o[1]||(o[1]=e("span",{class:"text-[9px] sm:text-xs text-slate-500"},"USDT",-1))])]),e("div",Se,[e("p",Te,t(r("Frozen Balance")),1),e("p",Ce,[A(t(Number(_.user.frozen_balance??0).toFixed(2))+" ",1),o[2]||(o[2]=e("span",{class:"text-[9px] sm:text-xs text-slate-500"},"USDT",-1))])]),e("div",Pe,[e("p",je,t(r("Today's Profit")),1),e("p",Me,[A(t((_.user.todays_profit||0).toFixed(2))+" ",1),o[3]||(o[3]=e("span",{class:"text-[9px] sm:text-xs text-slate-500"},"USDT",-1))])])]),E(F(ne),{href:"/balance/records",class:"flex-shrink-0 flex flex-col items-center justify-center px-2 py-1 hover:bg-white/20 rounded-lg transition-all"},{default:O(()=>[o[4]||(o[4]=e("svg",{class:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600 mb-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)),e("p",Oe,t(r("Details")),1)]),_:1})])])]),e("div",Ee,[e("div",Fe,[e("h3",Ie,t(r("Today's Progress")),1),e("span",De,t(b.value)+"/"+t(v.value),1)]),e("div",Ne,[e("div",{class:"h-full bg-gradient-to-r from-emerald-400 to-green-500 transition-all duration-500 shadow-sm",style:ie({width:v.value>0?b.value/v.value*100+"%":"0%"})},null,4)])]),n.value&&n.value.products&&n.value.products.length?(f(),h("div",Ue,[e("div",ze,[e("h2",Be,t(r("Order Task Set")),1),d.value?(f(),h("p",Ae,t(d.value),1)):S("",!0),e("p",Ve,t(n.value.name),1)]),e("div",Re,[e("div",He,[e("p",Le,t(r("Progress")),1),e("p",Ge,t(b.value)+"/"+t(v.value),1)]),e("div",Je,[b.value>=v.value&&v.value>0?(f(),h("div",$e,t(r("Congratulations you have done your today's task, your next task will be updated after midnight")),1)):(f(),h("button",{key:1,onClick:o[0]||(o[0]=(...a)=>F(G)&&F(G)(...a)),class:q(["px-4 py-2 sm:px-6 sm:py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl text-xs sm:text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl flex items-center gap-2",{"opacity-70 cursor-not-allowed":c.value||w.value||x.value}]),"aria-busy":c.value,disabled:n.value.products.length===0||c.value||w.value||x.value},[c.value?(f(),h("svg",Ke,[...o[5]||(o[5]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"},null,-1)])])):S("",!0),e("span",null,t(r("Grab Orders")),1)],10,qe))]),e("div",We,[e("p",Xe,t(r("Reward")),1),e("p",Qe,t((_.user.order_reward&&_.user.order_reward>0?_.user.order_reward:I.value).toFixed(2))+" USDT",1)])])])):S("",!0),v.value?S("",!0):(f(),h("div",Ye,[e("p",Ze,t(r("No tasks available for your VIP level")),1)]))]),E(K,{name:"fade",mode:"out-in"},{default:O(()=>[x.value&&u.value?(f(),h("div",et,[e("div",tt,[e("div",st,[e("h3",ot,t(D.value)+" - Order ("+t(u.value.commission_percentage)+"%)",1)]),e("div",at,[e("div",lt,[e("div",rt,[e("span",nt,t(r("Order number:")),1),e("span",it,"# "+t(b.value+1),1)]),e("div",dt,[e("span",ut,t(r("Received Date:")),1),e("span",ct,t(new Date().toISOString().split("T")[0]),1)]),e("div",mt,[y.value?(f(),h("span",xt,t(y.value),1)):(f(),h(de,{key:1},[e("span",vt,t(r("Balance:")),1),e("span",pt,t((_.user.balance||0).toFixed(2))+" USDT",1)],64))])]),o[7]||(o[7]=e("div",{class:"border-t border-cyan-300/30 my-3"},null,-1)),e("div",ft,[e("div",ht,[e("div",_t,[u.value.image_path?(f(),h("img",{key:0,src:"/storage/"+u.value.image_path,alt:u.value.title,class:"w-16 h-16 rounded-lg mr-3 shadow-lg border border-cyan-300/20",style:{"object-fit":"fill",width:"4rem",height:"4rem"}},null,8,bt)):S("",!0),e("div",gt,[e("h4",yt,t(u.value.title),1),e("p",wt,t(u.value.description),1),e("div",kt,t(u.value.selling_price)+" USDT",1)])]),o[6]||(o[6]=e("div",{class:"text-[10px] text-slate-400 font-medium"},"X 1",-1))])]),o[8]||(o[8]=e("div",{class:"border-t border-cyan-300/30 my-3"},null,-1)),e("div",St,[e("div",Tt,[e("span",Ct,t(r("Purchase Price")),1),e("span",Pt,t(u.value.purchase_price)+" USDT",1)]),e("div",jt,[e("span",Mt,t(r("Selling Price")),1),e("span",Ot,t(u.value.selling_price)+" USDT",1)]),e("div",Et,[e("span",Ft,t(r("Commission"))+" ("+t(u.value.commission_percentage)+"%)",1),e("span",It,t(u.value.commission_reward)+" USDT",1)])])]),e("div",Dt,[e("button",{onClick:ee,class:q(["w-full h-10 rounded-xl bg-gradient-to-r from-cyan-400/70 via-blue-500/60 to-indigo-600/70 hover:from-cyan-500/80 hover:via-blue-600/70 hover:to-indigo-700/80 text-white font-semibold text-sm transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl backdrop-blur-sm",{"opacity-50 cursor-not-allowed":w.value}]),disabled:w.value},t(r("Confirm")),11,Nt)])])])):S("",!0)]),_:1}),E(K,{name:"fade",mode:"out-in"},{default:O(()=>[Y.value?(f(),h("div",Ut,[e("div",zt,[e("p",Bt,t(r("Fetching orders...")),1),e("p",At,t(r("There are not enough products available right now. Please wait.")),1),o[9]||(o[9]=e("div",{class:"mt-4"},[e("svg",{class:"animate-spin h-6 w-6 text-blue-500 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})])],-1))])])):S("",!0)]),_:1})]),_:1}))}},Jt=me(Vt,[["__scopeId","data-v-035408cd"]]);export{Jt as default};
