import{u as se,c as j,r as m,z as B,n as k,q as oe,K as ae,p as le,w as O,b as F,e,d as E,h as re,a as g,k as S,t,A,l as ne,H as de,o as h,y as q,T as K,F as ie}from"./app-DNboHIQE.js";import{_ as ue}from"./AuthenticatedLayout-CogfTr0V.js";import{l as ce}from"./lodash-BkuFAwsr.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},pe={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},fe={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 mb-4 sm:mb-6"},he={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4"},xe={class:"text-xl font-bold text-slate-800 drop-shadow-sm"},_e={class:"inline-block mt-2 px-3 py-1 rounded-full bg-gradient-to-r from-emerald-400/80 to-green-400/80 text-white text-xs font-semibold shadow-sm"},be={class:"grid grid-cols-1 sm:grid-cols-4 gap-2"},ge={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm p-2 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border border-white/30"},we={class:"flex justify-between w-full items-center"},ye={class:"text-xs text-slate-600 font-medium"},ke={class:"text-sm font-bold text-slate-800 flex items-center gap-1"},Se={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm p-2 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border border-white/30"},Te={class:"flex justify-between w-full items-center"},Ce={class:"text-xs text-slate-600 font-medium"},Pe={class:"text-sm font-bold text-slate-800 flex items-center gap-1"},Me={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm p-2 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border border-white/30"},je={class:"flex justify-between w-full items-center"},Oe={class:"text-xs text-slate-600 font-medium"},Fe={class:"text-sm font-bold text-slate-800 flex items-center gap-1"},Ee={class:"text-xs text-slate-600 font-medium"},Ie={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 mb-4 sm:mb-6"},De={class:"flex justify-between items-center mb-3"},Ne={class:"text-sm font-semibold text-slate-800 drop-shadow-sm"},Ue={class:"text-sm font-bold text-slate-700 bg-white/30 px-2 py-1 rounded-full backdrop-blur-sm"},ze={class:"w-full h-3 bg-white/20 rounded-full overflow-hidden backdrop-blur-sm"},Be={key:0,class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 sm:p-6 rounded-2xl sm:rounded-3xl shadow-2xl"},Ae={class:"text-center mb-4"},Ve={class:"text-xl font-bold text-slate-800 drop-shadow-sm mb-2"},Re={key:0,class:"text-xs text-red-600 font-medium text-center mb-2"},He={class:"text-sm text-slate-600 font-medium"},Le={class:"flex flex-col sm:flex-row justify-center items-center gap-4"},Ge={class:"bg-white/20 backdrop-blur-sm p-3 rounded-xl"},Je={class:"text-xs text-slate-600 font-medium text-center"},$e={class:"text-lg font-bold text-slate-800 text-center"},qe={key:0,class:"bg-gradient-to-r from-emerald-400/20 to-green-400/20 backdrop-blur-sm text-emerald-700 p-4 rounded-xl text-sm font-medium text-center shadow-lg max-w-xs"},Ke=["aria-busy","disabled"],We={key:0,class:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Xe={class:"bg-white/20 backdrop-blur-sm p-3 rounded-xl"},Qe={class:"text-xs text-slate-600 font-medium text-center"},Ye={class:"text-lg font-bold text-slate-800 text-center"},Ze={key:1,class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-6 rounded-2xl sm:rounded-3xl shadow-2xl border border-cyan-300/30 text-center"},et={class:"text-slate-600 font-medium"},tt={key:0,class:"fixed inset-0 bg-black/50 flex items-end sm:items-center justify-center z-50 p-4 pb-20 sm:pb-4"},st={class:"bg-gradient-to-br from-slate-800/95 via-blue-900/95 to-indigo-900/95 backdrop-blur-xl rounded-3xl shadow-2xl max-w-sm w-full max-h-[90vh] overflow-y-auto animate-scale border border-cyan-300/20"},ot={class:"bg-gradient-to-r from-cyan-400/60 via-blue-500/50 to-indigo-600/60 text-white p-4 rounded-t-3xl backdrop-blur-sm"},at={class:"text-sm font-semibold text-center"},lt={class:"p-4"},rt={class:"mb-3 text-xs"},nt={class:"flex justify-between mb-1"},dt={class:"text-slate-300"},it={class:"font-semibold text-white"},ut={class:"flex justify-between mb-1"},ct={class:"text-slate-300"},mt={class:"font-semibold text-white"},vt={class:"flex justify-between"},pt={key:0,class:"text-red-400 font-medium w-full text-center"},ft={class:"text-slate-300"},ht={class:"font-semibold text-emerald-400"},xt={class:"mb-3"},_t={class:"flex items-start justify-between"},bt={class:"flex items-start"},gt=["src","alt"],wt={class:"flex-1"},yt={class:"text-xs font-semibold mb-1 text-white"},kt={class:"text-[10px] text-slate-300 mb-1 leading-tight"},St={class:"text-xs font-bold text-cyan-400"},Tt={class:"text-xs space-y-1"},Ct={class:"flex justify-between"},Pt={class:"text-slate-300"},Mt={class:"font-semibold text-white"},jt={class:"flex justify-between"},Ot={class:"text-slate-300"},Ft={class:"font-semibold text-white"},Et={class:"flex justify-between"},It={class:"text-slate-300"},Dt={class:"font-semibold text-emerald-400"},Nt={class:"bg-gradient-to-r from-slate-700/50 to-blue-800/50 p-4 rounded-b-3xl backdrop-blur-sm"},Ut=["disabled"],zt={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},Bt={class:"bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl p-6 max-w-sm w-full text-center border border-white/40"},At={class:"text-slate-700 font-medium mb-2"},Vt={class:"text-xs text-slate-500"},Rt={__name:"Orders",props:{products:{type:Array,default:()=>[]},currentProductIndex:{type:Number,default:0},user:{type:Object,default:()=>({balance:0,frozen_balance:0,todays_profit:0,vip_level:"VIP1"})},tasks:{type:Array,default:()=>[]},taskTotalCount:{type:Number,default:0},confirmedCount:{type:Number,default:0},flash:{type:Object,default:()=>({})}},setup(x){const d=x,V=se(),W=j(()=>V.props.translations||{}),r=s=>W.value[s]||s,i=m(""),X=m(""),w=m(""),I=m(d.user.order_reward??0),R=["Ebay","Walmart","Etsy","Shopify","Alibaba","Aliexpress","Amazon"],D=m(""),Q=()=>R[Math.floor(Math.random()*R.length)],N=()=>{D.value=Q()};B(()=>d.user.order_reward,s=>{typeof s=="number"&&(I.value=s)}),B(()=>d.flash,s=>{s.error&&!v.value&&(i.value=s.error,setTimeout(()=>i.value="",5e3))},{deep:!0});const H=s=>{if(!Array.isArray(s)||s.length===0)return null;const o=s.map(a=>{const l=a.product??null;return l&&typeof l=="object"?{id:l.id??l.product_id??a.product_id??null,product_id:l.product_id??l.id??a.product_id??null,title:l.title??"",description:l.description??"",purchase_price:l.purchase_price??0,selling_price:l.selling_price??0,commission_reward:l.commission_reward??0,commission_percentage:l.commission_percentage??0,image_path:l.image_path??"",type:l.type??a.product_type??"",status:a.status??"confirmed",is_forced:l.is_forced??!1}:{id:a.product_id??a.id??null,product_id:a.product_id??null,title:a.title??"",description:a.description??"",purchase_price:a.purchase_price??0,selling_price:a.selling_price??0,commission_reward:a.commission_reward??0,commission_percentage:a.commission_percentage??0,image_path:a.image_path??"",type:a.product_type??"",status:a.status??"confirmed",is_forced:a.is_forced??!1}}).filter(a=>a&&a.id!=null);return o.length===0?null:{name:s[0].name||(d.user.vip_level??"Task"),products:o}};m(d.currentProductIndex);const n=m(H(d.tasks)),_=m(d.confirmedCount||0),p=m(d.taskTotalCount||0),Y=j(()=>!1),v=m(!1),y=m(!1),c=m(!1),T=m(_.value||0),f=m(null),u=j(()=>{if(f.value)return f.value;if(n.value&&Array.isArray(n.value.products)&&n.value.products.length){const s=Math.min(Math.max(0,T.value),n.value.products.length-1);return n.value.products[s]}return null}),Z=j(()=>_.value>=p.value&&p.value>0),L=()=>{var o;const s=localStorage.getItem("luckyOrderModalState");if(s)try{const a=JSON.parse(s);((o=a.modalProduct)==null?void 0:o.type)==="Lucky Order"?(f.value=a.modalProduct,v.value=!0):C()}catch{C()}},U=s=>{(s==null?void 0:s.type)==="Lucky Order"&&localStorage.setItem("luckyOrderModalState",JSON.stringify({modalProduct:s}))},C=()=>{localStorage.removeItem("luckyOrderModalState"),f.value=null,v.value=!1,w.value="",D.value=""},G=ce.debounce(()=>{if(c.value||!n.value||!n.value.products||n.value.products.length===0||T.value>=n.value.products.length||v.value){i.value="No tasks available or action in progress.",setTimeout(()=>i.value="",3e3);return}c.value=!0,k.reload({only:["tasks","taskTotalCount","confirmedCount","user","flash"],preserveState:!0,preserveScroll:!0,onSuccess:s=>{P();const o=n.value.products[T.value];if(!o){i.value=r("Failed to sync the current task. Please try again."),setTimeout(()=>i.value="",4e3),c.value=!1;return}if(o.status==="pending"){f.value=o,U(f.value),N(),v.value=!0,c.value=!1;return}const a=o.id;k.post(route("orders.check-balance"),{product_id:a,task_name:n.value.name,is_forced:o.is_forced,_token:s.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:l=>{var b,M,J,$;if((M=(b=l.props)==null?void 0:b.flash)!=null&&M.success)k.reload({only:["user","tasks","taskTotalCount","confirmedCount","flash"],preserveState:!0,onSuccess:()=>{P(),f.value=n.value.products[T.value],U(f.value),N(),v.value=!0,c.value=!1},onError:()=>{i.value="Failed to refresh data after reservation.",setTimeout(()=>i.value="",4e3),c.value=!1}});else{const te=(($=(J=l.props)==null?void 0:J.flash)==null?void 0:$.error)||"Failed to reserve order.";i.value=te,setTimeout(()=>i.value="",4e3),c.value=!1}},onError:l=>{const b=(l==null?void 0:l.message)||"Failed to grab order";i.value=b,setTimeout(()=>i.value="",4e3),c.value=!1}})},onError:()=>{i.value=r("Failed to sync with server. Please try again."),setTimeout(()=>i.value="",4e3),c.value=!1}})},500),ee=()=>{!u.value||!n.value||y.value||(y.value=!0,k.post(route("orders.store"),{product_id:u.value.id??u.value.product_id,task_name:n.value.name,is_forced:u.value.is_forced,_token:V.props.csrf_token},{preserveScroll:!0,onSuccess:s=>{var o,a,l,b;(a=(o=s.props)==null?void 0:o.flash)!=null&&a.success?(v.value=!1,C(),f.value=null,k.reload({only:["tasks","taskTotalCount","confirmedCount","user","flash"],preserveScroll:!0,onSuccess:()=>P()})):(b=(l=s.props)==null?void 0:l.flash)!=null&&b.error&&(w.value=s.props.flash.error,setTimeout(()=>w.value="",4e3))},onError:s=>{w.value=(s==null?void 0:s.message)||r("Error saving order. Please try again."),setTimeout(()=>w.value="",4e3)},onFinish:()=>{y.value=!1}}))},P=()=>{var s,o,a,l;if(n.value=H(d.tasks),p.value=d.taskTotalCount||0,_.value=d.confirmedCount||0,T.value=Math.min(_.value,((o=(s=n.value)==null?void 0:s.products)==null?void 0:o.length)-1||0),typeof((a=d.user)==null?void 0:a.order_reward)=="number"&&(I.value=d.user.order_reward),_.value>=p.value&&p.value>0&&(X.value="Congratulations you have done your today's task, your next task will be updated after midnight",v.value=!1,f.value=null,C()),n.value&&n.value.products){const b=n.value.products.find(M=>M.type==="Lucky Order"&&M.status==="pending");b?(f.value=b,U(f.value),N(),v.value=!0):((l=d.user)==null?void 0:l.balance)>=0&&!w.value&&C()}};let z=null;return oe(()=>{if(L(),P(),window.Echo&&d.user&&d.user.id)try{window.Echo.private(`orders.${d.user.id}`).listen("UserProgressReset",()=>{k.reload({only:["tasks","taskTotalCount","confirmedCount","user"],preserveState:!0,preserveScroll:!0})}).error(s=>{console.error("Echo error:",s)})}catch(s){console.error("Echo setup error:",s)}z=setInterval(()=>{!y.value&&!c.value&&!v.value&&!Z.value&&k.reload({only:["tasks","taskTotalCount","confirmedCount","user"],preserveState:!0,preserveScroll:!0})},5e3)}),ae(()=>{z&&clearInterval(z)}),B(()=>[d.tasks,d.taskTotalCount,d.confirmedCount,d.user,d.flash],()=>{P(),L()},{deep:!0,immediate:!0}),(s,o)=>(h(),le(ue,null,{default:O(()=>[F(E(re),{title:r("My Orders")},null,8,["title"]),e("div",ve,[e("div",pe,[e("div",fe,[e("div",he,[e("div",null,[e("h1",xe,t(r("Hi"))+", "+t(x.user.name||r("User")),1),e("p",_e,t(x.user.vip_level),1)])]),e("div",be,[e("div",ge,[e("div",we,[e("p",ye,t(r("Total Balance")),1),e("p",ke,[A(t((x.user.balance||0).toFixed(2))+" ",1),o[1]||(o[1]=e("span",{class:"text-xs text-slate-500"},"USDT",-1))])])]),e("div",Se,[e("div",Te,[e("p",Ce,t(r("Frozen Balance")),1),e("p",Pe,[A(t(Number(x.user.frozen_balance??0).toFixed(2))+" ",1),o[2]||(o[2]=e("span",{class:"text-xs text-slate-500"},"USDT",-1))])])]),e("div",Me,[e("div",je,[e("p",Oe,t(r("Today's Profit")),1),e("p",Fe,[A(t((x.user.todays_profit||0).toFixed(2))+" ",1),o[3]||(o[3]=e("span",{class:"text-xs text-slate-500"},"USDT",-1))])])]),F(E(ne),{href:"/balance/records",class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm p-2 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border border-white/30 flex items-center justify-center cursor-pointer"},{default:O(()=>[e("p",Ee,t(r("Balance Details")),1)]),_:1})])]),e("div",Ie,[e("div",De,[e("h3",Ne,t(r("Today's Progress")),1),e("span",Ue,t(_.value)+"/"+t(p.value),1)]),e("div",ze,[e("div",{class:"h-full bg-gradient-to-r from-emerald-400 to-green-500 transition-all duration-500 shadow-sm",style:de({width:p.value>0?_.value/p.value*100+"%":"0%"})},null,4)])]),n.value&&n.value.products&&n.value.products.length?(h(),g("div",Be,[e("div",Ae,[e("h2",Ve,t(r("Order Task Set")),1),i.value?(h(),g("p",Re,t(i.value),1)):S("",!0),e("p",He,t(n.value.name),1)]),e("div",Le,[e("div",Ge,[e("p",Je,t(r("Progress")),1),e("p",$e,t(_.value)+"/"+t(p.value),1)]),_.value>=p.value&&p.value>0?(h(),g("div",qe,t(r("Congratulations you have done your today's task, your next task will be updated after midnight")),1)):(h(),g("button",{key:1,onClick:o[0]||(o[0]=(...a)=>E(G)&&E(G)(...a)),class:q(["px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl flex items-center gap-2",{"opacity-70 cursor-not-allowed":c.value||y.value||v.value}]),"aria-busy":c.value,disabled:n.value.products.length===0||c.value||y.value||v.value},[c.value?(h(),g("svg",We,[...o[4]||(o[4]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"},null,-1)])])):S("",!0),e("span",null,t(r("Grab Orders")),1)],10,Ke)),e("div",Xe,[e("p",Qe,t(r("Reward")),1),e("p",Ye,t((x.user.order_reward&&x.user.order_reward>0?x.user.order_reward:I.value).toFixed(2))+" USDT",1)])])])):S("",!0),p.value?S("",!0):(h(),g("div",Ze,[e("p",et,t(r("No tasks available for your VIP level")),1)]))])]),F(K,{name:"fade",mode:"out-in"},{default:O(()=>[v.value&&u.value?(h(),g("div",tt,[e("div",st,[e("div",ot,[e("h3",at,t(D.value)+" - Order ("+t(u.value.commission_percentage)+"%)",1)]),e("div",lt,[e("div",rt,[e("div",nt,[e("span",dt,t(r("Order number:")),1),e("span",it,"# "+t(_.value+1),1)]),e("div",ut,[e("span",ct,t(r("Received Date:")),1),e("span",mt,t(new Date().toISOString().split("T")[0]),1)]),e("div",vt,[w.value?(h(),g("span",pt,t(w.value),1)):(h(),g(ie,{key:1},[e("span",ft,t(r("Balance:")),1),e("span",ht,t((x.user.balance||0).toFixed(2))+" USDT",1)],64))])]),o[6]||(o[6]=e("div",{class:"border-t border-cyan-300/30 my-3"},null,-1)),e("div",xt,[e("div",_t,[e("div",bt,[e("img",{src:u.value.image_path?"/storage/"+u.value.image_path:"https://via.placeholder.com/80?text=No+Image",alt:u.value.title,class:"w-16 h-16 object-cover rounded-lg mr-3 shadow-lg border border-cyan-300/20"},null,8,gt),e("div",wt,[e("h4",yt,t(u.value.title),1),e("p",kt,t(u.value.description),1),e("div",St,t(u.value.selling_price)+" USDT",1)])]),o[5]||(o[5]=e("div",{class:"text-[10px] text-slate-400 font-medium"},"X 1",-1))])]),o[7]||(o[7]=e("div",{class:"border-t border-cyan-300/30 my-3"},null,-1)),e("div",Tt,[e("div",Ct,[e("span",Pt,t(r("Purchase Price")),1),e("span",Mt,t(u.value.selling_price)+" USDT",1)]),e("div",jt,[e("span",Ot,t(r("Selling Price")),1),e("span",Ft,t((parseFloat(u.value.selling_price)+.112).toFixed(3))+" USDT",1)]),e("div",Et,[e("span",It,t(r("Commission"))+" ("+t(u.value.commission_percentage)+"%)",1),e("span",Dt,t(u.value.commission_reward)+" USDT",1)])])]),e("div",Nt,[e("button",{onClick:ee,class:q(["w-full h-10 rounded-xl bg-gradient-to-r from-cyan-400/70 via-blue-500/60 to-indigo-600/70 hover:from-cyan-500/80 hover:via-blue-600/70 hover:to-indigo-700/80 text-white font-semibold text-sm transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl backdrop-blur-sm",{"opacity-50 cursor-not-allowed":y.value}]),disabled:y.value},t(r("Confirm")),11,Ut)])])])):S("",!0)]),_:1}),F(K,{name:"fade",mode:"out-in"},{default:O(()=>[Y.value?(h(),g("div",zt,[e("div",Bt,[e("p",At,t(r("Fetching orders...")),1),e("p",Vt,t(r("There are not enough products available right now. Please wait.")),1),o[8]||(o[8]=e("div",{class:"mt-4"},[e("svg",{class:"animate-spin h-6 w-6 text-blue-500 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})])],-1))])])):S("",!0)]),_:1})]),_:1}))}},$t=me(Rt,[["__scopeId","data-v-78cf22a3"]]);export{$t as default};
