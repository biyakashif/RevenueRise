import{u as Z,r as i,c as I,q as ee,E as te,p as se,w as oe,e,a as n,k as h,i as P,m as j,o as l,t as r,F as A,j as E,x as ae,z as N,g as le}from"./app-DAygwsjv.js";import{_ as re}from"./AdminLayout-DolgAX2R.js";const ne={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},ie={class:"mb-6"},de={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},ce={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl rounded-2xl p-6 w-full max-w-md mx-4 border border-white/20 shadow-2xl"},ue={class:"text-lg font-semibold mb-4 text-white text-center"},he={class:"mb-4"},me={key:1,class:"mb-4 p-4 rounded-xl bg-green-100/80 border border-green-200 text-green-700 text-sm text-center backdrop-blur-sm"},pe={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-white/30"},ve={class:"overflow-x-auto"},be={class:"w-full"},ge={class:"p-4 text-sm text-slate-800 font-medium relative"},fe={key:0,class:"ml-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 inline-flex items-center justify-center"},xe={class:"p-4 text-sm text-slate-700"},we={class:"p-4 text-sm text-slate-700"},_e={class:"p-4"},ye={class:"flex flex-wrap gap-2"},ke=["onClick","disabled"],Te=["onClick"],Ce=["onClick"],Se=["onClick"],Oe={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},Le={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl rounded-2xl p-6 w-full max-w-md mx-4 border border-white/20 shadow-2xl overflow-y-auto max-h-[90vh]"},Pe={class:"text-lg font-semibold mb-4 text-white text-center"},je={key:0,class:"text-center text-white/70"},Ae={key:1,class:"space-y-3 mb-6"},Ee=["src"],Ne={class:"flex-1"},Me={class:"font-semibold text-sm text-white"},Ue={class:"text-xs text-white/70 mb-1"},Re={class:"flex gap-2 text-xs"},$e={class:"text-green-300"},Xe={class:"text-blue-300"},qe={class:"text-xs text-white/50 ml-2"},Fe={key:0,class:"ml-2 bg-green-500 text-white px-2 py-1 rounded text-xs"},Ve=["onClick"],Be={key:1,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},Ie={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl rounded-2xl p-6 w-full max-w-md mx-4 border border-white/20 shadow-2xl overflow-y-auto max-h-[90vh]"},ze={class:"mb-4"},De={key:0,class:"text-center text-white/70"},He={key:1,class:"space-y-3 mb-6"},Je=["onClick"],Ke=["checked","onClick"],We=["src"],Qe={class:"flex-1"},Ge={class:"font-semibold text-sm text-white"},Ye={class:"text-xs text-white/70 mb-1"},Ze={class:"flex gap-3 text-xs"},et={class:"text-green-300"},tt={class:"text-blue-300"},st={class:"text-yellow-300"},nt={__name:"TaskManager",setup(ot){const g=Z(),C=g.props.users,u=i([]),y=i(!1),d=i(null),S=i(!1),f=i([]),O=i(null),m=i([]),a=i("");let M=null;const k=i(""),w=i(""),b=i(new Set(g.props.assignedUserIds||[])),z=I(()=>{if(!C)return[];if(!k.value)return C;const o=k.value.toLowerCase();return C.filter(s=>s.name&&s.name.toLowerCase().includes(o)||s.vip_level&&s.vip_level.toLowerCase().includes(o)||s.mobile_number&&s.mobile_number.includes(o))}),D=I(()=>{if(!f.value)return[];if(!w.value)return f.value;const o=w.value.toLowerCase();return f.value.filter(s=>s.commission_reward&&s.commission_reward.toString().includes(o))});async function U(o){const c=await(await fetch(`/admin/tasks/${o}`)).json();u.value=c.tasks,d.value=c.user,y.value=!0}function H(){y.value=!1,d.value=null,u.value=[]}async function J(o,s){O.value=o;const p=await(await fetch("/admin/products/lucky-orders")).json();f.value=p.products,S.value=!0}function R(o){const s=m.value.indexOf(o);s>-1?m.value.splice(s,1):m.value=[o]}async function K(){if(m.value.length===0){a.value="Please select a product",setTimeout(()=>{a.value=""},2e3);return}try{const o=await fetch(`/admin/tasks/${d.value.id}/replace/${O.value}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":g.props.csrf_token,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({product_id:m.value[0]})});if(!o.ok){if(o.status===419){window.location.reload();return}throw new Error("Failed to replace task")}a.value="Product replaced successfully!",setTimeout(()=>{a.value=""},1e3),$(),U(d.value.id)}catch(o){a.value="Error: "+o.message,setTimeout(()=>{a.value=""},2e3)}}function $(){S.value=!1,m.value=[],O.value=null,w.value=""}async function W(o){try{const s=await fetch(`/admin/tasks/${o}/reset`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":g.props.csrf_token,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({})});if(!s.ok){if(s.status===419){window.location.reload();return}throw new Error("Failed to reset tasks")}a.value="Tasks reset and reassigned successfully!",setTimeout(()=>{a.value=""},1e3)}catch(s){a.value="Error: "+s.message,setTimeout(()=>{a.value=""},2e3)}}const L=i(!1),x=i(null),_=i(0);function Q(o){if(b.value.has(o.id)){a.value="Tasks already assigned to this user. Delete tasks first to reassign.",setTimeout(()=>{a.value=""},2e3);return}x.value=o,L.value=!0}async function G(){if(!x.value||_.value<=0){a.value="Please enter valid inputs.",setTimeout(()=>{a.value=""},2e3);return}try{const o=await fetch("/admin/tasks/assign",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":g.props.csrf_token,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({userId:x.value.id,tasksNumber:_.value})}),s=await o.json();if(!o.ok){if(o.status===419){window.location.reload();return}a.value="Error: "+(s.message||"Unknown error"),setTimeout(()=>{a.value=""},3e3);return}a.value="Tasks assigned successfully!",b.value.add(x.value.id),window.taskAssignmentUpdated&&window.taskAssignmentUpdated(),setTimeout(()=>{a.value=""},1e3),X()}catch(o){a.value="Error: "+o.message,setTimeout(()=>{a.value=""},2e3)}}async function Y(o){try{const s=await fetch(`/admin/tasks/${o}/delete`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":g.props.csrf_token,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({})});if(!s.ok){if(s.status===419){window.location.reload();return}throw new Error("Failed to delete tasks")}a.value="Tasks deleted successfully!",b.value.delete(o),window.taskAssignmentUpdated&&window.taskAssignmentUpdated(),setTimeout(()=>{a.value=""},1e3),y.value=!1,u.value=[],d.value=null}catch(s){a.value="Error: "+s.message,setTimeout(()=>{a.value=""},2e3)}}function X(){L.value=!1,x.value=null,_.value=0}return window.taskAssignmentUpdated=()=>{},ee(()=>{window.Echo&&(M=window.Echo.channel("admin.orders").listen(".OrderConfirmed",o=>{if(console.log("OrderConfirmed received:",o),d.value&&o.order&&o.order.user_id===d.value.id){const s=o.order.product_id,c=[...u.value],p=c.findIndex(T=>T.product_id===s);p!==-1&&(c[p]={...c[p],status:"confirmed"},u.value=c,console.log("Updated task status live for product:",s))}}))}),te(()=>{M&&window.Echo.leave("admin.orders")}),(o,s)=>(l(),se(re,null,{default:oe(()=>{var c,p,T;return[e("div",ne,[s[5]||(s[5]=e("h1",{class:"text-lg font-bold text-slate-800 drop-shadow-sm mb-4"},"Task Manager",-1)),e("div",ie,[P(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>k.value=t),type:"text",placeholder:"Search by name, mobile, or VIP level...",class:"w-full h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[j,k.value]])]),L.value?(l(),n("div",de,[e("div",ce,[e("h2",ue,"Assign Tasks to "+r((c=x.value)==null?void 0:c.name),1),e("div",he,[s[3]||(s[3]=e("label",{class:"block text-sm font-medium text-white mb-2"},"Enter Tasks Number",-1)),P(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>_.value=t),type:"number",class:"w-full h-10 rounded-lg bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-3 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[j,_.value]])]),e("div",{class:"flex space-x-2"},[e("button",{onClick:X,class:"flex-1 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-lg text-sm hover:bg-white/30 text-white border border-white/30"}," Cancel "),e("button",{onClick:G,class:"flex-1 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded text-sm hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200"}," Assign ")])])])):h("",!0),a.value?(l(),n("div",me,r(a.value),1)):h("",!0),e("div",pe,[e("div",ve,[e("table",be,[s[4]||(s[4]=e("thead",null,[e("tr",{class:"bg-white/20 text-slate-700 text-sm font-medium"},[e("th",{class:"p-4 text-left"},"Name"),e("th",{class:"p-4 text-left"},"Mobile Number"),e("th",{class:"p-4 text-left"},"VIP Level"),e("th",{class:"p-4 text-left"},"Actions")])],-1)),e("tbody",null,[(l(!0),n(A,null,E(z.value,t=>(l(),n("tr",{key:t.id,class:"border-t border-white/20 hover:bg-white/10 transition-all duration-200"},[e("td",ge,[ae(r(t.name)+" ",1),!b.value.has(t.id)&&t.role!=="admin"?(l(),n("span",fe,"!")):h("",!0)]),e("td",xe,r(t.mobile_number),1),e("td",we,r(t.vip_level),1),e("td",_e,[e("div",ye,[e("button",{onClick:v=>Q(t),disabled:b.value.has(t.id),class:N([b.value.has(t.id)?"from-gray-400 to-gray-500":"from-green-500 to-green-600 hover:from-green-600 hover:to-green-700","bg-gradient-to-r text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"])},r(b.value.has(t.id)?"Assigned":"Assign Tasks"),11,ke),e("button",{onClick:v=>U(t.id),class:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"},"Tasks Details",8,Te),e("button",{onClick:v=>W(t.id),class:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"},"Reset Task",8,Ce),e("button",{onClick:v=>Y(t.id),class:"bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"},"Delete Tasks",8,Se)])])]))),128))])])])])]),y.value?(l(),n("div",Oe,[e("div",Le,[e("h2",Pe," Tasks for "+r((p=d.value)==null?void 0:p.name)+" ("+r((T=d.value)==null?void 0:T.vip_level)+") ",1),u.value&&u.value.length===0?(l(),n("div",je,"No tasks assigned.")):h("",!0),u.value&&u.value.length>0?(l(),n("ul",Ae,[(l(!0),n(A,null,E(u.value,t=>{var v,q,F,V,B;return l(),n("li",{key:t.id,class:N(["flex items-center rounded-lg p-3 shadow-sm backdrop-blur-sm border border-white/20",t.product_type==="Lucky Order"?"bg-yellow-100/20":"bg-white/10"])},[e("img",{src:(v=t.product)!=null&&v.image_path?"/storage/"+t.product.image_path:"/default-product.png",alt:"Product",class:"w-10 h-10 object-cover rounded mr-3 border border-white/30"},null,8,Ee),e("div",Ne,[e("div",Me,r((q=t.product)==null?void 0:q.title),1),e("div",Ue,r(t.product_type),1),e("div",Re,[e("span",$e,"Buy: "+r((F=t.product)==null?void 0:F.purchase_price),1),e("span",Xe,"Sell: "+r((V=t.product)==null?void 0:V.selling_price),1)])]),e("div",qe,"#"+r(t.position),1),t.status&&t.status.toString().trim().toLowerCase()==="confirmed"?(l(),n("span",Fe," Confirmed ")):t.product_type!=="Lucky Order"&&((B=d.value)!=null&&B.id)?(l(),n("button",{key:1,onClick:at=>J(t.id,d.value.id),class:"ml-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-2 py-1 rounded text-xs hover:from-blue-600 hover:to-blue-700 transition-all duration-200"}," Apply L/O ",8,Ve)):h("",!0)],2)}),128))])):h("",!0),e("button",{onClick:H,class:"w-full px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded text-sm hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition-all duration-200"},"Close")])])):h("",!0),S.value?(l(),n("div",Be,[e("div",Ie,[s[6]||(s[6]=e("h2",{class:"text-lg font-semibold mb-4 text-white text-center"},"Select Lucky Order Product",-1)),e("div",ze,[P(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>w.value=t),type:"text",placeholder:"Search by commission...",class:"w-full h-10 rounded-lg bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-3 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[j,w.value]])]),f.value.length===0?(l(),n("div",De,"No Lucky Order products available.")):h("",!0),f.value.length>0?(l(),n("div",He,[(l(!0),n(A,null,E(D.value,t=>(l(),n("div",{key:t.id,onClick:v=>R(t.id),class:N(["flex items-center rounded-lg p-3 shadow-sm backdrop-blur-sm border cursor-pointer transition-all duration-200",m.value.includes(t.id)?"bg-blue-500/30 border-blue-400":"bg-white/10 border-white/20 hover:bg-white/20"])},[e("input",{type:"checkbox",checked:m.value.includes(t.id),class:"mr-3 h-5 w-5 rounded",onClick:le(v=>R(t.id),["stop"])},null,8,Ke),e("img",{src:t.image_path?"/storage/"+t.image_path:"/default-product.png",alt:"Product",class:"w-16 h-16 object-cover rounded mr-3 border border-white/30"},null,8,We),e("div",Qe,[e("div",Ge,r(t.title),1),e("div",Ye,r(t.type),1),e("div",Ze,[e("span",et,"Purchase: "+r(t.purchase_price),1),e("span",tt,"Sell: "+r(t.selling_price),1),e("span",st,"Commission: "+r(t.commission_reward),1)])])],10,Je))),128))])):h("",!0),e("div",{class:"flex space-x-2"},[e("button",{onClick:$,class:"flex-1 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-lg text-sm hover:bg-white/30 text-white border border-white/30"}," Cancel "),e("button",{onClick:K,class:"flex-1 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded text-sm hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200"}," Save ")])])])):h("",!0)]}),_:1}))}};export{nt as default};
