import{u as A,r as m,c as E,z as P,q as V,s as M,a as r,b as D,d as W,h as L,w as R,e as t,k as b,A as k,o as n,t as i,y as q,i as H,m as G,F as $,j as J,n as z}from"./app-D6hQSsMw.js";import{_ as K}from"./AdminLayout-DLZ9ec3C.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},X={class:"text-lg font-bold text-slate-800 drop-shadow-sm mb-4"},Y={key:0,class:"block text-base font-medium text-slate-700"},Z={key:1,class:"text-sm font-medium text-slate-600"},ee={key:1,class:"mb-6 p-4 rounded-xl bg-red-100/80 border border-red-200 text-red-700 text-sm flex items-center gap-2 backdrop-blur-sm"},te={key:2,class:"mb-6"},se={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/30"},ae={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},oe={class:"text-lg font-semibold text-slate-800"},le={class:"text-lg font-semibold text-slate-800"},re={class:"mt-4 flex flex-wrap gap-3"},ne=["disabled"],de=["disabled"],ie=["disabled"],ue=["disabled"],ce={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-white/30"},me={class:"overflow-x-auto"},pe={class:"w-full"},ve={class:"p-4 align-top"},fe={key:0,class:"text-slate-500 text-sm"},be={key:1,class:"space-y-3"},ge={class:"flex items-start"},he={key:0,class:"mr-3"},xe=["href"],_e=["src"],we={key:1,class:"mr-3 text-gray-500 text-xs"},ye={class:"flex-1"},ke={class:"flex items-center gap-2"},Fe={class:"text-sm font-medium text-slate-700"},Ue={key:0,class:"inline-flex items-center px-2 py-0.5 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full"},Se={key:1,class:"ml-2 text-xs text-slate-600 italic"},$e={class:"text-sm text-slate-700"},ze={class:"text-sm text-slate-700"},Ne={class:"mt-2 flex justify-end gap-2"},Te={key:0,class:"text-green-600 text-xs font-semibold"},Ie={key:1,class:"text-red-600 text-xs font-semibold"},Ce=["onClick"],De=["onClick"],je={__name:"UpdateWallet",props:{deposits:{type:Array,default:()=>[]},selectedUserId:{type:[String,Number],default:null},balance:{type:[Number,String],default:0},frozen_balance:{type:[Number,String],default:0},userName:{type:String,default:null},mobile_number:{type:String,default:null}},setup(h){const u=h,p=A(),x=m([...u.deposits]),_=m(parseFloat(u.balance)||0),F=m(parseFloat(u.frozen_balance)||0),U=m(u.userName),S=m(u.mobile_number),d=m(""),l=m(""),f=m(""),g=m(""),j=E(()=>({"bg-green-100 border-green-500 text-green-700":g.value==="success","bg-red-100 border-red-500 text-red-700":g.value==="error"}));P(()=>p.props.flash,a=>{a.success?(f.value=a.success,g.value="success"):a.error?(f.value=a.error,g.value="error"):(f.value="",g.value=""),f.value&&setTimeout(()=>{f.value="",p.props.flash.success&&(p.props.flash.success=null),p.props.flash.error&&(p.props.flash.error=null)},2e3)},{deep:!0});let N=null;const v=async()=>{if(u.selectedUserId)try{const a=await fetch(`/admin/update-wallet?user_id=${u.selectedUserId}`,{headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);const s=await a.json();x.value=s.deposits||[],_.value=parseFloat(s.balance)||0,F.value=parseFloat(s.frozen_balance)||0,U.value=s.userName||"Unknown",S.value=s.mobile_number||"Unknown",l.value=""}catch(a){l.value=`Failed to fetch wallet data: ${a.message}. Please try again.`,setTimeout(()=>l.value="",5e3)}};V(()=>{v(),N=setInterval(v,5e3)}),M(()=>{clearInterval(N)});const T=async(a,s)=>{if(s==="approve"){const e=x.value.find(o=>o.id===a);if(!e){l.value="Deposit not found.",setTimeout(()=>l.value="",3e3);return}try{const o=await fetch(`https://api.coinbase.com/v2/exchange-rates?currency=${e.symbol}`);if(!o.ok)throw new Error(`Failed to fetch exchange rate: ${o.status}`);const c=await o.json();if(!c.data||!c.data.rates||!c.data.rates.USDT)throw new Error("Invalid exchange rate data received");const I=parseFloat(c.data.rates.USDT),B=parseFloat(e.amount)*I;z.post(`/admin/update-deposit/${a}`,{action:s,converted_amount:B,original_amount:e.amount,symbol:e.symbol,exchange_rate:I,_token:p.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{v()},onError:y=>{var C;if(y&&((C=y.message)!=null&&C.includes("419")||y.status===419)){window.location.reload();return}l.value=y.action||"Failed to approve deposit.",setTimeout(()=>l.value="",5e3),v()}})}catch(o){l.value=`Failed to get exchange rate: ${o.message}. Please try again.`,setTimeout(()=>l.value="",5e3);return}}else z.post(`/admin/update-deposit/${a}`,{action:s,_token:p.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{v()},onError:e=>{var o;if(e&&((o=e.message)!=null&&o.includes("419")||e.status===419)){window.location.reload();return}l.value=e.action||"Failed to update deposit status.",setTimeout(()=>l.value="",5e3),v()}})},w=a=>{const s=parseFloat(d.value);if(isNaN(s)||s<=0){l.value="Please enter a valid amount greater than 0.",setTimeout(()=>l.value="",3e3);return}let e;a==="freeze"?e=route("admin.freeze-balance",u.selectedUserId):a==="unfreeze"?e=route("admin.unfreeze-balance",u.selectedUserId):e=`/admin/update-balance/${u.selectedUserId}`,z.post(e,{amount:s,action:a==="freeze"||a==="unfreeze"?"subtract":a,_token:p.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{v(),d.value="",l.value=""},onError:o=>{var c;if(o&&((c=o.message)!=null&&c.includes("419")||o.status===419)){window.location.reload();return}l.value=o.error||o.amount||o.action||"Failed to update balance. Please check the server configuration.",setTimeout(()=>l.value="",5e3),v()}})};return(a,s)=>(n(),r($,null,[D(W(L),{title:"Update Wallet"}),D(K,null,{default:R(()=>[t("div",Q,[t("h1",X,[s[5]||(s[5]=k(" Update Wallet ",-1)),h.selectedUserId&&U.value?(n(),r("span",Y," for "+i(U.value),1)):b("",!0),h.selectedUserId&&S.value?(n(),r("span",Z," Mobile: "+i(S.value),1)):b("",!0)]),f.value?(n(),r("div",{key:0,class:q([j.value,"mb-6 p-4 rounded-xl bg-green-100/80 border border-green-200 text-green-700 text-sm flex items-center gap-2 backdrop-blur-sm"])},i(f.value),3)):b("",!0),l.value?(n(),r("div",ee,i(l.value),1)):b("",!0),h.selectedUserId?(n(),r("div",te,[t("div",se,[t("div",ae,[t("div",null,[s[6]||(s[6]=t("p",{class:"text-sm font-medium text-slate-700"},"User Balance",-1)),t("p",oe,"$"+i(_.value.toFixed(2)),1)]),t("div",null,[s[7]||(s[7]=t("p",{class:"text-sm font-medium text-slate-700"},"Frozen Balance",-1)),t("p",le,"$"+i(F.value.toFixed(2)),1)])]),H(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>d.value=e),type:"number",step:"0.01",min:"0.01",placeholder:"Enter amount",class:"mt-4 w-full max-w-md h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[G,d.value]]),t("div",re,[t("button",{onClick:s[1]||(s[1]=e=>w("add")),class:"px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0}," Add ",8,ne),t("button",{onClick:s[2]||(s[2]=e=>w("subtract")),class:"px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0||_.value<parseFloat(d.value)}," Subtract ",8,de),t("button",{onClick:s[3]||(s[3]=e=>w("freeze")),class:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0||_.value<parseFloat(d.value)}," Freeze Balance ",8,ie),t("button",{onClick:s[4]||(s[4]=e=>w("unfreeze")),class:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0||F.value<parseFloat(d.value)}," Unfreeze Balance ",8,ue)])])])):b("",!0),t("div",ce,[t("div",me,[t("table",pe,[s[11]||(s[11]=t("thead",null,[t("tr",{class:"bg-white/20 text-slate-700 text-sm font-medium"},[t("th",{class:"p-4 text-left"},"Deposits")])],-1)),t("tbody",null,[t("tr",null,[t("td",ve,[x.value.length===0?(n(),r("div",fe,"No deposits")):(n(),r("div",be,[(n(!0),r($,null,J(x.value,e=>{var o;return n(),r("div",{key:e.id,class:"bg-white/30 backdrop-blur-sm rounded-xl p-3 border border-white/30 shadow-lg"},[t("div",ge,[e.slip_path?(n(),r("div",he,[t("a",{href:"/storage/"+e.slip_path,target:"_blank"},[t("img",{src:"/storage/"+e.slip_path,alt:"Deposit Slip",class:"w-10 h-10 object-cover rounded"},null,8,_e)],8,xe)])):(n(),r("div",we,"No Image")),t("div",ye,[t("div",ke,[t("div",Fe,[s[8]||(s[8]=t("strong",null,"User:",-1)),k(" "+i(((o=e.user)==null?void 0:o.name)||"Unknown"),1)]),e.vip_level||e.title&&e.title.toLowerCase().includes("vip")?(n(),r("span",Ue," VIP Purchase ")):b("",!0),e.title?(n(),r("span",Se,i(e.title),1)):b("",!0)]),t("div",$e,[s[9]||(s[9]=t("strong",null,"Amount:",-1)),k(" "+i(e.amount)+" "+i(e.symbol),1)]),t("div",ze,[s[10]||(s[10]=t("strong",null,"Date:",-1)),k(" "+i(new Date(e.created_at).toLocaleString()),1)]),t("div",Ne,[e.status==="approved"?(n(),r("span",Te,"Approved")):e.status==="rejected"?(n(),r("span",Ie,"Rejected")):(n(),r($,{key:2},[t("button",{onClick:c=>T(e.id,"approve"),class:"px-3 py-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg text-xs font-medium transition-all duration-200 shadow-lg"},"Approve",8,Ce),t("button",{onClick:c=>T(e.id,"reject"),class:"px-3 py-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg text-xs font-medium transition-all duration-200 shadow-lg"},"Reject",8,De)],64))])])])])}),128))]))])])])])])])])]),_:1})],64))}},Pe=O(je,[["__scopeId","data-v-d15cde71"]]);export{Pe as default};
