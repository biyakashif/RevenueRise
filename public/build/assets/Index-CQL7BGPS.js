import{u as N,r as u,D as v,q as F,a as i,b as q,k as b,w as U,e as a,t as g,o as n,F as E,j as K,y as T,d as r,i as Y,C as P,g as O,m as R}from"./app-CdvAI5iq.js";import{_ as X}from"./AuthenticatedLayout-DBI621vr.js";const G={class:"absolute inset-0 flex flex-col"},J={class:"flex items-center justify-between px-4 py-3 bg-gradient-to-br from-cyan-400/30 via-blue-500/25 to-indigo-600/30 backdrop-blur-xl text-white shadow-md border-b border-cyan-300/30 rounded-t-2xl sm:rounded-t-3xl"},Q={class:"text-lg text-blue-500 font-semibold"},Z={class:"flex-1 overflow-y-auto p-4 bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl"},ee={key:0,class:"flex items-center justify-center h-full"},te={class:"text-center py-8 px-4 bg-red-50 rounded-lg border border-red-200"},se={class:"text-lg font-semibold text-red-800 mb-2"},ae={class:"text-red-600"},oe={key:1,class:"flex items-center justify-center h-full text-slate-600"},re={key:0,class:"w-8 h-8 rounded-full overflow-hidden border flex-shrink-0"},ie=["src","alt"],ne={key:1,class:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},le={key:0,class:"mb-2"},de=["src","onClick"],ce={key:1,class:"mb-2 relative"},ue=["onClick"],pe=["src"],he=["innerHTML"],ve={class:"border-t border-cyan-300/30 p-3 bg-gradient-to-br from-cyan-400/30 via-blue-500/25 to-indigo-600/30 backdrop-blur-xl flex items-center space-x-2 rounded-b-2xl sm:rounded-b-3xl"},fe={key:0,class:"w-full text-center py-4 text-red-600 bg-red-50 rounded-lg"},me=["title"],be=["title"],ge=["placeholder","onKeydown"],we={class:"relative max-w-4xl max-h-4xl"},xe=["src"],_e=["src"],Te={__name:"Index",setup(ye){const o=N(),c=u([]),d=s=>o.props.translations[s]||s,f=u(""),w=u(null),x=u(null),M=u(!1),_=u(""),y=u(""),k=new Audio("/notification.mp3"),j=u(""),m=u(!1);v.defaults.headers.common["X-CSRF-TOKEN"]=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),v.defaults.withCredentials=!0;const S=async()=>{try{const s=await v.get("/chat/messages");c.value=s.data.sort((e,t)=>new Date(e.created_at)-new Date(t.created_at)),setTimeout(()=>{const e=document.querySelector(".overflow-y-auto");e&&(e.scrollTop=e.scrollHeight)},100),window.dispatchEvent(new CustomEvent("chat:read"))}catch(s){console.error("Error loading messages:",s)}},L=async()=>{var s,e,t,l;try{if(m.value||!f.value.trim()&&!((s=w.value)!=null&&s.files[0])&&!((e=x.value)!=null&&e.files[0]))return;const p=f.value;f.value="";const C=(await v.post("/chat/broadcast",{message:p})).data;if(C&&C.id){const B={id:C.id,message:p,image_path:null,video_path:null,created_at:C.created_at,sender_id:o.props.auth.user.id,recipient_id:null};c.value.some(h=>h.id===B.id)||(c.value.push(B),c.value.sort((h,W)=>new Date(h.created_at)-new Date(W.created_at)),setTimeout(()=>{const h=document.querySelector(".overflow-y-auto");h&&(h.scrollTop=h.scrollHeight)},50))}w.value&&(w.value.value=""),x.value&&(x.value.value="")}catch(p){f.value=messageText,console.error("Error sending message:",p),alert(((l=(t=p.response)==null?void 0:t.data)==null?void 0:l.error)||d("Error sending message. Please try again."))}},I=async s=>{const e=s.target.files[0];if(!e||m.value)return;const t=new FormData;t.append("image",e),await v.post("/chat/send",t),s.target.value=""},z=async s=>{const e=s.target.files[0];if(!e||m.value)return;if(e.size>30*1024*1024){j.value=d("The video file size must not exceed 30MB."),s.target.value="";return}j.value="";const t=new FormData;t.append("video",e),await v.post("/chat/send",t),s.target.value=""},H=s=>{if(s&&s.target){s.target.style.display="none";const e=s.target.parentElement;e&&(e.innerHTML='<i class="fas fa-user text-gray-400"></i>',e.classList.add("flex","items-center","justify-center"))}},A=(s,e)=>{_.value=s,y.value=e,M.value=!0},$=()=>{M.value=!1,_.value="",y.value=""},V=()=>{window.history.back()};F(()=>{S(),D(),window.Echo&&window.Echo.private(`chat.${o.props.auth.user.id}`).listen("NewChatMessage",e=>{c.value.some(l=>l.id===e.chat.id)||(c.value.push({id:e.chat.id,message:e.chat.message,image_path:e.chat.image_path,video_path:e.chat.video_path,created_at:e.chat.created_at,sender_id:e.chat.sender_id,recipient_id:e.chat.recipient_id}),c.value.sort((l,p)=>new Date(l.created_at)-new Date(p.created_at)),setTimeout(()=>{const l=document.querySelector(".overflow-y-auto");l&&(l.scrollTop=l.scrollHeight)},50),e.chat.sender_id!==o.props.auth.user.id&&k.play().catch(()=>{}),window.dispatchEvent(new CustomEvent("chat:read")))});const s=()=>{k.play().then(()=>{k.pause(),k.currentTime=0}).catch(()=>{}),window.removeEventListener("click",s),window.removeEventListener("keydown",s),window.removeEventListener("touchstart",s)};window.addEventListener("click",s),window.addEventListener("keydown",s),window.addEventListener("touchstart",s),setInterval(D,5e3)});const D=async()=>{try{const s=await v.get("/chat/block-status");m.value=s.data.is_blocked}catch(s){console.error("Error checking block status:",s)}};return(s,e)=>(n(),i(E,null,[q(X,{hideBottomNav:!0},{default:U(()=>[a("div",G,[a("div",J,[a("button",{onClick:V,class:"text-blue-500 focus:outline-none mr-3"},[...e[3]||(e[3]=[a("i",{class:"fas fa-arrow-left"},null,-1)])]),a("div",Q,g(d("Support Chat")),1),e[4]||(e[4]=a("button",{class:"text-white focus:outline-none"},null,-1))]),a("div",Z,[m.value?(n(),i("div",ee,[a("div",te,[e[5]||(e[5]=a("i",{class:"fas fa-ban text-red-500 text-4xl mb-4"},null,-1)),a("h3",se,g(d("Account Blocked")),1),a("p",ae,g(d("You have been blocked by the administrator. You cannot send or receive messages.")),1)])])):c.value.length===0?(n(),i("div",oe,g(d("No messages yet")),1)):(n(!0),i(E,{key:2},K(c.value,t=>(n(),i("div",{key:t.id,class:T(["mb-4 flex",{"justify-end":t.sender_id===r(o).props.auth.user.id,"justify-start":t.sender_id!==r(o).props.auth.user.id}])},[a("div",{class:T(["flex items-start space-x-2 max-w-[85%]",t.sender_id===r(o).props.auth.user.id?"flex-row-reverse space-x-reverse":""])},[t.sender_id===r(o).props.auth.user.id&&r(o).props.auth.user.avatar_url||t.sender_id!==r(o).props.auth.user.id&&r(o).props.adminAvatar?(n(),i("div",re,[a("img",{src:t.sender_id===r(o).props.auth.user.id?r(o).props.auth.user.avatar_url.startsWith("/storage")||r(o).props.auth.user.avatar_url.startsWith("/assets")?r(o).props.auth.user.avatar_url:`/storage/${r(o).props.auth.user.avatar_url}`:r(o).props.adminAvatar.startsWith("/storage")||r(o).props.adminAvatar.startsWith("/assets")?r(o).props.adminAvatar:`/storage/${r(o).props.adminAvatar}`,alt:t.sender_id===r(o).props.auth.user.id?"You":"Support",class:"w-full h-full object-cover",onError:H},null,40,ie)])):(n(),i("div",ne,[...e[6]||(e[6]=[a("i",{class:"fas fa-user text-gray-400 text-xs"},null,-1)])])),a("div",{class:T(["rounded-lg p-3 text-sm",t.sender_id===r(o).props.auth.user.id?"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl border border-cyan-300/30 self-end":"bg-white/90 backdrop-blur-xl border border-white/50 self-start"])},[t.image_path?(n(),i("div",le,[a("img",{src:t.image_path.startsWith("/storage/")?t.image_path:`/storage/${t.image_path}`,alt:"chat image",class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:l=>A(t.image_path.startsWith("/storage/")?t.image_path:`/storage/${t.image_path}`,"image")},null,8,de)])):b("",!0),t.video_path?(n(),i("div",ce,[a("video",{class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:l=>A(t.video_path.startsWith("/storage/")?t.video_path:`/storage/${t.video_path}`,"video")},[a("source",{src:t.video_path.startsWith("/storage/")?t.video_path:`/storage/${t.video_path}`,type:"video/mp4"},null,8,pe)],8,ue),e[7]||(e[7]=a("div",{class:"absolute inset-0 flex items-center justify-center pointer-events-none"},[a("i",{class:"fas fa-play-circle text-white text-2xl opacity-80"})],-1))])):b("",!0),t.message?(n(),i("div",{key:2,class:"text-sm text-slate-800",innerHTML:t.message},null,8,he)):b("",!0)],2)],2)],2))),128))]),a("div",ve,[m.value?(n(),i("div",fe,g(d("You are blocked and cannot send messages.")),1)):(n(),i(E,{key:1},[a("input",{type:"file",ref_key:"imageInput",ref:w,class:"hidden",onChange:I,accept:"image/*"},null,544),a("button",{type:"button",onClick:e[0]||(e[0]=t=>s.$refs.imageInput.click()),class:"p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-md focus:outline-none border border-white/30 hover:bg-white/70 transition-all",title:d("Upload Image")},[...e[8]||(e[8]=[a("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,me),a("input",{type:"file",ref_key:"videoInput",ref:x,class:"hidden",onChange:z,accept:"video/mp4,video/x-matroska"},null,544),a("button",{type:"button",onClick:e[1]||(e[1]=t=>s.$refs.videoInput.click()),class:"p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-md focus:outline-none border border-white/30 hover:bg-white/70 transition-all",title:d("Upload Video")},[...e[9]||(e[9]=[a("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])],8,be),Y(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),type:"text",placeholder:d("Type your message..."),class:"flex-1 px-3 py-2 rounded-full bg-white/50 backdrop-blur-sm border border-white/30 focus:outline-none focus:ring-2 focus:ring-cyan-400 text-slate-900 placeholder-slate-500 text-sm",onKeydown:P(O(L,["exact","prevent"]),["enter"])},null,40,ge),[[R,f.value]]),a("button",{type:"button",onClick:L,class:"p-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-full shadow-md focus:outline-none transition-all duration-200"},[...e[10]||(e[10]=[a("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[a("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])])],64))])])]),_:1}),M.value?(n(),i("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:$},[a("div",we,[a("button",{onClick:$,class:"absolute -top-10 right-0 text-white text-2xl hover:text-gray-300"},[...e[11]||(e[11]=[a("i",{class:"fas fa-times"},null,-1)])]),y.value==="image"?(n(),i("img",{key:0,src:_.value,alt:"Full size image",class:"max-w-full max-h-screen object-contain"},null,8,xe)):b("",!0),y.value==="video"?(n(),i("video",{key:1,src:_.value,controls:"",autoplay:"",class:"max-w-full max-h-screen"},null,8,_e)):b("",!0)])])):b("",!0)],64))}};export{Te as default};
