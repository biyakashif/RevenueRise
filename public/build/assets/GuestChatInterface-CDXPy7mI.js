import{a as d,d as q,o as u,e as o,u as J,c as Q,r as f,q as X,s as Z,k as w,t as I,F as B,j as ee,z as E,i as te,m as se,C as ae,g as oe,D as M}from"./app-DAygwsjv.js";const ie="/build/assets/logo-BdVbD6YS.png",ne=["src"],Be={__name:"ApplicationLogo",setup(C){return(D,n)=>(u(),d("img",{src:q(ie),alt:"Logo",class:"block h-9 w-auto object-contain"},null,8,ne))}},le=["title"],Ee={__name:"FloatingChatIcon",props:{title:{type:String,default:"Help & Support"}},emits:["click"],setup(C){return(D,n)=>(u(),d("button",{onClick:n[0]||(n[0]=S=>D.$emit("click")),class:"floating-help-btn fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-full flex items-center justify-center transition-all duration-300 transform hover:scale-110 z-50",title:C.title},[...n[1]||(n[1]=[o("i",{class:"fas fa-headset text-lg"},null,-1)])],8,le))}},re={class:"absolute inset-0 flex flex-col"},de={class:"flex items-center justify-between px-4 py-3 bg-gradient-to-br from-cyan-400/30 via-blue-500/25 to-indigo-600/30 backdrop-blur-xl text-white shadow-md border-b border-cyan-300/30 rounded-t-2xl sm:rounded-t-3xl"},ue={class:"text-lg text-blue-500 font-semibold"},ce={key:0,class:"flex items-center justify-center h-full"},pe={class:"text-center py-8 px-4 bg-red-50 rounded-lg border border-red-200"},ge={class:"text-lg font-semibold text-red-800 mb-2"},ve={class:"text-red-600"},he={key:1,class:"flex items-center justify-center h-full text-slate-600"},me={key:0,class:"mb-2"},fe=["src","onClick"],be={key:1,class:"mb-2 relative"},_e={key:0,class:"w-32 h-32 bg-gray-200 rounded flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity"},xe=["onClick"],we=["src"],ye={key:2,class:"absolute inset-0 flex items-center justify-center pointer-events-none"},ke=["innerHTML"],Ie={class:"border-t border-cyan-300/30 p-3 bg-gradient-to-br from-cyan-400/30 via-blue-500/25 to-indigo-600/30 backdrop-blur-xl flex items-center space-x-2 rounded-b-2xl sm:rounded-b-3xl"},Me={key:0,class:"w-full text-center py-4 text-red-600 bg-red-50 rounded-lg"},Ce=["title"],De=["title"],$e=["placeholder","onKeydown"],Te={class:"relative max-w-4xl max-h-4xl"},je=["src"],Se=["src"],Ue={__name:"GuestChatInterface",props:{sessionId:String,guestInfo:Object},emits:["close"],setup(C,{emit:D}){const n=C,S=D,F=J(),H=Q(()=>F.props.translations||{}),p=s=>H.value[s]||s,a=f([]),y=f(""),$=f(null),N=f(null),R=f(null),L=f(!1),T=f(""),j=f(""),U=new Audio("/notification.mp3"),h=f(!1);let k=null,_=null;const b=()=>{setTimeout(()=>{$.value&&($.value.scrollTop=$.value.scrollHeight)},100)},z=async()=>{var s;if(n.sessionId)try{const e=(await M.get(`/guest-chat/${n.sessionId}/messages`)).data.sort((l,g)=>new Date(l.created_at)-new Date(g.created_at)),i=a.value.filter(l=>l.isTemp),r=new Set(a.value.filter(l=>!l.isTemp).map(l=>l.id)),v=e.filter(l=>!r.has(l.id));if(v.length>0){const l=v.some(m=>!m.is_guest),g=a.value.filter(m=>!m.isTemp);a.value=[...g,...v,...i].sort((m,c)=>new Date(m.created_at)-new Date(c.created_at)),l&&U.play().catch(()=>{}),b()}}catch(t){((s=t.response)==null?void 0:s.status)===404&&(G(),S("close"))}},W=async()=>{var t,e,i;if(!y.value.trim()||!n.sessionId||h.value)return;const s=y.value;y.value="";try{const r=await M.post(`/guest-chat/${n.sessionId}/broadcast`,{message:s,guest_name:(t=n.guestInfo)==null?void 0:t.name,guest_mobile:(e=n.guestInfo)==null?void 0:e.mobile_number}),v={id:r.data.id,message:s,is_guest:!0,created_at:r.data.created_at};a.value.some(g=>g.id===v.id)||(a.value.push(v),a.value.sort((g,m)=>new Date(g.created_at)-new Date(m.created_at)),b()),h.value=!1}catch(r){y.value=s,((i=r.response)==null?void 0:i.status)===403&&(h.value=!0)}},A=async s=>{var t;try{const e=s.target.files[0];if(!e||h.value)return;const i=URL.createObjectURL(e),r={id:"temp_"+Date.now(),message:"",is_guest:!0,image_path:i,video_path:null,created_at:new Date().toISOString(),isTemp:!0};a.value.push(r),a.value.sort((c,x)=>new Date(c.created_at)-new Date(x.created_at)),b();const v=new FormData;v.append("image",e);const l=await M.post(`/guest-chat/${n.sessionId}/send`,v);a.value=a.value.filter(c=>!c.isTemp);const g={id:l.data.id,message:l.data.message||"",is_guest:!0,image_path:l.data.image_path,video_path:null,created_at:l.data.created_at};a.value.some(c=>c.id===g.id)||(a.value.push(g),a.value.sort((c,x)=>new Date(c.created_at)-new Date(x.created_at)),b()),s.target.value=""}catch(e){console.error("Error uploading image:",e),((t=e.response)==null?void 0:t.status)===403?(h.value=!0,alert(p("You have been blocked and cannot send messages."))):alert(p("Error uploading image. Please try again."));const i=a.value.findIndex(r=>r.isTemp);i>-1&&a.value.splice(i,1)}},O=async s=>{var t;try{const e=s.target.files[0];if(!e||h.value)return;if(e.size>30*1024*1024){alert(p("Video file size must not exceed 30MB.")),s.target.value="";return}const i=URL.createObjectURL(e),r={id:"temp_"+Date.now(),message:"",is_guest:!0,image_path:null,video_path:i,created_at:new Date().toISOString(),isTemp:!0};a.value.push(r),a.value.sort((c,x)=>new Date(c.created_at)-new Date(x.created_at)),b();const v=new FormData;v.append("video",e);const l=await M.post(`/guest-chat/${n.sessionId}/send`,v);a.value=a.value.filter(c=>!c.isTemp);const g={id:l.data.id,message:l.data.message||"",is_guest:!0,image_path:null,video_path:l.data.video_path,created_at:l.data.created_at};a.value.some(c=>c.id===g.id)||(a.value.push(g),a.value.sort((c,x)=>new Date(c.created_at)-new Date(x.created_at)),b()),s.target.value=""}catch(e){console.error("Error uploading video:",e),((t=e.response)==null?void 0:t.status)===403?(h.value=!0,alert(p("You have been blocked and cannot send messages."))):alert(p("Error uploading video. Please try again."));const i=a.value.findIndex(r=>r.isTemp);i>-1&&a.value.splice(i,1)}},K=()=>{if(n.sessionId){if(window.Echo)try{_=window.Echo.channel(`guest-chat.${n.sessionId}`),_.listen("NewGuestChatMessage",s=>{if(console.log("ðŸ“¨ Guest received NewGuestChatMessage:",s),s.message&&s.message.is_guest&&s.message.sender_id===n.sessionId){console.log("â­ï¸ Skipping own message to avoid duplicate"),a.value=a.value.filter(i=>!i.isTemp);const t={id:s.message.id,message:s.message.message,is_guest:!0,created_at:s.message.created_at,image_path:s.message.image_path||null,video_path:s.message.video_path||null};a.value.some(i=>i.id===t.id)||(a.value.push(t),a.value.sort((i,r)=>new Date(i.created_at)-new Date(r.created_at)),b());return}if(s.message&&!s.message.is_guest){const t={id:s.message.id,message:s.message.message,is_guest:!1,created_at:s.message.created_at,image_path:s.message.image_path||null,video_path:s.message.video_path||null};a.value=a.value.filter(i=>!i.isTemp),a.value.some(i=>i.id===t.id)||(a.value.push(t),a.value.sort((i,r)=>new Date(i.created_at)-new Date(r.created_at)),U.play().catch(()=>{}),b())}}),_.listen("GuestChatDeleted",s=>{s.session_id===n.sessionId&&(alert(p("Your chat session has been ended by the administrator.")),S("close"))})}catch{console.log("Echo setup failed, using polling only")}k=setInterval(()=>{n.sessionId?(z(),P()):clearInterval(k)},2e3)}},G=()=>{_&&(_.stopListening("NewGuestChatMessage"),_.stopListening("GuestChatDeleted"),window.Echo&&window.Echo.leaveChannel(`guest-chat.${n.sessionId}`),_=null),k&&(clearInterval(k),k=null)},P=async()=>{if(n.sessionId)try{const s=await M.get(`/guest-chat/${n.sessionId}/block-status`);h.value=s.data.is_blocked}catch(s){console.error("Error checking block status:",s)}},V=(s,t)=>{T.value=s,j.value=t,L.value=!0},Y=()=>{L.value=!1,T.value="",j.value=""};return X(()=>{z(),K()}),Z(()=>{G()}),(s,t)=>(u(),d(B,null,[o("div",re,[o("div",de,[o("button",{onClick:t[0]||(t[0]=e=>s.$emit("close")),class:"text-blue-500 focus:outline-none mr-3"},[...t[4]||(t[4]=[o("i",{class:"fas fa-arrow-left"},null,-1)])]),o("div",ue,I(p("Support Chat")),1),t[5]||(t[5]=o("button",{class:"text-white focus:outline-none"},null,-1))]),o("div",{ref_key:"messagesContainer",ref:$,class:"flex-1 overflow-y-auto p-4 bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl"},[h.value?(u(),d("div",ce,[o("div",pe,[t[6]||(t[6]=o("i",{class:"fas fa-ban text-red-500 text-4xl mb-4"},null,-1)),o("h3",ge,I(p("Account Blocked")),1),o("p",ve,I(p("You have been blocked by the administrator. You cannot send or receive messages.")),1)])])):a.value.length===0?(u(),d("div",he,I(p("No messages yet. Start the conversation!")),1)):(u(!0),d(B,{key:2},ee(a.value,e=>(u(),d("div",{key:e.id,class:E(["mb-4 flex",{"justify-end":e.is_guest,"justify-start":!e.is_guest}])},[o("div",{class:E(["flex items-start space-x-2 max-w-[85%]",e.is_guest?"flex-row-reverse space-x-reverse":""])},[t[9]||(t[9]=o("div",{class:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},[o("i",{class:"fas fa-user text-gray-400 text-xs"})],-1)),o("div",{class:E(["rounded-lg p-3 text-sm bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl border border-cyan-300/30",e.is_guest?"self-end":"self-start"])},[e.image_path?(u(),d("div",me,[o("img",{src:e.image_path.startsWith("blob:")||e.image_path.startsWith("/storage/")?e.image_path:`/storage/${e.image_path}`,alt:"chat image",class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:i=>V(e.image_path.startsWith("blob:")||e.image_path.startsWith("/storage/")?e.image_path:`/storage/${e.image_path}`,"image")},null,8,fe)])):w("",!0),e.video_path?(u(),d("div",be,[e.video_path.startsWith("blob:")?(u(),d("div",_e,[...t[7]||(t[7]=[o("i",{class:"fas fa-video text-gray-600 text-2xl"},null,-1)])])):(u(),d("video",{key:1,class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:i=>V(e.video_path.startsWith("blob:")||e.video_path.startsWith("/storage/")?e.video_path:`/storage/${e.video_path}`,"video")},[o("source",{src:e.video_path.startsWith("blob:")||e.video_path.startsWith("/storage/")?e.video_path:`/storage/${e.video_path}`,type:"video/mp4"},null,8,we)],8,xe)),e.video_path.startsWith("blob:")?w("",!0):(u(),d("div",ye,[...t[8]||(t[8]=[o("i",{class:"fas fa-play-circle text-white text-2xl opacity-80"},null,-1)])]))])):w("",!0),e.message?(u(),d("div",{key:2,class:"text-sm text-white",innerHTML:e.message},null,8,ke)):w("",!0)],2)],2)],2))),128))],512),o("div",Ie,[h.value?(u(),d("div",Me,I(p("You have been blocked. You cannot send messages.")),1)):(u(),d(B,{key:1},[o("input",{type:"file",ref_key:"imageInput",ref:N,class:"hidden",onChange:A,accept:"image/*"},null,544),o("button",{type:"button",onClick:t[1]||(t[1]=e=>s.$refs.imageInput.click()),class:"p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-md focus:outline-none border border-white/30 hover:bg-white/70 transition-all",title:p("Upload Image")},[...t[10]||(t[10]=[o("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,Ce),o("input",{type:"file",ref_key:"videoInput",ref:R,class:"hidden",onChange:O,accept:"video/mp4,video/x-matroska"},null,544),o("button",{type:"button",onClick:t[2]||(t[2]=e=>s.$refs.videoInput.click()),class:"p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-md focus:outline-none border border-white/30 hover:bg-white/70 transition-all",title:p("Upload Video")},[...t[11]||(t[11]=[o("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])],8,De),te(o("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>y.value=e),type:"text",placeholder:p("Type your message..."),class:"flex-1 px-3 py-2 rounded-full bg-white/50 backdrop-blur-sm border border-white/30 focus:outline-none focus:ring-2 focus:ring-cyan-400 text-slate-900 placeholder-slate-500 text-sm",onKeydown:ae(oe(W,["exact","prevent"]),["enter"])},null,40,$e),[[se,y.value]]),o("button",{type:"button",onClick:W,class:"p-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-full shadow-md focus:outline-none transition-all duration-200"},[...t[12]||(t[12]=[o("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[o("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])])],64))])]),L.value?(u(),d("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:Y},[o("div",Te,[o("button",{onClick:Y,class:"absolute -top-10 right-0 text-white text-2xl hover:text-gray-300"},[...t[13]||(t[13]=[o("i",{class:"fas fa-times"},null,-1)])]),j.value==="image"?(u(),d("img",{key:0,src:T.value,alt:"Full size image",class:"max-w-full max-h-screen object-contain"},null,8,je)):w("",!0),j.value==="video"?(u(),d("video",{key:1,src:T.value,controls:"",autoplay:"",class:"max-w-full max-h-screen"},null,8,Se)):w("",!0)])])):w("",!0)],64))}};export{Be as _,Ee as a,Ue as b};
