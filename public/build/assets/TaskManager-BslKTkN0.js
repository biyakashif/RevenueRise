import{u as H,r as c,c as K,q as W,E as Q,p as G,w as Y,e as t,a as u,k as m,i as T,m as C,o as d,t as a,F as U,j as P,y as q,n as F}from"./app-CdvAI5iq.js";import{_ as Z}from"./AdminLayout-DZFzOaKL.js";const ee={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},te={class:"mb-6"},se={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},oe={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl rounded-2xl p-6 w-full max-w-md mx-4 border border-white/20 shadow-2xl"},le={class:"text-lg font-semibold mb-4 text-white text-center"},re={class:"mb-4"},ae={class:"mb-4"},ne={key:1,class:"mb-4 p-4 rounded-xl bg-green-100/80 border border-green-200 text-green-700 text-sm text-center backdrop-blur-sm"},ie={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-white/30"},de={class:"overflow-x-auto"},ue={class:"w-full"},ce={class:"p-4 text-sm text-slate-800 font-medium"},me={class:"p-4 text-sm text-slate-700"},pe={class:"p-4 text-sm text-slate-700"},ve={class:"p-4"},he={class:"flex flex-wrap gap-2"},be=["onClick","disabled"],ge=["onClick"],fe=["onClick"],xe=["onClick"],we={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},_e={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl rounded-2xl p-6 w-full max-w-md mx-4 border border-white/20 shadow-2xl overflow-y-auto max-h-[90vh]"},ke={class:"text-lg font-semibold mb-4 text-white text-center"},ye={key:0,class:"text-center text-white/70"},Te={key:1,class:"space-y-3 mb-6"},Ce=["src"],Se={class:"flex-1"},Ee={class:"font-semibold text-sm text-white"},Oe={class:"text-xs text-white/70 mb-1"},Me={class:"flex gap-2 text-xs"},Ae={class:"text-green-300"},Le={class:"text-blue-300"},Ne={class:"text-xs text-white/50 ml-2"},$e={key:0,class:"ml-2 bg-green-500 text-white px-2 py-1 rounded text-xs"},je=["onClick"],Re={__name:"TaskManager",setup(Ue){const S=H(),_=S.props.users,n=c([]),b=c(!1),i=c(null),l=c("");let k=null;const f=c(""),R=K(()=>{if(!_)return[];if(!f.value)return _;const o=f.value.toLowerCase();return _.filter(e=>e.name&&e.name.toLowerCase().includes(o)||e.vip_level&&e.vip_level.toLowerCase().includes(o)||e.mobile_number&&e.mobile_number.includes(o))});function V(o){E(),k=setInterval(()=>{fetch(`/admin/tasks/${o}`).then(e=>e.json()).then(e=>{n.value=e.tasks,i.value=e.user})},2e3)}function E(){k&&clearInterval(k)}async function O(o){const r=await(await fetch(`/admin/tasks/${o}`)).json();n.value=r.tasks,i.value=r.user,b.value=!0,V(o)}function B(){b.value=!1,i.value=null,n.value=[],E()}function X(o,e){F.post(`/admin/tasks/${e}/replace/${o}`,{},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{O(e)},onError:r=>{console.error("Error replacing task:",r),alert("Failed to replace task. See console for details.")}})}async function D(o){try{const e=document.querySelector('meta[name="csrf-token"]'),r=e?e.getAttribute("content"):"";if(!(await fetch(`/admin/tasks/${o}/reset`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({})})).ok)throw new Error("Failed to reset tasks");l.value="Tasks reset and reassigned successfully!",setTimeout(()=>{l.value=""},1e3)}catch(e){l.value="Error: "+e.message,setTimeout(()=>{l.value=""},2e3)}}const p=c(new Set(S.props.assignedUserIds||[]));function I(o){if(p.value.has(o.id)){l.value="Tasks already assigned to this user. Delete tasks first to reassign.",setTimeout(()=>{l.value=""},2e3);return}v.value=o,y.value=!0}async function z(){if(!v.value||g.value<=0){alert("Please enter valid inputs.");return}try{F.post("/admin/tasks/assign",{userId:v.value.id,tasksNumber:g.value,luckyOrder:x.value},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{l.value="Tasks assigned successfully!",p.value.add(v.value.id),setTimeout(()=>{l.value=""},1e3),M()},onError:o=>{l.value="Error: "+(o?JSON.stringify(o):"Unknown error"),setTimeout(()=>{l.value=""},2e3)}})}catch(o){l.value="Error: "+o.message,setTimeout(()=>{l.value=""},2e3)}}async function J(o){try{const e=document.querySelector('meta[name="csrf-token"]'),r=e?e.getAttribute("content"):"";if(!(await fetch(`/admin/tasks/${o}/delete`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({})})).ok)throw new Error("Failed to delete tasks");l.value="Tasks deleted successfully!",p.value.delete(o),setTimeout(()=>{l.value=""},1e3),b.value=!1,n.value=[],i.value=null}catch(e){l.value="Error: "+e.message,setTimeout(()=>{l.value=""},2e3)}}const y=c(!1),v=c(null),g=c(0),x=c(0);function M(){y.value=!1,v.value=null,g.value=0,x.value=0}return W(()=>{window.Echo&&window.Echo.channel("admin.orders").listen(".OrderConfirmed",o=>{if(b.value&&i.value&&o.order.user_id===i.value.id){const e=n.value.findIndex(r=>r.product_id===o.order.product_id);e!==-1&&(n.value[e].status="confirmed")}}),i.value&&Q.private(`orders.${i.value.id}`).listen("OrderConfirmed",o=>{const e=n.value.find(r=>r.id===o.order.task_id);e&&(e.status="Success")})}),(o,e)=>(d(),G(Z,null,{default:Y(()=>{var r,w,A;return[t("div",ee,[e[6]||(e[6]=t("h1",{class:"text-lg font-bold text-slate-800 drop-shadow-sm mb-4"},"Task Manager",-1)),t("div",te,[T(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),type:"text",placeholder:"Search by name, mobile, or VIP level...",class:"w-full h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[C,f.value]])]),y.value?(d(),u("div",se,[t("div",oe,[t("h2",le,"Assign Tasks to "+a((r=v.value)==null?void 0:r.name),1),t("div",re,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-white mb-2"},"Enter Tasks Number",-1)),T(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),type:"number",class:"w-full h-10 rounded-lg bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-3 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[C,g.value]])]),t("div",ae,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-white mb-2"},"Enter Lucky Order",-1)),T(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),type:"number",class:"w-full h-10 rounded-lg bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-3 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[C,x.value]])]),t("div",{class:"flex space-x-2"},[t("button",{onClick:M,class:"flex-1 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-lg text-sm hover:bg-white/30 text-white border border-white/30"}," Cancel "),t("button",{onClick:z,class:"flex-1 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded text-sm hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200"}," Assign ")])])])):m("",!0),l.value?(d(),u("div",ne,a(l.value),1)):m("",!0),t("div",ie,[t("div",de,[t("table",ue,[e[5]||(e[5]=t("thead",null,[t("tr",{class:"bg-white/20 text-slate-700 text-sm font-medium"},[t("th",{class:"p-4 text-left"},"Name"),t("th",{class:"p-4 text-left"},"Mobile Number"),t("th",{class:"p-4 text-left"},"VIP Level"),t("th",{class:"p-4 text-left"},"Actions")])],-1)),t("tbody",null,[(d(!0),u(U,null,P(R.value,s=>(d(),u("tr",{key:s.id,class:"border-t border-white/20 hover:bg-white/10 transition-all duration-200"},[t("td",ce,a(s.name),1),t("td",me,a(s.mobile_number),1),t("td",pe,a(s.vip_level),1),t("td",ve,[t("div",he,[t("button",{onClick:h=>I(s),disabled:p.value.has(s.id),class:q([p.value.has(s.id)?"from-gray-400 to-gray-500":"from-green-500 to-green-600 hover:from-green-600 hover:to-green-700","bg-gradient-to-r text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"])},a(p.value.has(s.id)?"Assigned":"Assign Tasks"),11,be),t("button",{onClick:h=>O(s.id),class:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"},"Tasks Details",8,ge),t("button",{onClick:h=>D(s.id),class:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"},"Reset Task",8,fe),t("button",{onClick:h=>J(s.id),class:"bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 shadow-lg min-w-[100px]"},"Delete Tasks",8,xe)])])]))),128))])])])])]),b.value?(d(),u("div",we,[t("div",_e,[t("h2",ke," Tasks for "+a((w=i.value)==null?void 0:w.name)+" ("+a((A=i.value)==null?void 0:A.vip_level)+") ",1),n.value&&n.value.length===0?(d(),u("div",ye,"No tasks assigned.")):m("",!0),n.value&&n.value.length>0?(d(),u("ul",Te,[(d(!0),u(U,null,P(n.value,s=>{var h,L,N,$,j;return d(),u("li",{key:s.id,class:q(["flex items-center rounded-lg p-3 shadow-sm backdrop-blur-sm border border-white/20",s.product_type==="Lucky Order"?"bg-yellow-100/20":"bg-white/10"])},[t("img",{src:(h=s.product)!=null&&h.image_path?"/storage/"+s.product.image_path:"/default-product.png",alt:"Product",class:"w-10 h-10 object-cover rounded mr-3 border border-white/30"},null,8,Ce),t("div",Se,[t("div",Ee,a((L=s.product)==null?void 0:L.title),1),t("div",Oe,a(s.product_type),1),t("div",Me,[t("span",Ae,"Buy: "+a((N=s.product)==null?void 0:N.purchase_price),1),t("span",Le,"Sell: "+a(($=s.product)==null?void 0:$.selling_price),1)])]),t("div",Ne,"#"+a(s.position),1),s.status&&s.status.toString().trim().toLowerCase()==="confirmed"?(d(),u("span",$e," Confirmed ")):m("",!0),s.product_type!=="Lucky Order"&&s.status!=="confirmed"&&((j=i.value)!=null&&j.id)?(d(),u("button",{key:1,onClick:Pe=>X(s.id,i.value.id),class:"ml-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-2 py-1 rounded text-xs hover:from-blue-600 hover:to-blue-700 transition-all duration-200"}," Apply L/O ",8,je)):m("",!0)],2)}),128))])):m("",!0),t("button",{onClick:B,class:"w-full px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded text-sm hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition-all duration-200"},"Close")])])):m("",!0)]}),_:1}))}};export{Re as default};
