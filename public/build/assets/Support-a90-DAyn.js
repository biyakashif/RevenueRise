import{u as Ce,r as p,c as Me,q as Se,p as Ee,w as H,a as u,k as b,e as a,o as d,b as te,d as y,l as ae,A as j,i as oe,m as ie,F as Q,j as Y,y as L,t as M,g as N,C as De,D as $,B as le,n as ne}from"./app-CdvAI5iq.js";import{_ as Ne}from"./AdminLayout-DZFzOaKL.js";const Ie={key:0,class:"bg-yellow-50 border-b border-yellow-200"},Ue={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},je={class:"flex justify-between items-center mb-4"},Ge={class:"flex space-x-2"},Te={class:"flex h-[calc(100vh-8rem)]"},Ae={class:"w-1/3 border-r border-white/20 overflow-y-auto"},Be={class:"p-2"},Fe=["onClick"],Ke={class:"flex items-center justify-between"},Le={class:"flex items-center space-x-3"},Pe={key:0,class:"w-10 h-10 rounded-full overflow-hidden border flex-shrink-0"},We=["src","alt"],ze={key:1,class:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},Ve={class:"font-medium text-slate-800"},Re={key:0,class:"ml-2 px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full"},qe={class:"text-xs text-slate-600"},He={class:"flex items-center space-x-2"},Qe={key:0,class:"bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center animate-bounce"},Ye={class:"flex flex-col space-y-1"},Je=["onClick"],Oe=["onClick"],Xe=["onClick"],Ze=["onClick"],es=["onClick"],ss={class:"w-2/3 flex flex-col"},ts={key:0,class:"border-b border-white/20 p-3 bg-white/10 backdrop-blur-sm rounded-t-xl"},as={class:"flex items-center space-x-3"},os={key:0,class:"w-10 h-10 rounded-full overflow-hidden border flex-shrink-0"},is=["src","alt"],ls={key:1,class:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},ns={class:"font-medium text-slate-800"},rs={key:0,class:"ml-2 px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full"},ds={key:1,class:"ml-2 px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full"},us={class:"text-xs text-slate-600"},cs={key:0,class:"w-8 h-8 rounded-full overflow-hidden border flex-shrink-0"},gs=["src","alt"],vs={key:1,class:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},_s={key:0,class:"mb-2"},ms=["src","onClick"],hs={key:1,class:"mb-2 relative"},ps=["onClick"],fs=["src"],bs={key:2},ws={key:2,class:"border-t border-white/20 p-3"},ys={key:0,class:"text-center py-4 text-red-600"},xs=["onKeydown"],ks={key:3,class:"flex-1 flex items-center justify-center text-slate-600"},$s={class:"relative max-w-4xl max-h-4xl"},Cs=["src"],Ms=["src"],Ss={key:2,class:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-40"},Es={key:3,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-40"},Ds={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto border border-white/20 shadow-2xl"},Ns={key:0,class:"text-center py-8 text-white/70"},Is={key:1,class:"space-y-3"},Us={class:"font-medium text-white"},js={class:"text-sm text-white/70"},Gs={class:"text-xs text-white/50"},Ts=["onClick"],Ks={__name:"Support",setup(As){const h=Ce(),g=p([]),o=p(null),m=p([]),f=p(new Map),I=p(""),G=p(null),T=p(null),S=p(null),C=new Audio("/notification.mp3"),U=p(!1),P=p(!1),W=p(""),J=p(0),re=p(0),de=Me(()=>{const t=W.value.toLowerCase();return g.value.filter(e=>{const s=e.name?e.name.toLowerCase():"",l=e.mobile_number?e.mobile_number.toString():"";return s.includes(t)||l.includes(t)}).sort((e,s)=>{const l=new Date(e.last_message_at||0);return new Date(s.last_message_at||0)-l})}),A=()=>{if(!P.value){U.value=!0;return}C.play().catch(t=>{console.error("Error playing notification sound:",t),U.value=!0})},z=async(t=!1)=>{const e=Date.now();if(!(!t&&e-J.value<1e3))try{J.value=e;const[s,l]=await Promise.all([$.get("/admin/chat/users"),$.get("/admin/guest-chat/users")]),n=(s.data||[]).map(r=>({...r,mobile_number:r.mobile_number!=null?String(r.mobile_number):r.mobile_number,unread_count:r.unread_count??0,is_guest:!1,is_blocked:r.is_blocked||!1})),i=(l.data||[]).map(r=>({...r,mobile_number:r.mobile_number!=null?String(r.mobile_number):r.mobile_number,unread_count:r.unread_count??0,is_guest:!0,last_message_at:r.last_message_at})),v=[...n,...i],c=new Map;v.forEach(r=>{const k=`${r.is_guest?"guest":"user"}-${r.id}`;c.set(k,r)}),g.value.filter(r=>r.is_guest&&!i.some(k=>k.id===r.id)).forEach(r=>{const k=`guest-${r.id}`;c.has(k)||c.set(k,r)});const _=Array.from(c.values());g.value.length>0&&_.forEach(r=>{const k=g.value.find(se=>se.id===r.id&&se.is_guest===r.is_guest);k&&(r.unread_count||0)>(k.unread_count||0)&&(A(),"Notification"in window&&Notification.permission==="granted"&&new Notification("New Support Message",{body:`New message from ${r.name||"User"}`,icon:"/favicon.ico"}))}),g.value=_}catch(s){console.error("Error loading users:",s)}},w=new Set,E=()=>{le(()=>{S.value&&(S.value.scrollTop=S.value.scrollHeight)})},ue=async t=>{try{o.value=t,re.value=Date.now();const e=`${t.is_guest?"guest":"user"}-${t.id}`;f.value.has(e)?m.value=f.value.get(e):m.value=[],w.clear(),m.value.forEach(l=>{w.add(String(l.id))});const s=g.value.findIndex(l=>l.id===t.id&&l.is_guest===t.is_guest);if(s!==-1){const l=g.value[s];l.unread_count=0,g.value.splice(s,1,{...l})}if(f.value.has(e)&&le(()=>{S.value&&(S.value.scrollTop=S.value.scrollHeight)}),!f.value.has(e)){let l;t.is_guest?l=`/admin/guest-chat/${t.id.replace("guest_","")}/messages`:l=`/admin/chat/${t.id}/messages`,$.get(l).then(n=>{var i,v;if(((i=o.value)==null?void 0:i.id)===t.id&&((v=o.value)==null?void 0:v.is_guest)===t.is_guest){const c=n.data.sort((_,r)=>new Date(_.created_at)-new Date(r.created_at));m.value=c,f.value.set(e,c),w.clear(),c.forEach(_=>{w.add(String(_.id))}),E()}}).catch(n=>{console.error("Error loading messages:",n)})}}catch(e){console.error("Error selecting user:",e)}},O=async()=>{var e,s;const t=I.value;try{if(!I.value.trim()&&!((e=G.value)!=null&&e.files[0])&&!((s=T.value)!=null&&s.files[0])||o.value.is_blocked)return;I.value="";let l;o.value.is_guest?l=`/admin/guest-chat/${o.value.id.replace("guest_","")}/broadcast`:l=`/admin/chat/${o.value.id}/broadcast`;const i=(await $.post(l,{message:t,recipient_id:o.value.id})).data;if(i&&i.id){const v={id:i.id,message:t,image_path:null,video_path:null,created_at:i.created_at,sender_id:h.props.auth.user.id,recipient_id:o.value.id};if(!w.has(String(i.id))){m.value.push(v),m.value.sort((_,r)=>new Date(_.created_at)-new Date(r.created_at));const c=`${o.value.is_guest?"guest":"user"}-${o.value.id}`;f.value.set(c,[...m.value]),E(),w.add(String(i.id))}}G.value&&(G.value.value=""),T.value&&(T.value.value="")}catch(l){I.value=t,console.error("Error sending message:",l),alert("Error sending message. Please try again.")}},ce=async t=>{try{const e=t.target.files[0];if(!e||o.value.is_blocked)return;const s=new FormData;s.append("image",e);let l;o.value.is_guest?l=`/admin/guest-chat/${o.value.id.replace("guest_","")}/send`:l=`/admin/chat/${o.value.id}/send`;const i=(await $.post(l,s)).data;if(i&&i.id){const v={id:i.id,message:i.message||"",image_path:i.image_path,video_path:null,created_at:i.created_at,sender_id:h.props.auth.user.id,recipient_id:o.value.id};if(!w.has(String(i.id))){m.value.push(v),m.value.sort((_,r)=>new Date(_.created_at)-new Date(r.created_at));const c=`${o.value.is_guest?"guest":"user"}-${o.value.id}`;f.value.set(c,[...m.value]),E(),w.add(String(i.id))}}t.target.value=""}catch(e){console.error("Error uploading image:",e),alert("Error uploading image. Please try again.")}},X=p(""),ge=async t=>{const e=t.target.files[0];if(e&&e.size>30*1024*1024){X.value="The video file size must not exceed 30MB.",t.target.value="";return}X.value="";try{if(o.value.is_blocked)return;const s=new FormData;s.append("video",e);let l;o.value.is_guest?l=`/admin/guest-chat/${o.value.id.replace("guest_","")}/send`:l=`/admin/chat/${o.value.id}/send`;const i=(await $.post(l,s)).data;if(i&&i.id){const v={id:i.id,message:i.message||"",image_path:null,video_path:i.video_path,created_at:i.created_at,sender_id:h.props.auth.user.id,recipient_id:o.value.id};if(!w.has(String(i.id))){m.value.push(v),m.value.sort((_,r)=>new Date(_.created_at)-new Date(r.created_at));const c=`${o.value.is_guest?"guest":"user"}-${o.value.id}`;f.value.set(c,[...m.value]),E(),w.add(String(i.id))}}t.target.value=""}catch(s){console.error("Error uploading video:",s),alert("Error uploading video. Please try again.")}},V=t=>{if(t&&t.target){t.target.style.display="none";const e=t.target.parentElement;e&&(e.innerHTML='<i class="fas fa-user text-gray-400"></i>',e.classList.add("flex","items-center","justify-center"))}};Se(()=>{C.src="/notification.mp3",C.load(),localStorage.getItem("soundEnabled")==="1"?P.value=!0:U.value=!0,"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission(),z(!0),window.Echo?(console.log("ðŸ”„ Setting up Echo listeners for admin chat..."),window.Echo.private(`chat.${h.props.auth.user.id}`).listen("NewChatMessage",e=>{if(console.log("ðŸ“¨ Received NewChatMessage event:",e),!(String(e.chat.sender_id)===String(h.props.auth.user.id))){A(),"Notification"in window&&Notification.permission==="granted"&&new Notification("New Support Message",{body:"New message from user",icon:"/favicon.ico"});let l=g.value.findIndex(n=>n.id===e.chat.sender_id&&!n.is_guest);if(l===-1){const n={id:e.chat.sender_id,name:`User ${e.chat.sender_id}`,mobile_number:"",avatar_url:null,unread_count:1,is_guest:!1,last_message_at:e.chat.created_at};g.value.push(n),console.log("ðŸ‘¥ Created new user from message:",n)}else{const n=g.value[l];n.last_message_at=e.chat.created_at;const i=`user-${n.id}`;if(o.value&&!o.value.is_guest&&o.value.id===n.id){if(!w.has(String(e.chat.id))){const v={id:e.chat.id,message:e.chat.message,image_path:e.chat.image_path,video_path:e.chat.video_path,created_at:e.chat.created_at,sender_id:e.chat.sender_id,recipient_id:e.chat.recipient_id};m.value.push(v),m.value.sort((c,_)=>new Date(c.created_at)-new Date(_.created_at)),f.value.set(i,[...m.value]),E(),w.add(String(e.chat.id)),console.log("ðŸ“¨ Added user message to chat:",v)}n.unread_count=0}else{const v=f.value.get(i)||[];if(!v.some(c=>c.id===e.chat.id)){const c={id:e.chat.id,message:e.chat.message,image_path:e.chat.image_path,video_path:e.chat.video_path,created_at:e.chat.created_at,sender_id:e.chat.sender_id,recipient_id:e.chat.recipient_id};v.push(c),v.sort((_,r)=>new Date(_.created_at)-new Date(r.created_at)),f.value.set(i,v)}n.unread_count=(n.unread_count||0)+1}g.value.splice(l,1,{...n})}}}).listen("NewGuestChatMessage",e=>{if(console.log("ðŸ“¨ Received NewGuestChatMessage on admin chat channel:",e),e.message&&e.message.sender_id&&e.message.is_guest){const s=String(e.message.sender_id)===String(h.props.auth.user.id),l=D.value.some(n=>n.session_id===e.message.sender_id);if(!s&&!l){A(),"Notification"in window&&Notification.permission==="granted"&&new Notification("New Support Message",{body:"New message from guest",icon:"/favicon.ico"});let n=g.value.findIndex(i=>i.id===e.message.sender_id&&i.is_guest);if(n===-1){const i={id:e.message.sender_id,name:e.message.guest_name||`Guest ${e.message.sender_id.substring(0,8)}`,mobile_number:e.message.guest_mobile||"N/A",avatar_url:null,unread_count:1,is_guest:!0,is_blocked:!1,last_message_at:e.message.created_at};g.value.push(i),console.log("ðŸ‘¥ Created new guest user from admin chat channel:",i)}else{const i=g.value[n];i.last_message_at=e.message.created_at;const v=`guest-${i.id}`;if(o.value&&o.value.is_guest&&o.value.id===i.id){if(!w.has(String(e.message.id))){const c={id:e.message.id,message:e.message.message,image_path:e.message.image_path||(e.message.is_image?e.message.message:null),video_path:e.message.video_path||null,created_at:e.message.created_at,sender_id:e.message.sender_id,recipient_id:h.props.auth.user.id};m.value.push(c),m.value.sort((_,r)=>new Date(_.created_at)-new Date(r.created_at)),f.value.set(v,[...m.value]),E(),w.add(String(e.message.id)),console.log("ðŸ“¨ Added guest message from admin chat channel:",c)}i.unread_count=0}else{const c=f.value.get(v)||[];if(!c.some(_=>_.id===e.message.id)){const _={id:e.message.id,message:e.message.message,image_path:e.message.image_path||(e.message.is_image?e.message.message:null),video_path:e.message.video_path||null,created_at:e.message.created_at,sender_id:e.message.sender_id,recipient_id:h.props.auth.user.id};c.push(_),c.sort((r,k)=>new Date(r.created_at)-new Date(k.created_at)),f.value.set(v,c)}i.unread_count=(i.unread_count||0)+1}g.value.splice(n,1,{...i})}}}}),window.Echo.private("guest-chat").listen("NewGuestChatMessage",e=>{if(console.log("ðŸ“¨ Received NewGuestChatMessage event:",e),e.message&&e.message.sender_id){const s=String(e.message.sender_id)===String(h.props.auth.user.id);if(e.message.is_guest===!0&&!s){A(),"Notification"in window&&Notification.permission==="granted"&&new Notification("New Support Message",{body:"New message from guest",icon:"/favicon.ico"});let n=g.value.findIndex(i=>i.id===e.message.sender_id&&i.is_guest);if(n===-1){const i={id:e.message.sender_id,name:e.message.guest_name||`Guest ${e.message.sender_id.substring(0,8)}`,mobile_number:e.message.guest_mobile||"N/A",avatar_url:null,unread_count:1,is_guest:!0,is_blocked:!1,last_message_at:e.message.created_at};g.value.push(i),console.log("ðŸ‘¥ Created new guest user from message:",i)}else{const i=g.value[n];i.last_message_at=e.message.created_at;const v=`guest-${i.id}`;if(o.value&&o.value.is_guest&&o.value.id===i.id){if(!w.has(String(e.message.id))){const c={id:e.message.id,message:e.message.message,image_path:e.message.image_path||(e.message.is_image?e.message.message:null),video_path:e.message.video_path||null,created_at:e.message.created_at,sender_id:e.message.sender_id,recipient_id:h.props.auth.user.id};m.value.push(c),m.value.sort((_,r)=>new Date(_.created_at)-new Date(r.created_at)),f.value.set(v,[...m.value]),E(),w.add(String(e.message.id)),console.log("ðŸ“¨ Added guest message to chat:",c)}i.unread_count=0}else{const c=f.value.get(v)||[];if(!c.some(_=>_.id===e.message.id)){const _={id:e.message.id,message:e.message.message,image_path:e.message.image_path||(e.message.is_image?e.message.message:null),video_path:e.message.video_path||null,created_at:e.message.created_at,sender_id:e.message.sender_id,recipient_id:h.props.auth.user.id};c.push(_),c.sort((r,k)=>new Date(r.created_at)-new Date(k.created_at)),f.value.set(v,c)}i.unread_count=(i.unread_count||0)+1}g.value.splice(n,1,{...i})}}}}),window.Echo.private(`chat.${h.props.auth.user.id}`).listen("ChatDeleted",e=>{var s,l;if(console.log("ðŸ—‘ï¸ Chat deleted:",e),g.value=g.value.filter(n=>e.is_guest?!(n.id===e.user_id&&n.is_guest):!(n.id===e.user_id&&!n.is_guest)),((s=o.value)==null?void 0:s.id)===e.user_id&&((l=o.value)==null?void 0:l.is_guest)===e.is_guest){o.value=null,m.value=[];const n=`${e.is_guest?"guest":"user"}-${e.user_id}`;f.value.delete(n)}}),console.log("âœ… Echo listeners set up successfully")):console.log("âŒ Echo not available, using polling fallback only");const t=()=>{C.play().then(()=>{C.pause(),C.currentTime=0}).catch(()=>{}),window.removeEventListener("click",t),window.removeEventListener("keydown",t),window.removeEventListener("touchstart",t)};return window.addEventListener("click",t),window.addEventListener("keydown",t),window.addEventListener("touchstart",t),()=>{}});const ve=()=>{C.play().then(()=>{C.pause(),C.currentTime=0,P.value=!0,U.value=!1,localStorage.setItem("soundEnabled","1")}).catch(()=>{U.value=!0})},B=p(!1),x=p(null),R=p(!1),F=p(""),K=p(""),q=p(!1),D=p([]),_e=t=>{x.value=t,B.value=!0},me=()=>{x.value=null,B.value=!1},he=async()=>{var t,e;if(x.value)try{let s;if(x.value.is_guest?s=`/admin/guest-chat/${x.value.id.replace("guest_","")}/delete-history`:s=`/admin/chat/${x.value.id}/delete-history`,await $.delete(s),g.value=g.value.filter(l=>x.value.is_guest?!(l.id===x.value.id&&l.is_guest):!(l.id===x.value.id&&!l.is_guest)),((t=o.value)==null?void 0:t.id)===x.value.id&&((e=o.value)==null?void 0:e.is_guest)===x.value.is_guest){o.value=null,m.value=[];const l=`${x.value.is_guest?"guest":"user"}-${x.value.id}`;f.value.delete(l)}B.value=!1,x.value=null,setTimeout(()=>z(!0),500)}catch(s){console.error("Error deleting chat history:",s),alert("Failed to delete chat history. Please try again.")}},pe=async t=>{var e;try{const s=t.id.replace("guest_","");await $.post(`/admin/guest-chat/${s}/block`),g.value=g.value.filter(n=>n.id!==t.id),((e=o.value)==null?void 0:e.id)===t.id&&(o.value=null,m.value=[]);const l=`guest-${t.id}`;f.value.delete(l)}catch(s){console.error("Error blocking user:",s),alert("Failed to block user. Please try again.")}},fe=async t=>{var e;try{const s=t.id.replace("guest_","");await $.post(`/admin/guest-chat/${s}/unblock`),z(),((e=o.value)==null?void 0:e.id)===t.id&&(o.value={...o.value,is_blocked:!1})}catch(s){console.error("Error unblocking user:",s),alert("Failed to unblock user. Please try again.")}},be=async()=>{try{const t=await $.get("/admin/guest-chat/blocked");D.value=t.data,q.value=!0}catch(t){console.error("Error loading blocked guests:",t)}},we=()=>{q.value=!1,D.value=[]},ye=async t=>{try{await $.post(`/admin/guest-chat/${t}/unblock`),D.value=D.value.filter(e=>e.session_id!==t)}catch(e){console.error("Error unblocking guest:",e),alert("Failed to unblock guest. Please try again.")}},xe=t=>new Date(t).toLocaleString(),Z=(t,e)=>{F.value=t,K.value=e,R.value=!0},ee=()=>{R.value=!1,F.value="",K.value=""},ke=async t=>{if(confirm(`Are you sure you want to block ${t.name}?`))try{await ne.post(route("admin.users.block",t.id),{},{preserveScroll:!0,onSuccess:()=>{const e=g.value.findIndex(s=>s.id===t.id&&!s.is_guest);e!==-1&&(g.value[e].is_blocked=!0)}})}catch(e){console.error("Error blocking user:",e)}},$e=async t=>{if(confirm(`Are you sure you want to unblock ${t.name}?`))try{await ne.post(route("admin.users.unblock",t.id),{},{preserveScroll:!0,onSuccess:()=>{const e=g.value.findIndex(s=>s.id===t.id&&!s.is_guest);e!==-1&&(g.value[e].is_blocked=!1)}})}catch(e){console.error("Error unblocking user:",e)}};return(t,e)=>(d(),Ee(Ne,null,{default:H(()=>[U.value?(d(),u("div",Ie,[a("div",{class:"max-w-7xl mx-auto px-4 py-2 flex items-center justify-between text-sm"},[e[4]||(e[4]=a("div",{class:"text-yellow-800 flex items-center space-x-2"},[a("i",{class:"fas fa-bell mr-1"}),a("span",null,"Click enable to allow sound notifications.")],-1)),a("button",{onClick:ve,class:"px-3 py-1 bg-yellow-600 text-white rounded hover:bg-yellow-700"},"Enable sound")])])):b("",!0),a("div",Ue,[a("div",je,[e[8]||(e[8]=a("h1",{class:"text-lg font-bold text-slate-800 drop-shadow-sm"},"Support Chat",-1)),a("div",Ge,[te(y(ae),{href:t.route("admin.auto-reply"),class:"px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm transition-all duration-200"},{default:H(()=>[...e[5]||(e[5]=[a("i",{class:"fas fa-robot mr-1"},null,-1),j(" Auto Reply ",-1)])]),_:1},8,["href"]),te(y(ae),{href:t.route("admin.blocked-users"),class:"px-3 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm transition-all duration-200"},{default:H(()=>[...e[6]||(e[6]=[a("i",{class:"fas fa-user-slash mr-1"},null,-1),j(" Block User ",-1)])]),_:1},8,["href"]),a("button",{onClick:be,class:"px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm transition-all duration-200"},[...e[7]||(e[7]=[a("i",{class:"fas fa-ban mr-1"},null,-1),j(" Blocked Guests ",-1)])])])]),a("div",Te,[a("div",Ae,[a("div",Be,[oe(a("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>W.value=s),placeholder:"Search by name or mobile number",class:"w-full h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[ie,W.value]])]),(d(!0),u(Q,null,Y(de.value,s=>{var l;return d(),u("div",{key:`${s.is_guest?"guest":"user"}-${s.id}`,onClick:n=>ue(s),class:L(["relative p-4 hover:bg-white/10 cursor-pointer transition-all duration-200 rounded-xl mx-2 mb-2",{"bg-white/20":((l=o.value)==null?void 0:l.id)===s.id,"opacity-60":s.is_blocked,"border-l-4 border-red-500":s.is_blocked}])},[a("div",Ke,[a("div",Le,[s.avatar_url?(d(),u("div",Pe,[a("img",{src:s.avatar_url.startsWith("/storage")||s.avatar_url.startsWith("/assets")?s.avatar_url:`/storage/${s.avatar_url}`,alt:s.name,class:"w-full h-full object-cover",onError:V},null,40,We)])):(d(),u("div",ze,[...e[9]||(e[9]=[a("i",{class:"fas fa-user text-gray-400"},null,-1)])])),a("div",null,[a("div",Ve,[j(M(s.name)+" ",1),s.is_guest?(d(),u("span",Re,"Guest")):b("",!0)]),a("div",qe,M(s.mobile_number),1)])]),a("div",He,[s.unread_count?(d(),u("div",Qe,M(s.unread_count),1)):b("",!0),a("div",Ye,[s.is_guest&&!s.is_blocked?(d(),u("button",{key:0,onClick:N(n=>pe(s),["stop"]),class:"text-orange-500 text-xs hover:underline"}," Block ",8,Je)):b("",!0),s.is_guest&&s.is_blocked?(d(),u("button",{key:1,onClick:N(n=>fe(s),["stop"]),class:"text-green-500 text-xs hover:underline"}," Unblock ",8,Oe)):b("",!0),!s.is_guest&&!s.is_blocked?(d(),u("button",{key:2,onClick:N(n=>ke(s),["stop"]),class:"text-orange-500 text-xs hover:underline"}," Block User ",8,Xe)):b("",!0),!s.is_guest&&s.is_blocked?(d(),u("button",{key:3,onClick:N(n=>$e(s),["stop"]),class:"text-green-500 text-xs hover:underline"}," Unblock User ",8,Ze)):b("",!0),a("button",{onClick:N(n=>_e(s),["stop"]),class:"text-red-500 text-xs hover:underline"}," Delete Chat ",8,es)])])])],10,Fe)}),128))]),a("div",ss,[o.value?(d(),u("div",ts,[a("div",as,[o.value.avatar_url?(d(),u("div",os,[a("img",{src:o.value.avatar_url.startsWith("/storage")||o.value.avatar_url.startsWith("/assets")?o.value.avatar_url:`/storage/${o.value.avatar_url}`,alt:o.value.name,class:"w-full h-full object-cover border",onError:V},null,40,is)])):(d(),u("div",ls,[...e[10]||(e[10]=[a("i",{class:"fas fa-user text-gray-400"},null,-1)])])),a("div",null,[a("div",ns,[j(M(o.value.name)+" ",1),o.value.is_guest?(d(),u("span",rs,"Guest")):b("",!0),o.value.is_blocked?(d(),u("span",ds,"Blocked")):b("",!0)]),a("div",us,M(o.value.mobile_number),1)])])])):b("",!0),o.value?(d(),u("div",{key:1,ref_key:"chatContainer",ref:S,class:"flex-1 overflow-y-auto p-3"},[(d(!0),u(Q,null,Y(m.value,s=>(d(),u("div",{key:s.id,class:L(["mb-3 flex",{"justify-end":s.sender_id===y(h).props.auth.user.id,"justify-start":s.sender_id!==y(h).props.auth.user.id}])},[a("div",{class:L(["flex items-start space-x-2 max-w-2xl",s.sender_id===y(h).props.auth.user.id?"flex-row-reverse space-x-reverse":""])},[s.sender_id===y(h).props.auth.user.id&&y(h).props.auth.user.avatar_url||s.sender_id!==y(h).props.auth.user.id&&o.value.avatar_url?(d(),u("div",cs,[a("img",{src:s.sender_id===y(h).props.auth.user.id?y(h).props.auth.user.avatar_url.startsWith("/storage")||y(h).props.auth.user.avatar_url.startsWith("/assets")?y(h).props.auth.user.avatar_url:`/storage/${y(h).props.auth.user.avatar_url}`:o.value.avatar_url.startsWith("/storage")||o.value.avatar_url.startsWith("/assets")?o.value.avatar_url:`/storage/${o.value.avatar_url}`,alt:s.sender_id===y(h).props.auth.user.id?"You":o.value.name,class:"w-full h-full object-cover",onError:V},null,40,gs)])):(d(),u("div",vs,[...e[11]||(e[11]=[a("i",{class:"fas fa-user text-gray-400 text-xs"},null,-1)])])),a("div",{class:L(["rounded-lg p-3",s.sender_id===y(h).props.auth.user.id?"bg-purple-100":"bg-gray-100"])},[s.image_path?(d(),u("div",_s,[a("img",{src:s.image_path,alt:"chat image",class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:l=>Z(s.image_path,"image")},null,8,ms)])):b("",!0),s.video_path?(d(),u("div",hs,[a("video",{class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:l=>Z(s.video_path,"video")},[a("source",{src:s.video_path,type:"video/mp4"},null,8,fs)],8,ps),e[12]||(e[12]=a("div",{class:"absolute inset-0 flex items-center justify-center pointer-events-none"},[a("i",{class:"fas fa-play-circle text-white text-2xl opacity-80"})],-1))])):b("",!0),s.message?(d(),u("p",bs,M(s.message),1)):b("",!0)],2)],2)],2))),128))],512)):b("",!0),o.value?(d(),u("div",ws,[o.value.is_blocked?(d(),u("div",ys," This user is blocked. Unblock to send messages. ")):(d(),u("form",{key:1,onSubmit:N(O,["prevent"]),class:"flex space-x-2"},[a("input",{type:"file",ref_key:"imageInput",ref:G,class:"hidden",onChange:ce,accept:"image/*"},null,544),a("button",{type:"button",onClick:e[1]||(e[1]=s=>t.$refs.imageInput.click()),class:"px-4 py-2 bg-white/20 backdrop-blur-sm rounded-lg hover:bg-white/30 transition-all duration-200 text-slate-700"},[...e[13]||(e[13]=[a("i",{class:"fas fa-image"},null,-1)])]),a("input",{type:"file",ref_key:"videoInput",ref:T,class:"hidden",onChange:ge,accept:"video/mp4,video/x-matroska"},null,544),a("button",{type:"button",onClick:e[2]||(e[2]=s=>t.$refs.videoInput.click()),class:"px-4 py-2 bg-white/20 backdrop-blur-sm rounded-lg hover:bg-white/30 transition-all duration-200 text-slate-700"},[...e[14]||(e[14]=[a("i",{class:"fas fa-video"},null,-1)])]),oe(a("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>I.value=s),type:"text",placeholder:"Type your message...",class:"flex-1 h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg",onKeydown:De(N(O,["exact","prevent"]),["enter"])},null,40,xs),[[ie,I.value]]),e[15]||(e[15]=a("button",{type:"submit",class:"px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg transition-all duration-300 transform hover:scale-[1.02] shadow-lg"}," Send ",-1))],32))])):(d(),u("div",ks," Select a user to start chatting "))])])]),R.value?(d(),u("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:ee},[a("div",$s,[a("button",{onClick:ee,class:"absolute -top-10 right-0 text-white text-2xl hover:text-gray-300"},[...e[16]||(e[16]=[a("i",{class:"fas fa-times"},null,-1)])]),K.value==="image"?(d(),u("img",{key:0,src:F.value,alt:"Full size image",class:"max-w-full max-h-screen object-contain"},null,8,Cs)):b("",!0),K.value==="video"?(d(),u("video",{key:1,src:F.value,controls:"",autoplay:"",class:"max-w-full max-h-screen"},null,8,Ms)):b("",!0)])])):b("",!0),B.value?(d(),u("div",Ss,[a("div",{class:"bg-white p-6 rounded shadow-lg"},[e[17]||(e[17]=a("h3",{class:"text-lg font-semibold mb-4"},"Confirm Deletion",-1)),e[18]||(e[18]=a("p",null,"Are you sure you want to delete all chat history with this user?",-1)),a("div",{class:"mt-4 flex justify-end space-x-2"},[a("button",{onClick:me,class:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"},"Cancel"),a("button",{onClick:he,class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"},"Delete")])])])):b("",!0),q.value?(d(),u("div",Es,[a("div",Ds,[a("div",{class:"flex justify-between items-center mb-4"},[e[20]||(e[20]=a("h3",{class:"text-lg font-semibold text-white"},"Blocked Guests",-1)),a("button",{onClick:we,class:"text-white/70 hover:text-white"},[...e[19]||(e[19]=[a("i",{class:"fas fa-times"},null,-1)])])]),D.value.length===0?(d(),u("div",Ns," No blocked guests ")):(d(),u("div",Is,[(d(!0),u(Q,null,Y(D.value,s=>(d(),u("div",{key:s.id,class:"flex items-center justify-between p-3 bg-white/10 backdrop-blur-sm rounded-lg border border-white/20"},[a("div",null,[a("div",Us,M(s.name),1),a("div",js,M(s.mobile_number),1),a("div",Gs,"Blocked: "+M(xe(s.blocked_at)),1)]),a("button",{onClick:l=>ye(s.session_id),class:"px-3 py-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded text-sm transform hover:scale-105 transition-all duration-200"}," Unblock ",8,Ts)]))),128))]))])])):b("",!0)]),_:1}))}};export{Ks as default};
