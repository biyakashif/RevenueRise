import{a as u,d as J,o as c,e as o,u as Q,c as X,r as f,s as Z,g as ee,m as w,t as k,F as V,k as te,z as R,j as se,n as ae,C as oe,i as ie,D as M}from"./app-C5R0GNTt.js";const ne="/build/assets/logo-z9KSseR9.png",le=["src"],ze={__name:"ApplicationLogo",setup(C){return(D,l)=>(c(),u("img",{src:J(ne),alt:"Logo",class:"block h-9 w-auto object-contain"},null,8,le))}},re=["title"],Be={__name:"FloatingChatIcon",props:{title:{type:String,default:"Help & Support"}},emits:["click"],setup(C){return(D,l)=>(c(),u("button",{onClick:l[0]||(l[0]=T=>D.$emit("click")),class:"floating-help-btn fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-full flex items-center justify-center transition-all duration-300 transform hover:scale-110 z-50",title:C.title},[...l[1]||(l[1]=[o("i",{class:"fas fa-headset text-lg"},null,-1)])],8,re))}},de={class:"absolute inset-0 flex flex-col"},ue={class:"flex items-center justify-between px-4 py-3 bg-gradient-to-br from-cyan-400/30 via-blue-500/25 to-indigo-600/30 backdrop-blur-xl text-white shadow-md border-b border-cyan-300/30 rounded-t-2xl sm:rounded-t-3xl"},ce={class:"text-lg text-blue-500 font-semibold"},pe={key:0,class:"flex items-center justify-center h-full"},ge={class:"text-center py-8 px-4 bg-red-50 rounded-lg border border-red-200"},me={class:"text-lg font-semibold text-red-800 mb-2"},he={class:"text-red-600"},ve={key:1,class:"flex items-center justify-center h-full text-slate-600"},fe={key:0,class:"mb-2"},be=["src","onClick"],_e={key:1,class:"mb-2 relative"},xe={key:0,class:"w-32 h-32 bg-gray-200 rounded flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity"},we=["onClick"],ye=["src"],ke={key:2,class:"absolute inset-0 flex items-center justify-center pointer-events-none"},Ie={key:2,class:"text-sm text-white whitespace-pre-wrap"},Me={class:"border-t border-cyan-300/30 p-2 sm:p-3 bg-gradient-to-br from-cyan-400/30 via-blue-500/25 to-indigo-600/30 backdrop-blur-xl rounded-b-2xl sm:rounded-b-3xl"},Ce={key:0,class:"w-full text-center py-4 text-red-600 bg-red-50 rounded-lg"},De={key:1,class:"flex items-center space-x-1 sm:space-x-2"},$e=["title"],je=["title"],Le=["placeholder","onKeydown"],Te={class:"relative max-w-4xl max-h-4xl"},Ue=["src"],Se=["src"],Ee={__name:"GuestChatInterface",props:{sessionId:String,guestInfo:Object},emits:["close"],setup(C,{emit:D}){const l=C,T=D,Y=Q(),F=X(()=>Y.props.translations||{}),g=s=>F.value[s]||s,a=f([]),y=f(""),$=f(null),N=f(null),A=f(null),U=f(!1),j=f(""),L=f(""),z=new Audio("/notification.mp3"),v=f(!1);let I=null,_=null;const b=()=>{setTimeout(()=>{$.value&&($.value.scrollTop=$.value.scrollHeight)},100)},B=async()=>{var s;if(l.sessionId)try{const e=(await M.get(`/guest-chat/${l.sessionId}/messages`)).data.sort((d,p)=>new Date(d.created_at)-new Date(p.created_at)),i=a.value.filter(d=>d.isTemp),n=new Set(a.value.filter(d=>!d.isTemp).map(d=>d.id)),r=e.filter(d=>!n.has(d.id));if(r.length>0){const d=r.some(h=>!h.is_guest),p=a.value.filter(h=>!h.isTemp);a.value=[...p,...r,...i].sort((h,S)=>new Date(h.created_at)-new Date(S.created_at)),d&&z.play().catch(()=>{}),b()}}catch(t){((s=t.response)==null?void 0:s.status)===404&&(W(),T("close"))}},E=async()=>{var t,e,i;if(!y.value.trim()||!l.sessionId||v.value)return;const s=y.value;y.value="";try{const n=await M.post(`/guest-chat/${l.sessionId}/broadcast`,{message:s,guest_name:(t=l.guestInfo)==null?void 0:t.name,guest_mobile:(e=l.guestInfo)==null?void 0:e.mobile_number}),r={id:n.data.id,message:s,is_guest:!0,created_at:n.data.created_at};a.value.some(p=>p.id===r.id)||(a.value.push(r),a.value.sort((p,h)=>new Date(p.created_at)-new Date(h.created_at)),b()),v.value=!1}catch(n){y.value=s,((i=n.response)==null?void 0:i.status)===403&&(v.value=!0)}},H=async s=>{var t,e;try{const i=s.target.files[0];if(!i||v.value)return;if(i.size>5*1024*1024){alert(g("Image file size must not exceed 5MB.")),s.target.value="";return}const n=URL.createObjectURL(i),r={id:"temp_"+Date.now(),message:"",is_guest:!0,image_path:n,video_path:null,created_at:new Date().toISOString(),isTemp:!0};a.value.push(r),a.value.sort((m,x)=>new Date(m.created_at)-new Date(x.created_at)),b();const d=new FormData;d.append("image",i);const p=await M.post(`/guest-chat/${l.sessionId}/send`,d);a.value=a.value.filter(m=>!m.isTemp);const h={id:p.data.id,message:p.data.message||"",is_guest:!0,image_path:p.data.image_path,video_path:null,created_at:p.data.created_at};a.value.some(m=>m.id===h.id)||(a.value.push(h),a.value.sort((m,x)=>new Date(m.created_at)-new Date(x.created_at)),b()),URL.revokeObjectURL(n),s.target.value=""}catch(i){console.error("Error uploading image:",i),((t=i.response)==null?void 0:t.status)===403?(v.value=!0,alert(g("You have been blocked and cannot send messages."))):alert(g("Error uploading image. Please try again."));const n=a.value.findIndex(r=>r.isTemp);if(n>-1){const r=a.value[n];(e=r.image_path)!=null&&e.startsWith("blob:")&&URL.revokeObjectURL(r.image_path),a.value.splice(n,1)}}},K=async s=>{var t,e;try{const i=s.target.files[0];if(!i||v.value)return;if(i.size>30*1024*1024){alert(g("Video file size must not exceed 30MB.")),s.target.value="";return}const n=URL.createObjectURL(i),r={id:"temp_"+Date.now(),message:"",is_guest:!0,image_path:null,video_path:n,created_at:new Date().toISOString(),isTemp:!0};a.value.push(r),a.value.sort((m,x)=>new Date(m.created_at)-new Date(x.created_at)),b();const d=new FormData;d.append("video",i);const p=await M.post(`/guest-chat/${l.sessionId}/send`,d);a.value=a.value.filter(m=>!m.isTemp);const h={id:p.data.id,message:p.data.message||"",is_guest:!0,image_path:null,video_path:p.data.video_path,created_at:p.data.created_at};a.value.some(m=>m.id===h.id)||(a.value.push(h),a.value.sort((m,x)=>new Date(m.created_at)-new Date(x.created_at)),b()),URL.revokeObjectURL(n),s.target.value=""}catch(i){console.error("Error uploading video:",i),((t=i.response)==null?void 0:t.status)===403?(v.value=!0,alert(g("You have been blocked and cannot send messages."))):alert(g("Error uploading video. Please try again."));const n=a.value.findIndex(r=>r.isTemp);if(n>-1){const r=a.value[n];(e=r.video_path)!=null&&e.startsWith("blob:")&&URL.revokeObjectURL(r.video_path),a.value.splice(n,1)}}},P=()=>{if(l.sessionId){if(window.Echo)try{_=window.Echo.channel(`guest-chat.${l.sessionId}`),_.listen("NewGuestChatMessage",s=>{if(console.log("ðŸ“¨ Guest received NewGuestChatMessage:",s),s.message&&s.message.is_guest&&s.message.sender_id===l.sessionId){console.log("â­ï¸ Skipping own message to avoid duplicate"),a.value=a.value.filter(i=>!i.isTemp);const t={id:s.message.id,message:s.message.message,is_guest:!0,created_at:s.message.created_at,image_path:s.message.image_path||null,video_path:s.message.video_path||null};a.value.some(i=>i.id===t.id)||(a.value.push(t),a.value.sort((i,n)=>new Date(i.created_at)-new Date(n.created_at)),b());return}if(s.message&&!s.message.is_guest){const t={id:s.message.id,message:s.message.message,is_guest:!1,created_at:s.message.created_at,image_path:s.message.image_path||null,video_path:s.message.video_path||null};a.value=a.value.filter(i=>!i.isTemp),a.value.some(i=>i.id===t.id)||(a.value.push(t),a.value.sort((i,n)=>new Date(i.created_at)-new Date(n.created_at)),z.play().catch(()=>{}),b())}}),_.listen("GuestChatDeleted",s=>{s.session_id===l.sessionId&&(alert(g("Your chat session has been ended by the administrator.")),T("close"))})}catch{console.log("Echo setup failed, using polling only")}I=setInterval(()=>{l.sessionId?(B(),q()):clearInterval(I)},2e3)}},W=()=>{_&&(_.stopListening("NewGuestChatMessage"),_.stopListening("GuestChatDeleted"),window.Echo&&window.Echo.leaveChannel(`guest-chat.${l.sessionId}`),_=null),I&&(clearInterval(I),I=null)},q=async()=>{if(l.sessionId)try{const s=await M.get(`/guest-chat/${l.sessionId}/block-status`);v.value=s.data.is_blocked}catch(s){console.error("Error checking block status:",s)}},G=(s,t)=>{j.value=s,L.value=t,U.value=!0},O=()=>{U.value=!1,j.value="",L.value=""};return Z(()=>{B(),P()}),ee(()=>{W()}),(s,t)=>(c(),u(V,null,[o("div",de,[o("div",ue,[o("button",{onClick:t[0]||(t[0]=e=>s.$emit("close")),class:"text-blue-500 focus:outline-none mr-3"},[...t[4]||(t[4]=[o("i",{class:"fas fa-arrow-left"},null,-1)])]),o("div",ce,k(g("Support Chat")),1),t[5]||(t[5]=o("div",{class:"w-6"},null,-1))]),o("div",{ref_key:"messagesContainer",ref:$,class:"flex-1 overflow-y-auto p-4 bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl"},[v.value?(c(),u("div",pe,[o("div",ge,[t[6]||(t[6]=o("i",{class:"fas fa-ban text-red-500 text-4xl mb-4"},null,-1)),o("h3",me,k(g("Account Blocked")),1),o("p",he,k(g("You have been blocked by the administrator. You cannot send or receive messages.")),1)])])):a.value.length===0?(c(),u("div",ve,k(g("No messages yet. Start the conversation!")),1)):(c(!0),u(V,{key:2},te(a.value,e=>(c(),u("div",{key:e.id,class:R(["mb-4 flex",{"justify-end":e.is_guest,"justify-start":!e.is_guest}])},[o("div",{class:R(["flex items-start space-x-2 max-w-[85%]",e.is_guest?"flex-row-reverse space-x-reverse":""])},[t[9]||(t[9]=o("div",{class:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},[o("i",{class:"fas fa-user text-gray-400 text-xs"})],-1)),o("div",{class:R(["rounded-lg p-3 text-sm bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl border border-cyan-300/30",e.is_guest?"self-end":"self-start"])},[e.image_path?(c(),u("div",fe,[o("img",{src:e.image_path.startsWith("blob:")||e.image_path.startsWith("/storage/")?e.image_path:`/storage/${e.image_path}`,alt:"chat image",class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:i=>G(e.image_path.startsWith("blob:")||e.image_path.startsWith("/storage/")?e.image_path:`/storage/${e.image_path}`,"image")},null,8,be)])):w("",!0),e.video_path?(c(),u("div",_e,[e.video_path.startsWith("blob:")?(c(),u("div",xe,[...t[7]||(t[7]=[o("i",{class:"fas fa-video text-gray-600 text-2xl"},null,-1)])])):(c(),u("video",{key:1,class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:i=>G(e.video_path.startsWith("blob:")||e.video_path.startsWith("/storage/")?e.video_path:`/storage/${e.video_path}`,"video")},[o("source",{src:e.video_path.startsWith("blob:")||e.video_path.startsWith("/storage/")?e.video_path:`/storage/${e.video_path}`,type:"video/mp4"},null,8,ye)],8,we)),e.video_path.startsWith("blob:")?w("",!0):(c(),u("div",ke,[...t[8]||(t[8]=[o("i",{class:"fas fa-play-circle text-white text-2xl opacity-80"},null,-1)])]))])):w("",!0),e.message?(c(),u("div",Ie,k(e.message),1)):w("",!0)],2)],2)],2))),128))],512),o("div",Me,[v.value?(c(),u("div",Ce,k(g("You have been blocked. You cannot send messages.")),1)):(c(),u("div",De,[o("input",{type:"file",ref_key:"imageInput",ref:N,class:"hidden",onChange:H,accept:"image/*"},null,544),o("button",{type:"button",onClick:t[1]||(t[1]=e=>s.$refs.imageInput.click()),class:"p-1.5 sm:p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-md focus:outline-none border border-white/30 hover:bg-white/70 transition-all flex-shrink-0",title:g("Upload Image")},[...t[10]||(t[10]=[o("svg",{class:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,$e),o("input",{type:"file",ref_key:"videoInput",ref:A,class:"hidden",onChange:K,accept:"video/mp4,video/x-matroska"},null,544),o("button",{type:"button",onClick:t[2]||(t[2]=e=>s.$refs.videoInput.click()),class:"p-1.5 sm:p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-md focus:outline-none border border-white/30 hover:bg-white/70 transition-all flex-shrink-0",title:g("Upload Video")},[...t[11]||(t[11]=[o("svg",{class:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])],8,je),se(o("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>y.value=e),type:"text",placeholder:g("Type your message..."),class:"flex-1 min-w-0 px-2 sm:px-3 py-1.5 sm:py-2 rounded-full bg-white/50 backdrop-blur-sm border border-white/30 focus:outline-none focus:ring-2 focus:ring-cyan-400 text-slate-900 placeholder-slate-500 text-xs sm:text-sm",onKeydown:oe(ie(E,["exact","prevent"]),["enter"])},null,40,Le),[[ae,y.value]]),o("button",{type:"button",onClick:E,class:"p-1.5 sm:p-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-full shadow-md focus:outline-none transition-all duration-200 flex-shrink-0"},[...t[12]||(t[12]=[o("svg",{class:"w-4 h-4 sm:w-5 sm:h-5",fill:"currentColor",viewBox:"0 0 24 24"},[o("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])])]))])]),U.value?(c(),u("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:O},[o("div",Te,[o("button",{onClick:O,class:"absolute -top-10 right-0 text-white text-2xl hover:text-gray-300"},[...t[13]||(t[13]=[o("i",{class:"fas fa-times"},null,-1)])]),L.value==="image"?(c(),u("img",{key:0,src:j.value,alt:"Full size image",class:"max-w-full max-h-screen object-contain"},null,8,Ue)):w("",!0),L.value==="video"?(c(),u("video",{key:1,src:j.value,controls:"",autoplay:"",class:"max-w-full max-h-screen"},null,8,Se)):w("",!0)])])):w("",!0)],64))}};export{ze as _,Be as a,Ee as b};
