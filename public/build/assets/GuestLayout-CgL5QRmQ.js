import{u as te,c as D,r as h,a as u,o as c,e as t,b as I,w as O,d as A,l as P,k as b,t as m,F as ae,j as se,n as ge,J as ve,A as ee,y as V,g as q,i as W,m as F,C as me,D as C}from"./app-D6hQSsMw.js";import{_ as fe,a as be}from"./FloatingChatIcon-D6GLJ76o.js";const _e={class:"bg-white/10 backdrop-blur-md border-b border-white/20 shadow-lg relative z-50"},xe={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},we={class:"flex flex-row justify-between items-center h-16"},ye={class:"relative"},ke=["src"],Ce={class:"text-sm"},$e={key:0,class:"absolute right-0 mt-2 w-40 bg-white/95 backdrop-blur-md border border-white/30 rounded-lg shadow-xl z-[9999]"},Te=["onClick"],Me=["src","alt"],De={__name:"Header",setup(oe){const $=te(),G=D(()=>$.props.translations||{}),z=D(()=>$.props.auth||{}),n=D(()=>$.props.locale||"en"),y=[{code:"en",name:"English",flag:"https://flagcdn.com/w20/gb.png"},{code:"es",name:"Español",flag:"https://flagcdn.com/w20/es.png"},{code:"it",name:"Italiano",flag:"https://flagcdn.com/w20/it.png"},{code:"ro",name:"Română",flag:"https://flagcdn.com/w20/ro.png"},{code:"ru",name:"Русский",flag:"https://flagcdn.com/w20/ru.png"},{code:"de",name:"Deutsch",flag:"https://flagcdn.com/w20/de.png"},{code:"bn",name:"বাংলা",flag:"https://flagcdn.com/w20/bd.png"},{code:"hi",name:"हिन्दी",flag:"https://flagcdn.com/w20/in.png"}],T=D(()=>y.find(o=>o.code===n.value)||y[0]),p=h(!1),L=async()=>{const v=(await(await fetch(route("csrf-token"),{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"})).json()).token;document.head.querySelector('meta[name="csrf-token"]').content=v,window.axios.defaults.headers.common["X-CSRF-TOKEN"]=v},r=async o=>{try{await L(),await ge.post(route("locale.change"),{locale:o},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{p.value=!1}})}catch(l){l.response&&l.response.status===419?window.location.reload():console.error("Failed to change language:",l)}},x=o=>G.value[o]||o;return(o,l)=>(c(),u("header",_e,[t("div",xe,[t("div",we,[I(A(P),{href:z.value.user?o.route("dashboard"):o.route("welcome")},{default:O(()=>[I(fe,{class:"block h-9 w-auto fill-current text-white"})]),_:1},8,["href"]),t("div",ye,[t("button",{onClick:l[0]||(l[0]=v=>p.value=!p.value),class:"flex items-center px-3 py-2 rounded-lg text-white font-semibold transition-all duration-300 hover:bg-white/10 hover:scale-105"},[t("img",{src:T.value.flag,alt:"Lang",class:"h-4 w-auto mr-2 rounded-sm"},null,8,ke),t("span",Ce,m(x("Language")),1),l[1]||(l[1]=t("svg",{class:"ml-1 h-4 w-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),p.value?(c(),u("div",$e,[t("ul",null,[(c(),u(ae,null,se(y,v=>t("li",{key:v.code},[t("button",{onClick:M=>r(v.code),class:"flex items-center w-full px-3 py-2 text-sm text-gray-800 font-medium hover:bg-blue-50 transition-all duration-300 first:rounded-t-lg last:rounded-b-lg"},[t("img",{src:v.flag,alt:v.name,class:"h-4 w-auto mr-2 rounded-sm"},null,8,Me),t("span",null,m(v.name),1)],8,Te)])),64))])])):b("",!0)])])])]))}},Ie={class:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900"},Se={class:"flex flex-col justify-center items-center p-4 min-h-[calc(100vh-64px)]"},Ee={class:"w-full max-w-md"},je={class:"bg-white/10 backdrop-blur-md rounded-t-2xl p-1 border border-white/20 border-b-0"},Ge={class:"flex"},Le={class:"relative max-w-4xl max-h-4xl"},Re=["src"],Ue=["src"],Ne={key:1,class:"guest-chat-modal fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},Ve={class:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[80vh] flex flex-col"},We={class:"flex items-center justify-between p-4 border-b"},Fe={class:"text-lg font-semibold text-gray-800"},ze={key:0,class:"p-6"},He={class:"block text-sm font-medium text-gray-700 mb-1"},Be=["placeholder"],Ye={class:"block text-sm font-medium text-gray-700 mb-1"},qe=["placeholder"],Oe={class:"block text-sm font-medium text-gray-700 mb-1"},Ae={class:"flex items-center space-x-2 mb-2"},Pe=["src"],Ke=["placeholder"],Xe={key:0,class:"text-red-500 text-sm mt-1"},Je={type:"submit",class:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white py-2 px-4 rounded-lg transition-all duration-200"},Qe={key:1,class:"flex flex-col flex-1 min-h-0"},Ze={key:0,class:"text-center text-gray-500 py-8"},et={key:0,class:"mb-2"},tt=["src","onClick"],at={key:1,class:"mb-2 relative"},st={key:0,class:"w-32 h-32 bg-gray-200 rounded flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity"},ot=["onClick"],lt=["src"],nt={key:2,class:"absolute inset-0 flex items-center justify-center pointer-events-none"},rt=["innerHTML"],it={class:"border-t p-4"},ut={key:0,class:"text-center py-4 text-red-600 bg-red-50 rounded-lg mb-4"},ct={class:"flex space-x-2"},dt=["placeholder","onKeydown"],gt={__name:"GuestLayout",setup(oe){const $=te(),G=D(()=>$.url),z=D(()=>$.props.translations||{}),n=s=>z.value[s]||s,y=h(!1),T=h(!0),p=h({name:"",mobile_number:"",captcha:""}),L=h(""),r=h([]),x=h(""),o=h(null),l=h(null),v=new Audio("/notification.mp3"),M=h(""),f=h(!1),H=h(new Set),le=h(null),ne=h(null),B=h(!1),R=h(""),U=h(""),N=()=>{L.value=`/captcha?${Date.now()}`},re=()=>{y.value=!0,N()},Y=()=>{J(),y.value=!1,T.value=!0,p.value={name:"",mobile_number:"",captcha:""},r.value=[],x.value="",f.value=!1,o.value=null},ie=async()=>{try{if(!(await C.post("/captcha/verify",{captcha:p.value.captcha})).data.valid){M.value=n("Incorrect captcha. Please try again."),N(),p.value.captcha="";return}M.value="";const a=await C.post("/guest-chat/start",{name:p.value.name,mobile_number:p.value.mobile_number});if(a.data.blocked){M.value=n("You have been blocked. You cannot send messages.");return}o.value=a.data.session_id,window.guestInfo={name:p.value.name,mobile_number:p.value.mobile_number},f.value=H.value.has(a.data.session_id),T.value=!1,K(),ue()}catch{alert(n("Error starting chat. Please try again."))}},K=async()=>{var s;if(o.value)try{const e=(await C.get(`/guest-chat/${o.value}/messages`)).data.sort((d,E)=>new Date(d.created_at)-new Date(E.created_at)),i=r.value.filter(d=>d.isTemp),g=new Set(e.map(d=>d.id)),_=new Set(r.value.filter(d=>!d.isTemp).map(d=>d.id)),w=e.filter(d=>!_.has(d.id));if(w.length>0){const d=w.some(j=>!j.is_guest),E=r.value.filter(j=>!j.isTemp);r.value=[...E,...w,...i].sort((j,he)=>new Date(j.created_at)-new Date(he.created_at)),d&&v.play().catch(()=>{}),setTimeout(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)},100)}}catch(a){((s=a.response)==null?void 0:s.status)===404&&(J(),Y())}},X=async()=>{var a,e,i;if(!x.value.trim()||!o.value||f.value)return;const s=x.value;x.value="";try{const g=await C.post(`/guest-chat/${o.value}/broadcast`,{message:s,guest_name:(a=window.guestInfo)==null?void 0:a.name,guest_mobile:(e=window.guestInfo)==null?void 0:e.mobile_number}),_={id:g.data.id,message:s,is_guest:!0,created_at:g.data.created_at};r.value.some(d=>d.id===_.id)||(r.value.push(_),r.value.sort((d,E)=>new Date(d.created_at)-new Date(E.created_at)),setTimeout(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)},50)),f.value=!1,H.value.delete(o.value)}catch(g){x.value=s,((i=g.response)==null?void 0:i.status)===403&&(f.value=!0,H.value.add(o.value))}};let S=null,k=null;const ue=()=>{if(o.value){if(window.Echo)try{k=window.Echo.channel(`guest-chat.${o.value}`),k.listen("NewGuestChatMessage",s=>{if(console.log("📨 Guest received NewGuestChatMessage:",s),s.message&&s.message.sender_id!==o.value){const a={id:s.message.id,message:s.message.message,is_guest:s.message.is_guest||!1,created_at:s.message.created_at,is_image:s.message.is_image||!1,image_path:s.message.image_path||null,video_path:s.message.video_path||null};r.value=r.value.filter(i=>!i.isTemp),r.value.some(i=>i.id===a.id)||(r.value.push(a),r.value.sort((i,g)=>new Date(i.created_at)-new Date(g.created_at)),a.is_guest||v.play().catch(()=>{}),setTimeout(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)},100))}}),k.listen("GuestChatDeleted",s=>{console.log("🗑️ Guest chat deleted:",s),s.session_id===o.value&&(alert(n("Your chat session has been ended by the administrator.")),Y())})}catch{console.log("Echo setup failed, using polling only")}S=setInterval(()=>{o.value?(K(),pe()):clearInterval(S)},2e3)}},J=()=>{k&&(k.stopListening("NewGuestChatMessage"),k.stopListening("GuestChatDeleted"),window.Echo&&window.Echo.leaveChannel(`guest-chat.${o.value}`),k=null),S&&(clearInterval(S),S=null)},ce=async s=>{var a;try{const e=s.target.files[0];if(!e||f.value)return;const i=URL.createObjectURL(e),g={id:"temp_"+Date.now(),message:"",is_guest:!0,image_path:i,video_path:null,created_at:new Date().toISOString(),isTemp:!0};r.value.push(g),r.value.sort((w,d)=>new Date(w.created_at)-new Date(d.created_at)),setTimeout(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)},50);const _=new FormData;_.append("image",e),await C.post(`/guest-chat/${o.value}/send`,_),s.target.value=""}catch(e){console.error("Error uploading image:",e),((a=e.response)==null?void 0:a.status)===403?(f.value=!0,alert(n("You have been blocked and cannot send messages."))):alert(n("Error uploading image. Please try again."));const i=r.value.findIndex(g=>g.isTemp);i>-1&&r.value.splice(i,1)}},de=async s=>{var a;try{const e=s.target.files[0];if(!e||f.value)return;if(e.size>30*1024*1024){alert(n("Video file size must not exceed 30MB.")),s.target.value="";return}const i=URL.createObjectURL(e),g={id:"temp_"+Date.now(),message:"",is_guest:!0,image_path:null,video_path:i,created_at:new Date().toISOString(),isTemp:!0};r.value.push(g),r.value.sort((w,d)=>new Date(w.created_at)-new Date(d.created_at)),setTimeout(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)},50);const _=new FormData;_.append("video",e),await C.post(`/guest-chat/${o.value}/send`,_),s.target.value=""}catch(e){console.error("Error uploading video:",e),((a=e.response)==null?void 0:a.status)===403?(f.value=!0,alert(n("You have been blocked and cannot send messages."))):alert(n("Error uploading video. Please try again."));const i=r.value.findIndex(g=>g.isTemp);i>-1&&r.value.splice(i,1)}},pe=async()=>{if(o.value)try{const s=await C.get(`/guest-chat/${o.value}/block-status`);f.value=s.data.is_blocked}catch(s){console.error("Error checking block status:",s)}},Q=(s,a)=>{R.value=s,U.value=a,B.value=!0},Z=()=>{B.value=!1,R.value="",U.value=""};return(s,a)=>(c(),u("div",Ie,[I(De,{class:"relative z-50"}),t("div",Se,[t("div",Ee,[t("div",je,[t("div",Ge,[I(A(P),{href:s.route("register"),class:V(["flex-1 text-center py-3 px-4 rounded-t-xl text-sm font-semibold transition-all duration-300",G.value.includes("/register")?"bg-white text-blue-900 shadow-lg":"text-white/80 hover:text-white hover:bg-white/10"])},{default:O(()=>[ee(m(n("Create Account")),1)]),_:1},8,["href","class"]),I(A(P),{href:s.route("login"),class:V(["flex-1 text-center py-3 px-4 rounded-t-xl text-sm font-semibold transition-all duration-300",G.value.includes("/login")?"bg-white text-blue-900 shadow-lg":"text-white/80 hover:text-white hover:bg-white/10"])},{default:O(()=>[ee(m(n("Login")),1)]),_:1},8,["href","class"])])])]),ve(s.$slots,"default")]),B.value?(c(),u("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:Z},[t("div",Le,[t("button",{onClick:Z,class:"absolute -top-10 right-0 text-white text-2xl hover:text-gray-300"},[...a[7]||(a[7]=[t("i",{class:"fas fa-times"},null,-1)])]),U.value==="image"?(c(),u("img",{key:0,src:R.value,alt:"Full size image",class:"max-w-full max-h-screen object-contain"},null,8,Re)):b("",!0),U.value==="video"?(c(),u("video",{key:1,src:R.value,controls:"",autoplay:"",class:"max-w-full max-h-screen"},null,8,Ue)):b("",!0)])])):b("",!0),I(be,{onClick:re}),y.value?(c(),u("div",Ne,[t("div",Ve,[t("div",We,[t("h3",Fe,m(T.value?n("Contact Support"):n("Guest Chat")),1),t("button",{onClick:Y,class:"text-gray-400 hover:text-gray-600"},[...a[8]||(a[8]=[t("i",{class:"fas fa-times text-xl"},null,-1)])])]),T.value?(c(),u("div",ze,[t("form",{onSubmit:q(ie,["prevent"]),class:"space-y-4"},[t("div",null,[t("label",He,m(n("Name")),1),W(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>p.value.name=e),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:n("Enter your name")},null,8,Be),[[F,p.value.name]])]),t("div",null,[t("label",Ye,m(n("Mobile Number")),1),W(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>p.value.mobile_number=e),type:"tel",required:"",pattern:"[0-9+\\-\\s]*",onInput:a[2]||(a[2]=e=>p.value.mobile_number=p.value.mobile_number.replace(/[^0-9+\-\s]/g,"")),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:n("Enter your mobile number")},null,40,qe),[[F,p.value.mobile_number]])]),t("div",null,[t("label",Oe,m(n("Verification")),1),t("div",Ae,[t("img",{src:L.value,alt:"Captcha",class:"border border-gray-300 rounded",onClick:N,style:{cursor:"pointer"}},null,8,Pe),t("button",{type:"button",onClick:N,class:"text-blue-500 hover:text-blue-700 text-sm"}," 🔄 ")]),W(t("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>p.value.captcha=e),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:n("Enter the code shown above")},null,8,Ke),[[F,p.value.captcha]]),M.value?(c(),u("div",Xe,m(M.value),1)):b("",!0)]),t("button",Je,m(n("Start Chat")),1)],32)])):(c(),u("div",Qe,[t("div",{ref_key:"messagesContainer",ref:l,class:"flex-1 overflow-y-auto p-4 space-y-3 min-h-0"},[r.value.length===0?(c(),u("div",Ze,m(n("No messages yet. Start the conversation!")),1)):b("",!0),(c(!0),u(ae,null,se(r.value,e=>(c(),u("div",{key:e.id,class:V(["guest-chat-message flex",e.is_guest?"justify-end":"justify-start"])},[t("div",{class:V(["max-w-[80%] rounded-lg p-3 text-sm",e.is_guest?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"])},[e.image_path?(c(),u("div",et,[t("img",{src:e.image_path.startsWith("blob:")||e.image_path.startsWith("/storage/")?e.image_path:`/storage/${e.image_path}`,alt:"chat image",class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:i=>Q(e.image_path.startsWith("blob:")||e.image_path.startsWith("/storage/")?e.image_path:`/storage/${e.image_path}`,"image")},null,8,tt)])):b("",!0),e.video_path?(c(),u("div",at,[e.video_path.startsWith("blob:")?(c(),u("div",st,[...a[9]||(a[9]=[t("i",{class:"fas fa-video text-gray-600 text-2xl"},null,-1)])])):(c(),u("video",{key:1,class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:i=>Q(e.video_path.startsWith("blob:")||e.video_path.startsWith("/storage/")?e.video_path:`/storage/${e.video_path}`,"video")},[t("source",{src:e.video_path.startsWith("blob:")||e.video_path.startsWith("/storage/")?e.video_path:`/storage/${e.video_path}`,type:"video/mp4"},null,8,lt)],8,ot)),e.video_path.startsWith("blob:")?b("",!0):(c(),u("div",nt,[...a[10]||(a[10]=[t("i",{class:"fas fa-play-circle text-white text-2xl opacity-80"},null,-1)])]))])):b("",!0),e.message?(c(),u("p",{key:2,innerHTML:e.message},null,8,rt)):b("",!0)],2)],2))),128))],512),t("div",it,[f.value?(c(),u("div",ut,m(n("You have been blocked. You cannot send messages.")),1)):(c(),u("form",{key:1,onSubmit:q(X,["prevent"]),class:"space-y-2"},[t("div",ct,[t("input",{type:"file",ref_key:"imageInput",ref:le,class:"hidden",onChange:ce,accept:"image/*"},null,544),t("button",{type:"button",onClick:a[4]||(a[4]=e=>s.$refs.imageInput.click()),class:"px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200"},[...a[11]||(a[11]=[t("i",{class:"fas fa-image text-gray-600"},null,-1)])]),t("input",{type:"file",ref_key:"videoInput",ref:ne,class:"hidden",onChange:de,accept:"video/mp4,video/x-matroska"},null,544),t("button",{type:"button",onClick:a[5]||(a[5]=e=>s.$refs.videoInput.click()),class:"px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200"},[...a[12]||(a[12]=[t("i",{class:"fas fa-video text-gray-600"},null,-1)])]),W(t("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>x.value=e),type:"text",placeholder:n("Type your message..."),class:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeydown:me(q(X,["exact","prevent"]),["enter"])},null,40,dt),[[F,x.value]]),a[13]||(a[13]=t("button",{type:"submit",class:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg transition-all duration-200"},[t("i",{class:"fas fa-paper-plane"})],-1))])],32))])]))])])):b("",!0)]))}};export{gt as _};
