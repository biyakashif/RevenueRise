import{u as H,r as p,D as f,s as K,E as U,a as n,b as q,m as g,w as Y,e as a,t as w,o as i,F as D,k as O,z as M,d as r,j as R,C as X,i as P,n as G}from"./app-C5R0GNTt.js";import{_ as J}from"./AuthenticatedLayout-DtJOEFi7.js";const Q={class:"absolute inset-0 flex flex-col"},Z={class:"flex items-center justify-between px-4 py-3 bg-gradient-to-br from-cyan-400/30 via-blue-500/25 to-indigo-600/30 backdrop-blur-xl text-white shadow-md border-b border-cyan-300/30 rounded-t-2xl sm:rounded-t-3xl"},ee={class:"text-lg text-blue-500 font-semibold"},te={class:"flex-1 overflow-y-auto p-4 bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl"},se={key:0,class:"flex items-center justify-center h-full"},ae={class:"text-center py-8 px-4 bg-red-50 rounded-lg border border-red-200"},oe={class:"text-lg font-semibold text-red-800 mb-2"},re={class:"text-red-600"},ne={key:1,class:"flex items-center justify-center h-full text-slate-600"},ie={key:0,class:"w-8 h-8 rounded-full overflow-hidden border flex-shrink-0"},le=["src","alt"],de={key:1,class:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},ce={key:0,class:"mb-2"},ue=["src","onClick"],pe={key:1,class:"mb-2 relative"},he=["onClick"],ve=["src"],fe={key:2,class:"text-sm text-slate-800 whitespace-pre-wrap"},me={class:"border-t border-cyan-300/30 p-2 sm:p-3 bg-gradient-to-br from-cyan-400/30 via-blue-500/25 to-indigo-600/30 backdrop-blur-xl rounded-b-2xl sm:rounded-b-3xl"},be={key:0,class:"w-full text-center py-4 text-red-600 bg-red-50 rounded-lg"},ge={key:1,class:"flex items-center space-x-1 sm:space-x-2"},we=["title"],_e=["title"],xe=["placeholder","onKeydown"],ye={class:"relative max-w-4xl max-h-4xl"},ke=["src"],Ce=["src"],Ie={__name:"Index",setup(Ee){var S;const o=H(),u=p([]),l=s=>o.props.translations[s]||s,h=p(""),k=p(null),C=p(null),E=p(!1),_=p(""),x=p(""),y=new Audio("/notification.mp3"),T=p(""),m=p(!1);let d=null;f.defaults.headers.common["X-CSRF-TOKEN"]=o.props.csrf_token||((S=document.querySelector('meta[name="csrf-token"]'))==null?void 0:S.getAttribute("content")),f.defaults.withCredentials=!0;const L=async()=>{try{const s=await f.get("/chat/messages",{headers:{"X-CSRF-TOKEN":o.props.csrf_token}});u.value=s.data.sort((e,t)=>new Date(e.created_at)-new Date(t.created_at)),setTimeout(()=>{const e=document.querySelector(".overflow-y-auto");e&&(e.scrollTop=e.scrollHeight)},100),window.dispatchEvent(new CustomEvent("chat:read"))}catch(s){console.error("Error loading messages:",s)}},j=async()=>{var s,e;try{if(m.value)return;if(!h.value.trim()){h.value="";return}const t=h.value;h.value="";const b=(await f.post("/chat/broadcast",{message:t,_token:o.props.csrf_token})).data;if(b&&b.id){const $={id:b.id,message:t,image_path:null,video_path:null,created_at:b.created_at,sender_id:o.props.auth.user.id,recipient_id:null};u.value.some(v=>v.id===$.id)||(u.value.push($),u.value.sort((v,W)=>new Date(v.created_at)-new Date(W.created_at)),setTimeout(()=>{const v=document.querySelector(".overflow-y-auto");v&&(v.scrollTop=v.scrollHeight)},50))}k.value&&(k.value.value=""),C.value&&(C.value.value="")}catch(t){h.value=messageText,console.error("Error sending message:",t),alert(((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.error)||l("Error sending message. Please try again."))}},z=async s=>{const e=s.target.files[0];if(!e||m.value)return;if(e.size>5*1024*1024){alert(l("Image file size must not exceed 5MB.")),s.target.value="";return}const t=new FormData;t.append("image",e),t.append("_token",o.props.csrf_token),await f.post("/chat/send",t),s.target.value=""},N=async s=>{const e=s.target.files[0];if(!e||m.value)return;if(e.size>30*1024*1024){T.value=l("The video file size must not exceed 30MB."),s.target.value="";return}T.value="";const t=new FormData;t.append("video",e),t.append("_token",o.props.csrf_token),await f.post("/chat/send",t),s.target.value=""},F=s=>{if(s&&s.target){s.target.style.display="none";const e=s.target.parentElement;e&&(e.innerHTML='<i class="fas fa-user text-gray-400"></i>',e.classList.add("flex","items-center","justify-center"))}},I=(s,e)=>{_.value=s,x.value=e,E.value=!0},A=()=>{E.value=!1,_.value="",x.value=""},V=()=>{window.history.back()};K(()=>{L(),B(),window.Echo&&window.Echo.private(`chat.${o.props.auth.user.id}`).listen("NewChatMessage",e=>{u.value.some(c=>c.id===e.chat.id)||(u.value.push({id:e.chat.id,message:e.chat.message,image_path:e.chat.image_path,video_path:e.chat.video_path,created_at:e.chat.created_at,sender_id:e.chat.sender_id,recipient_id:e.chat.recipient_id}),u.value.sort((c,b)=>new Date(c.created_at)-new Date(b.created_at)),setTimeout(()=>{const c=document.querySelector(".overflow-y-auto");c&&(c.scrollTop=c.scrollHeight)},50),e.chat.sender_id!==o.props.auth.user.id&&y.play().catch(()=>{}),window.dispatchEvent(new CustomEvent("chat:read")))});const s=()=>{y.play().then(()=>{y.pause(),y.currentTime=0}).catch(()=>{}),window.removeEventListener("click",s),window.removeEventListener("keydown",s),window.removeEventListener("touchstart",s)};window.addEventListener("click",s),window.addEventListener("keydown",s),window.addEventListener("touchstart",s),d=setInterval(B,5e3)}),U(()=>{d&&(clearInterval(d),d=null)});const B=async()=>{var s,e;if(!((s=o.props.auth)!=null&&s.user)){d&&(clearInterval(d),d=null);return}try{const t=await f.get("/chat/block-status",{headers:{"X-CSRF-TOKEN":o.props.csrf_token}});m.value=t.data.is_blocked}catch(t){if(((e=t.response)==null?void 0:e.status)===401){d&&(clearInterval(d),d=null);return}}};return(s,e)=>(i(),n(D,null,[q(J,{hideBottomNav:!0},{default:Y(()=>[a("div",Q,[a("div",Z,[a("button",{onClick:V,class:"text-blue-500 focus:outline-none mr-3"},[...e[3]||(e[3]=[a("i",{class:"fas fa-arrow-left"},null,-1)])]),a("div",ee,w(l("Support Chat")),1),e[4]||(e[4]=a("div",{class:"w-6"},null,-1))]),a("div",te,[m.value?(i(),n("div",se,[a("div",ae,[e[5]||(e[5]=a("i",{class:"fas fa-ban text-red-500 text-4xl mb-4"},null,-1)),a("h3",oe,w(l("Account Blocked")),1),a("p",re,w(l("You have been blocked by the administrator. You cannot send or receive messages.")),1)])])):u.value.length===0?(i(),n("div",ne,w(l("No messages yet")),1)):(i(!0),n(D,{key:2},O(u.value,t=>(i(),n("div",{key:t.id,class:M(["mb-4 flex",{"justify-end":t.sender_id===r(o).props.auth.user.id,"justify-start":t.sender_id!==r(o).props.auth.user.id}])},[a("div",{class:M(["flex items-start space-x-2 max-w-[85%]",t.sender_id===r(o).props.auth.user.id?"flex-row-reverse space-x-reverse":""])},[t.sender_id===r(o).props.auth.user.id&&r(o).props.auth.user.avatar_url||t.sender_id!==r(o).props.auth.user.id&&r(o).props.adminAvatar?(i(),n("div",ie,[a("img",{src:t.sender_id===r(o).props.auth.user.id?r(o).props.auth.user.avatar_url.startsWith("/storage")||r(o).props.auth.user.avatar_url.startsWith("/assets")?r(o).props.auth.user.avatar_url:`/storage/${r(o).props.auth.user.avatar_url}`:r(o).props.adminAvatar.startsWith("/storage")||r(o).props.adminAvatar.startsWith("/assets")?r(o).props.adminAvatar:`/storage/${r(o).props.adminAvatar}`,alt:t.sender_id===r(o).props.auth.user.id?"You":"Support",class:"w-full h-full object-cover",onError:F},null,40,le)])):(i(),n("div",de,[...e[6]||(e[6]=[a("i",{class:"fas fa-user text-gray-400 text-xs"},null,-1)])])),a("div",{class:M(["rounded-lg p-3 text-sm",t.sender_id===r(o).props.auth.user.id?"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl border border-cyan-300/30 self-end":"bg-white/90 backdrop-blur-xl border border-white/50 self-start"])},[t.image_path?(i(),n("div",ce,[a("img",{src:t.image_path.startsWith("/storage/")?t.image_path:`/storage/${t.image_path}`,alt:"chat image",class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:c=>I(t.image_path.startsWith("/storage/")?t.image_path:`/storage/${t.image_path}`,"image")},null,8,ue)])):g("",!0),t.video_path?(i(),n("div",pe,[a("video",{class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:c=>I(t.video_path.startsWith("/storage/")?t.video_path:`/storage/${t.video_path}`,"video")},[a("source",{src:t.video_path.startsWith("/storage/")?t.video_path:`/storage/${t.video_path}`,type:"video/mp4"},null,8,ve)],8,he),e[7]||(e[7]=a("div",{class:"absolute inset-0 flex items-center justify-center pointer-events-none"},[a("i",{class:"fas fa-play-circle text-white text-2xl opacity-80"})],-1))])):g("",!0),t.message?(i(),n("div",fe,w(t.message),1)):g("",!0)],2)],2)],2))),128))]),a("div",me,[m.value?(i(),n("div",be,w(l("You are blocked and cannot send messages.")),1)):(i(),n("div",ge,[a("input",{type:"file",ref_key:"imageInput",ref:k,class:"hidden",onChange:z,accept:"image/*"},null,544),a("button",{type:"button",onClick:e[0]||(e[0]=t=>s.$refs.imageInput.click()),class:"p-1.5 sm:p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-md focus:outline-none border border-white/30 hover:bg-white/70 transition-all flex-shrink-0",title:l("Upload Image")},[...e[8]||(e[8]=[a("svg",{class:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,we),a("input",{type:"file",ref_key:"videoInput",ref:C,class:"hidden",onChange:N,accept:"video/mp4,video/x-matroska"},null,544),a("button",{type:"button",onClick:e[1]||(e[1]=t=>s.$refs.videoInput.click()),class:"p-1.5 sm:p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-md focus:outline-none border border-white/30 hover:bg-white/70 transition-all flex-shrink-0",title:l("Upload Video")},[...e[9]||(e[9]=[a("svg",{class:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])],8,_e),R(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>h.value=t),type:"text",placeholder:l("Type your message..."),class:"flex-1 min-w-0 px-2 sm:px-3 py-1.5 sm:py-2 rounded-full bg-white/50 backdrop-blur-sm border border-white/30 focus:outline-none focus:ring-2 focus:ring-cyan-400 text-slate-900 placeholder-slate-500 text-xs sm:text-sm",onKeydown:X(P(j,["exact","prevent"]),["enter"])},null,40,xe),[[G,h.value]]),a("button",{type:"button",onClick:j,class:"p-1.5 sm:p-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-full shadow-md focus:outline-none transition-all duration-200 flex-shrink-0"},[...e[10]||(e[10]=[a("svg",{class:"w-4 h-4 sm:w-5 sm:h-5",fill:"currentColor",viewBox:"0 0 24 24"},[a("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])])]))])])]),_:1}),E.value?(i(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:A},[a("div",ye,[a("button",{onClick:A,class:"absolute -top-10 right-0 text-white text-2xl hover:text-gray-300"},[...e[11]||(e[11]=[a("i",{class:"fas fa-times"},null,-1)])]),x.value==="image"?(i(),n("img",{key:0,src:_.value,alt:"Full size image",class:"max-w-full max-h-screen object-contain"},null,8,ke)):g("",!0),x.value==="video"?(i(),n("video",{key:1,src:_.value,controls:"",autoplay:"",class:"max-w-full max-h-screen"},null,8,Ce)):g("",!0)])])):g("",!0)],64))}};export{Ie as default};
