import{u as j,r as p,q as B,s as A,a,b as D,d as b,h as E,w as P,e,k as v,A as y,o,t as u,i as T,m as V,F as $,j as M,n as N}from"./app-CdvAI5iq.js";import{_ as W}from"./AdminLayout-DZFzOaKL.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},q={class:"text-lg font-bold text-slate-800 drop-shadow-sm mb-4"},H={key:0,class:"block text-base font-medium text-slate-700"},G={key:1,class:"text-sm font-medium text-slate-600"},J={key:0,class:"mb-6 p-4 rounded-xl bg-green-100/80 border border-green-200 text-green-700 text-sm flex items-center gap-2 backdrop-blur-sm"},K={key:1,class:"mb-6 p-4 rounded-xl bg-red-100/80 border border-red-200 text-red-700 text-sm flex items-center gap-2 backdrop-blur-sm"},O={key:2,class:"mb-6"},Q={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/30"},X={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Y={class:"text-lg font-semibold text-slate-800"},Z={class:"text-lg font-semibold text-slate-800"},ee={class:"mt-4 flex flex-wrap gap-3"},te=["disabled"],se=["disabled"],ae=["disabled"],oe=["disabled"],re={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-white/30"},le={class:"overflow-x-auto"},ne={class:"w-full"},de={class:"p-4 align-top"},ie={key:0,class:"text-slate-500 text-sm"},ue={key:1,class:"space-y-3"},ce={class:"flex items-start"},me={key:0,class:"mr-3"},pe=["href"],ve=["src"],fe={key:1,class:"mr-3 text-gray-500 text-xs"},be={class:"flex-1"},he={class:"flex items-center gap-2"},ge={class:"text-sm font-medium text-slate-700"},xe={key:0,class:"inline-flex items-center px-2 py-0.5 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full"},_e={key:1,class:"ml-2 text-xs text-slate-600 italic"},we={class:"text-sm text-slate-700"},ye={class:"text-sm text-slate-700"},ke={class:"mt-2 flex justify-end gap-2"},Fe={key:0,class:"text-green-600 text-xs font-semibold"},Ue={key:1,class:"text-red-600 text-xs font-semibold"},Se=["onClick"],$e=["onClick"],Ne={__name:"UpdateWallet",props:{deposits:{type:Array,default:()=>[]},selectedUserId:{type:[String,Number],default:null},balance:{type:[Number,String],default:0},frozen_balance:{type:[Number,String],default:0},userName:{type:String,default:null},mobile_number:{type:String,default:null}},setup(h){const c=h,g=j(),x=p([...c.deposits]),_=p(parseFloat(c.balance)||0),k=p(parseFloat(c.frozen_balance)||0),F=p(c.userName),U=p(c.mobile_number),l=p(""),i=p("");let z=null;const m=async()=>{if(c.selectedUserId)try{const r=await fetch(`/admin/update-wallet?user_id=${c.selectedUserId}`,{headers:{Accept:"application/json"}});if(!r.ok)throw new Error(`HTTP error! Status: ${r.status}`);const t=await r.json();x.value=t.deposits||[],_.value=parseFloat(t.balance)||0,k.value=parseFloat(t.frozen_balance)||0,F.value=t.userName||"Unknown",U.value=t.mobile_number||"Unknown",i.value=""}catch(r){i.value=`Failed to fetch wallet data: ${r.message}. Please try again.`}};B(()=>{m(),z=setInterval(m,5e3)}),A(()=>{clearInterval(z)});const I=async(r,t)=>{if(t==="approve"){const n=x.value.find(d=>d.id===r);if(!n){i.value="Deposit not found.";return}try{const d=await fetch(`https://api.coinbase.com/v2/exchange-rates?currency=${n.symbol}`);if(!d.ok)throw new Error(`Failed to fetch exchange rate: ${d.status}`);const s=await d.json();if(!s.data||!s.data.rates||!s.data.rates.USDT)throw new Error("Invalid exchange rate data received");const f=parseFloat(s.data.rates.USDT),S=parseFloat(n.amount)*f;N.post(`/admin/update-deposit/${r}`,{action:t,converted_amount:S,original_amount:n.amount,symbol:n.symbol,exchange_rate:f},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m()},onError:C=>{i.value=C.action||"Failed to approve deposit.",m()}})}catch(d){i.value=`Failed to get exchange rate: ${d.message}. Please try again.`;return}}else N.post(`/admin/update-deposit/${r}`,{action:t},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m()},onError:n=>{i.value=n.action||"Failed to update deposit status.",m()}})},w=r=>{const t=parseFloat(l.value);if(isNaN(t)||t<=0){i.value="Please enter a valid amount greater than 0.";return}let n;r==="freeze"?n=route("admin.freeze-balance",c.selectedUserId):r==="unfreeze"?n=route("admin.unfreeze-balance",c.selectedUserId):n=`/admin/update-balance/${c.selectedUserId}`,N.post(n,{amount:t,action:r==="freeze"||r==="unfreeze"?"subtract":r},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m(),l.value="",i.value=""},onError:d=>{i.value=d.error||d.amount||d.action||"Failed to update balance. Please check the server configuration.",m()}})};return(r,t)=>(o(),a($,null,[D(b(E),{title:"Update Wallet"}),D(W,null,{default:P(()=>{var n,d;return[e("div",R,[e("h1",q,[t[5]||(t[5]=y(" Update Wallet ",-1)),h.selectedUserId&&F.value?(o(),a("span",H," for "+u(F.value),1)):v("",!0),h.selectedUserId&&U.value?(o(),a("span",G," Mobile: "+u(U.value),1)):v("",!0)]),(n=b(g).props.flash)!=null&&n.success?(o(),a("div",J,u(b(g).props.flash.success),1)):v("",!0),(d=b(g).props.flash)!=null&&d.error||i.value?(o(),a("div",K,u(b(g).props.flash.error||i.value),1)):v("",!0),h.selectedUserId?(o(),a("div",O,[e("div",Q,[e("div",X,[e("div",null,[t[6]||(t[6]=e("p",{class:"text-sm font-medium text-slate-700"},"User Balance",-1)),e("p",Y,"$"+u(_.value.toFixed(2)),1)]),e("div",null,[t[7]||(t[7]=e("p",{class:"text-sm font-medium text-slate-700"},"Frozen Balance",-1)),e("p",Z,"$"+u(k.value.toFixed(2)),1)])]),T(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s),type:"number",step:"0.01",min:"0.01",placeholder:"Enter amount",class:"mt-4 w-full max-w-md h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[V,l.value]]),e("div",ee,[e("button",{onClick:t[1]||(t[1]=s=>w("add")),class:"px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!l.value||parseFloat(l.value)<=0}," Add ",8,te),e("button",{onClick:t[2]||(t[2]=s=>w("subtract")),class:"px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!l.value||parseFloat(l.value)<=0||_.value<parseFloat(l.value)}," Subtract ",8,se),e("button",{onClick:t[3]||(t[3]=s=>w("freeze")),class:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!l.value||parseFloat(l.value)<=0||_.value<parseFloat(l.value)}," Freeze Balance ",8,ae),e("button",{onClick:t[4]||(t[4]=s=>w("unfreeze")),class:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!l.value||parseFloat(l.value)<=0||k.value<parseFloat(l.value)}," Unfreeze Balance ",8,oe)])])])):v("",!0),e("div",re,[e("div",le,[e("table",ne,[t[11]||(t[11]=e("thead",null,[e("tr",{class:"bg-white/20 text-slate-700 text-sm font-medium"},[e("th",{class:"p-4 text-left"},"Deposits")])],-1)),e("tbody",null,[e("tr",null,[e("td",de,[x.value.length===0?(o(),a("div",ie,"No deposits")):(o(),a("div",ue,[(o(!0),a($,null,M(x.value,s=>{var f;return o(),a("div",{key:s.id,class:"bg-white/30 backdrop-blur-sm rounded-xl p-3 border border-white/30 shadow-lg"},[e("div",ce,[s.slip_path?(o(),a("div",me,[e("a",{href:"/storage/"+s.slip_path,target:"_blank"},[e("img",{src:"/storage/"+s.slip_path,alt:"Deposit Slip",class:"w-10 h-10 object-cover rounded"},null,8,ve)],8,pe)])):(o(),a("div",fe,"No Image")),e("div",be,[e("div",he,[e("div",ge,[t[8]||(t[8]=e("strong",null,"User:",-1)),y(" "+u(((f=s.user)==null?void 0:f.name)||"Unknown"),1)]),s.vip_level||s.title&&s.title.toLowerCase().includes("vip")?(o(),a("span",xe," VIP Purchase ")):v("",!0),s.title?(o(),a("span",_e,u(s.title),1)):v("",!0)]),e("div",we,[t[9]||(t[9]=e("strong",null,"Amount:",-1)),y(" "+u(s.amount)+" "+u(s.symbol),1)]),e("div",ye,[t[10]||(t[10]=e("strong",null,"Date:",-1)),y(" "+u(new Date(s.created_at).toLocaleString()),1)]),e("div",ke,[s.status==="approved"?(o(),a("span",Fe,"Approved")):s.status==="rejected"?(o(),a("span",Ue,"Rejected")):(o(),a($,{key:2},[e("button",{onClick:S=>I(s.id,"approve"),class:"px-3 py-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg text-xs font-medium transition-all duration-200 shadow-lg"},"Approve",8,Se),e("button",{onClick:S=>I(s.id,"reject"),class:"px-3 py-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg text-xs font-medium transition-all duration-200 shadow-lg"},"Reject",8,$e)],64))])])])])}),128))]))])])])])])])])]}),_:1})],64))}},Ce=L(Ne,[["__scopeId","data-v-0d242f89"]]);export{Ce as default};
