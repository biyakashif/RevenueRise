import{u as W,r as u,D as v,q as K,a as n,b as q,k as b,w as U,e as o,t as g,o as i,F as E,j as Y,z as T,d as r,i as O,C as R,g as X,m as P}from"./app-DxfmXC0O.js";import{_ as G}from"./AuthenticatedLayout-jOjBsgM5.js";const J={class:"absolute inset-0 flex flex-col"},Q={class:"flex items-center justify-between px-4 py-3 bg-gradient-to-br from-cyan-400/30 via-blue-500/25 to-indigo-600/30 backdrop-blur-xl text-white shadow-md border-b border-cyan-300/30 rounded-t-2xl sm:rounded-t-3xl"},Z={class:"text-lg text-blue-500 font-semibold"},ee={class:"flex-1 overflow-y-auto p-4 bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl"},te={key:0,class:"flex items-center justify-center h-full"},se={class:"text-center py-8 px-4 bg-red-50 rounded-lg border border-red-200"},oe={class:"text-lg font-semibold text-red-800 mb-2"},ae={class:"text-red-600"},re={key:1,class:"flex items-center justify-center h-full text-slate-600"},ne={key:0,class:"w-8 h-8 rounded-full overflow-hidden border flex-shrink-0"},ie=["src","alt"],le={key:1,class:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},de={key:0,class:"mb-2"},ce=["src","onClick"],ue={key:1,class:"mb-2 relative"},pe=["onClick"],he=["src"],ve=["innerHTML"],fe={class:"border-t border-cyan-300/30 p-3 bg-gradient-to-br from-cyan-400/30 via-blue-500/25 to-indigo-600/30 backdrop-blur-xl flex items-center space-x-2 rounded-b-2xl sm:rounded-b-3xl"},me={key:0,class:"w-full text-center py-4 text-red-600 bg-red-50 rounded-lg"},be=["title"],ge=["title"],_e=["placeholder","onKeydown"],we={class:"relative max-w-4xl max-h-4xl"},xe=["src"],ye=["src"],je={__name:"Index",setup(ke){var S;const a=W(),c=u([]),d=s=>a.props.translations[s]||s,f=u(""),_=u(null),w=u(null),M=u(!1),x=u(""),y=u(""),k=new Audio("/notification.mp3"),j=u(""),m=u(!1);v.defaults.headers.common["X-CSRF-TOKEN"]=a.props.csrf_token||((S=document.querySelector('meta[name="csrf-token"]'))==null?void 0:S.getAttribute("content")),v.defaults.withCredentials=!0;const I=async()=>{try{const s=await v.get("/chat/messages",{headers:{"X-CSRF-TOKEN":a.props.csrf_token}});c.value=s.data.sort((e,t)=>new Date(e.created_at)-new Date(t.created_at)),setTimeout(()=>{const e=document.querySelector(".overflow-y-auto");e&&(e.scrollTop=e.scrollHeight)},100),window.dispatchEvent(new CustomEvent("chat:read"))}catch(s){console.error("Error loading messages:",s)}},L=async()=>{var s,e,t,l;try{if(m.value||!f.value.trim()&&!((s=_.value)!=null&&s.files[0])&&!((e=w.value)!=null&&e.files[0]))return;const p=f.value;f.value="";const C=(await v.post("/chat/broadcast",{message:p,_token:a.props.csrf_token})).data;if(C&&C.id){const B={id:C.id,message:p,image_path:null,video_path:null,created_at:C.created_at,sender_id:a.props.auth.user.id,recipient_id:null};c.value.some(h=>h.id===B.id)||(c.value.push(B),c.value.sort((h,V)=>new Date(h.created_at)-new Date(V.created_at)),setTimeout(()=>{const h=document.querySelector(".overflow-y-auto");h&&(h.scrollTop=h.scrollHeight)},50))}_.value&&(_.value.value=""),w.value&&(w.value.value="")}catch(p){f.value=messageText,console.error("Error sending message:",p),alert(((l=(t=p.response)==null?void 0:t.data)==null?void 0:l.error)||d("Error sending message. Please try again."))}},z=async s=>{const e=s.target.files[0];if(!e||m.value)return;const t=new FormData;t.append("image",e),t.append("_token",a.props.csrf_token),await v.post("/chat/send",t),s.target.value=""},N=async s=>{const e=s.target.files[0];if(!e||m.value)return;if(e.size>30*1024*1024){j.value=d("The video file size must not exceed 30MB."),s.target.value="";return}j.value="";const t=new FormData;t.append("video",e),t.append("_token",a.props.csrf_token),await v.post("/chat/send",t),s.target.value=""},F=s=>{if(s&&s.target){s.target.style.display="none";const e=s.target.parentElement;e&&(e.innerHTML='<i class="fas fa-user text-gray-400"></i>',e.classList.add("flex","items-center","justify-center"))}},A=(s,e)=>{x.value=s,y.value=e,M.value=!0},$=()=>{M.value=!1,x.value="",y.value=""},H=()=>{window.history.back()};K(()=>{I(),D(),window.Echo&&window.Echo.private(`chat.${a.props.auth.user.id}`).listen("NewChatMessage",e=>{c.value.some(l=>l.id===e.chat.id)||(c.value.push({id:e.chat.id,message:e.chat.message,image_path:e.chat.image_path,video_path:e.chat.video_path,created_at:e.chat.created_at,sender_id:e.chat.sender_id,recipient_id:e.chat.recipient_id}),c.value.sort((l,p)=>new Date(l.created_at)-new Date(p.created_at)),setTimeout(()=>{const l=document.querySelector(".overflow-y-auto");l&&(l.scrollTop=l.scrollHeight)},50),e.chat.sender_id!==a.props.auth.user.id&&k.play().catch(()=>{}),window.dispatchEvent(new CustomEvent("chat:read")))});const s=()=>{k.play().then(()=>{k.pause(),k.currentTime=0}).catch(()=>{}),window.removeEventListener("click",s),window.removeEventListener("keydown",s),window.removeEventListener("touchstart",s)};window.addEventListener("click",s),window.addEventListener("keydown",s),window.addEventListener("touchstart",s),setInterval(D,5e3)});const D=async()=>{try{const s=await v.get("/chat/block-status",{headers:{"X-CSRF-TOKEN":a.props.csrf_token}});m.value=s.data.is_blocked}catch(s){console.error("Error checking block status:",s)}};return(s,e)=>(i(),n(E,null,[q(G,{hideBottomNav:!0},{default:U(()=>[o("div",J,[o("div",Q,[o("button",{onClick:H,class:"text-blue-500 focus:outline-none mr-3"},[...e[3]||(e[3]=[o("i",{class:"fas fa-arrow-left"},null,-1)])]),o("div",Z,g(d("Support Chat")),1),e[4]||(e[4]=o("button",{class:"text-white focus:outline-none"},null,-1))]),o("div",ee,[m.value?(i(),n("div",te,[o("div",se,[e[5]||(e[5]=o("i",{class:"fas fa-ban text-red-500 text-4xl mb-4"},null,-1)),o("h3",oe,g(d("Account Blocked")),1),o("p",ae,g(d("You have been blocked by the administrator. You cannot send or receive messages.")),1)])])):c.value.length===0?(i(),n("div",re,g(d("No messages yet")),1)):(i(!0),n(E,{key:2},Y(c.value,t=>(i(),n("div",{key:t.id,class:T(["mb-4 flex",{"justify-end":t.sender_id===r(a).props.auth.user.id,"justify-start":t.sender_id!==r(a).props.auth.user.id}])},[o("div",{class:T(["flex items-start space-x-2 max-w-[85%]",t.sender_id===r(a).props.auth.user.id?"flex-row-reverse space-x-reverse":""])},[t.sender_id===r(a).props.auth.user.id&&r(a).props.auth.user.avatar_url||t.sender_id!==r(a).props.auth.user.id&&r(a).props.adminAvatar?(i(),n("div",ne,[o("img",{src:t.sender_id===r(a).props.auth.user.id?r(a).props.auth.user.avatar_url.startsWith("/storage")||r(a).props.auth.user.avatar_url.startsWith("/assets")?r(a).props.auth.user.avatar_url:`/storage/${r(a).props.auth.user.avatar_url}`:r(a).props.adminAvatar.startsWith("/storage")||r(a).props.adminAvatar.startsWith("/assets")?r(a).props.adminAvatar:`/storage/${r(a).props.adminAvatar}`,alt:t.sender_id===r(a).props.auth.user.id?"You":"Support",class:"w-full h-full object-cover",onError:F},null,40,ie)])):(i(),n("div",le,[...e[6]||(e[6]=[o("i",{class:"fas fa-user text-gray-400 text-xs"},null,-1)])])),o("div",{class:T(["rounded-lg p-3 text-sm",t.sender_id===r(a).props.auth.user.id?"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl border border-cyan-300/30 self-end":"bg-white/90 backdrop-blur-xl border border-white/50 self-start"])},[t.image_path?(i(),n("div",de,[o("img",{src:t.image_path.startsWith("/storage/")?t.image_path:`/storage/${t.image_path}`,alt:"chat image",class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:l=>A(t.image_path.startsWith("/storage/")?t.image_path:`/storage/${t.image_path}`,"image")},null,8,ce)])):b("",!0),t.video_path?(i(),n("div",ue,[o("video",{class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:l=>A(t.video_path.startsWith("/storage/")?t.video_path:`/storage/${t.video_path}`,"video")},[o("source",{src:t.video_path.startsWith("/storage/")?t.video_path:`/storage/${t.video_path}`,type:"video/mp4"},null,8,he)],8,pe),e[7]||(e[7]=o("div",{class:"absolute inset-0 flex items-center justify-center pointer-events-none"},[o("i",{class:"fas fa-play-circle text-white text-2xl opacity-80"})],-1))])):b("",!0),t.message?(i(),n("div",{key:2,class:"text-sm text-slate-800",innerHTML:t.message},null,8,ve)):b("",!0)],2)],2)],2))),128))]),o("div",fe,[m.value?(i(),n("div",me,g(d("You are blocked and cannot send messages.")),1)):(i(),n(E,{key:1},[o("input",{type:"file",ref_key:"imageInput",ref:_,class:"hidden",onChange:z,accept:"image/*"},null,544),o("button",{type:"button",onClick:e[0]||(e[0]=t=>s.$refs.imageInput.click()),class:"p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-md focus:outline-none border border-white/30 hover:bg-white/70 transition-all",title:d("Upload Image")},[...e[8]||(e[8]=[o("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,be),o("input",{type:"file",ref_key:"videoInput",ref:w,class:"hidden",onChange:N,accept:"video/mp4,video/x-matroska"},null,544),o("button",{type:"button",onClick:e[1]||(e[1]=t=>s.$refs.videoInput.click()),class:"p-2 bg-white/50 backdrop-blur-sm rounded-full shadow-md focus:outline-none border border-white/30 hover:bg-white/70 transition-all",title:d("Upload Video")},[...e[9]||(e[9]=[o("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])],8,ge),O(o("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),type:"text",placeholder:d("Type your message..."),class:"flex-1 px-3 py-2 rounded-full bg-white/50 backdrop-blur-sm border border-white/30 focus:outline-none focus:ring-2 focus:ring-cyan-400 text-slate-900 placeholder-slate-500 text-sm",onKeydown:R(X(L,["exact","prevent"]),["enter"])},null,40,_e),[[P,f.value]]),o("button",{type:"button",onClick:L,class:"p-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-full shadow-md focus:outline-none transition-all duration-200"},[...e[10]||(e[10]=[o("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[o("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])])],64))])])]),_:1}),M.value?(i(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:$},[o("div",we,[o("button",{onClick:$,class:"absolute -top-10 right-0 text-white text-2xl hover:text-gray-300"},[...e[11]||(e[11]=[o("i",{class:"fas fa-times"},null,-1)])]),y.value==="image"?(i(),n("img",{key:0,src:x.value,alt:"Full size image",class:"max-w-full max-h-screen object-contain"},null,8,xe)):b("",!0),y.value==="video"?(i(),n("video",{key:1,src:x.value,controls:"",autoplay:"",class:"max-w-full max-h-screen"},null,8,ye)):b("",!0)])])):b("",!0)],64))}};export{je as default};
