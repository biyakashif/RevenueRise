import{u as N,r as d,q as D,s as $,a as l,b as C,d as A,h as X,w as O,e,k as b,i as W,m as T,o as n,F as _,j as S,x as y,t as i,z as P,g as V,H as q,n as I}from"./app-DxfmXC0O.js";import{_ as z}from"./AdminLayout-B6Je0JR7.js";const B={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},H={class:"flex items-center justify-between mb-4"},K={class:"w-1/3"},J={class:"flex justify-between items-start"},Q={class:"font-semibold text-slate-800 text-sm"},Y={class:"text-xs text-slate-600"},G={class:"text-xs text-slate-600 mt-1"},Z={class:"text-slate-800"},tt=["onClick"],et={class:"mt-2 space-y-2"},ot={class:"flex justify-between"},st={class:"flex items-center gap-2 mb-1"},at={class:"text-sm text-slate-800 font-semibold"},rt={key:0,class:"px-2 py-0.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-full text-xs font-medium shadow-sm"},it={class:"text-xs text-slate-600 mb-1"},lt={class:"text-xs text-slate-500"},nt={class:"flex flex-col items-end space-y-2"},dt={class:"flex space-x-2"},ct=["onClick"],ut=["onClick"],ht=["onClick"],wt={class:"mb-4"},mt={key:0,class:"text-sm text-red-600 mb-4 bg-red-100/80 p-2 rounded-lg"},pt={class:"flex justify-end space-x-2"},ft={__name:"Withdrawals",setup(bt){const f=N(),m=d([]);d(1),d(1);const c=d(""),w=async(s="")=>{try{const t=s?`/admin/withdrawals?search=${encodeURIComponent(s)}`:"/admin/withdrawals",a=await fetch(t,{headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`HTTP ${a.status}`);const o=await a.json();m.value=(o.data||[]).map(r=>({...r,withdraw_limit:h(r.withdraw_limit)}))}catch{}};D(()=>{w(c.value),console.log("[Withdrawals] Component mounted");const s=()=>{if(!window.Echo){console.log("[Withdrawals] Echo not ready, waiting..."),setTimeout(s,100);return}console.log("[Withdrawals] Echo ready, setting up listeners"),window.Echo.channel("withdrawals").listen("WithdrawalCreated",t=>{console.log("[Withdrawals] ✅ WithdrawalCreated event received:",t),w(c.value)}).listen("WithdrawalStatusUpdated",t=>{var a,o;if(console.log("[Withdrawals] ✅ WithdrawalStatusUpdated event received:",t),(a=t==null?void 0:t.withdrawal)!=null&&a.id&&((o=t==null?void 0:t.withdrawal)!=null&&o.user_id)){const r=m.value.find(x=>x.id===t.withdrawal.user_id);if(r&&r.withdraws){const x=r.withdraws.findIndex(M=>M.id===t.withdrawal.id);x!==-1&&(r.withdraws[x].status=t.withdrawal.status,m.value=[...m.value])}}}),console.log("[Withdrawals] Withdrawal channel listeners attached")};s()}),$(()=>{window.Echo&&window.Echo.leaveChannel("withdrawals")});const j=()=>{w(c.value)},U=async s=>{try{const t=await fetch(route("admin.withdrawals.approve",s),{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":f.props.csrf_token}});if(!t.ok){if(t.status===419){window.location.reload();return}throw new Error("Approve failed")}await w(c.value)}catch{}},E=async s=>{try{const t=await fetch(route("admin.withdrawals.reject",s),{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":f.props.csrf_token}});if(!t.ok){if(t.status===419){window.location.reload();return}throw new Error("Reject failed")}await w(c.value)}catch{}},L=s=>{I.visit(route("admin.withdrawals.edit",s))},p=d(!1),k=d(null),v=d(""),u=d(""),g=d({top:0,left:0}),R=(s,t,a)=>{k.value=s,v.value=t;const o=a.target.getBoundingClientRect();g.value={top:o.bottom+window.scrollY+10,left:Math.max(10,o.left+window.scrollX-200)},p.value=!0,u.value=""},h=s=>{if(s==null||s==="")return"0.00";const t=Number(s);return isFinite(t)?t.toFixed(2):"0.00"},F=async()=>{u.value="";try{const s=await fetch(route("admin.users.withdraw-limit.update",k.value),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":f.props.csrf_token},body:JSON.stringify({withdraw_limit:h(v.value)})}),t=await s.json();if(!s.ok){if(s.status===419){window.location.reload();return}throw new Error(t.message||"Failed to update withdraw limit")}p.value=!1,await w(c.value)}catch(s){u.value=s.message||"Failed to update withdraw limit",setTimeout(()=>u.value="",5e3)}};return(s,t)=>(n(),l(_,null,[C(A(X),{title:"Withdrawals"}),C(z,null,{default:O(()=>[e("div",B,[e("div",H,[t[6]||(t[6]=e("h1",{class:"text-lg font-bold text-slate-800 drop-shadow-sm"},"Withdrawals",-1)),e("div",K,[W(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a),onInput:j,type:"text",placeholder:"Search name, mobile or code...",class:"w-full h-10 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,544),[[T,c.value]])])]),(n(!0),l(_,null,S(m.value,a=>(n(),l("div",{key:a.id,class:"mb-4 bg-white/20 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/30"},[e("div",J,[e("div",null,[e("h3",Q,[y(i(a.name)+" ",1),e("span",Y,"— "+i(a.mobile_number)+" / "+i(a.invitation_code),1)]),e("div",G,[t[7]||(t[7]=y(" Withdraw Limit: ",-1)),e("strong",Z,i(h(a.withdraw_limit)),1),t[8]||(t[8]=y(" USDT ",-1)),e("button",{onClick:o=>R(a.id,h(a.withdraw_limit),o),class:"ml-2 text-xs bg-white/20 backdrop-blur-sm px-2 py-1 rounded-lg hover:bg-white/30 transition-colors text-slate-700 border border-white/30"}," Change Limit ",8,tt)])])]),e("div",et,[(n(!0),l(_,null,S(a.withdraws,o=>(n(),l("div",{key:o.id,class:"bg-white/10 backdrop-blur-sm p-3 rounded-lg border border-white/20"},[e("div",ot,[e("div",null,[e("div",st,[e("span",at,i(h(o.amount_withdraw))+" USDT",1),o.crypto_symbol&&o.crypto_symbol!=="USDT"?(n(),l("span",rt,i(o.crypto_amount?o.crypto_symbol==="USDT"?h(o.crypto_amount):Number(o.crypto_amount).toFixed(6):h(o.amount_withdraw))+" "+i(o.crypto_symbol),1)):b("",!0)]),e("div",it,"To: "+i(o.crypto_wallet),1),e("div",lt,i(new Date(o.created_at).toLocaleString()),1)]),e("div",nt,[e("div",null,[e("span",{class:P({"px-2 py-1 rounded text-xs":!0,"bg-yellow-100 text-yellow-800":o.status==="under review","bg-green-100 text-green-800":o.status==="approved","bg-red-100 text-red-800":o.status==="rejected"})},i(o.status.split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")),3)]),e("div",dt,[o.status==="under review"?(n(),l("button",{key:0,onClick:r=>U(o.id),class:"bg-gradient-to-r from-green-500 to-green-600 text-white px-3 py-1 rounded text-xs hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200"},"Approve",8,ct)):b("",!0),o.status==="under review"?(n(),l("button",{key:1,onClick:r=>E(o.id),class:"bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-1 rounded text-xs hover:from-red-600 hover:to-red-700 transform hover:scale-105 transition-all duration-200"},"Reject",8,ut)):b("",!0),e("button",{onClick:r=>L(o.id),class:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-3 py-1 rounded text-xs hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition-all duration-200"},"Edit",8,ht)])])])]))),128))])]))),128))]),p.value?(n(),l("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-40 z-50",onClick:t[5]||(t[5]=a=>p.value=!1)},[e("div",{class:"absolute bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl rounded-lg p-6 w-full max-w-md border border-white/20",style:q({top:g.value.top+"px",left:g.value.left+"px"}),onClick:t[4]||(t[4]=V(()=>{},["stop"]))},[t[10]||(t[10]=e("h3",{class:"text-lg font-semibold mb-4 text-slate-800"},"Update Withdraw Limit",-1)),e("div",wt,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Minimum Withdraw Amount (USDT)",-1)),W(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>v.value=a),type:"number",step:"0.01",class:"w-full h-10 rounded-lg bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-3 placeholder-slate-400 backdrop-blur-sm shadow-lg",min:"0.01"},null,512),[[T,v.value]])]),u.value?(n(),l("div",mt,i(u.value),1)):b("",!0),e("div",pt,[e("button",{onClick:t[2]||(t[2]=a=>{p.value=!1,u.value=""}),class:"px-4 py-2 bg-white/20 backdrop-blur-sm rounded-lg text-sm hover:bg-white/30 text-slate-700 border border-white/30"}," Cancel "),e("button",{onClick:t[3]||(t[3]=a=>F()),class:"px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded text-sm hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition-all duration-200"}," Update ")])],4)])):b("",!0)]),_:1})],64))}};export{ft as default};
