import{u as B,r as v,c as N,A,s as P,g as V,a as l,b as E,d as M,h as L,w as R,e as s,m as f,x as k,o as r,t as u,z as H,j as q,n as G,F as C,k as J,p as D}from"./app-C5R0GNTt.js";import{_ as K}from"./AdminLayout-3-NIxIvz.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},X={class:"text-lg font-bold text-slate-800 drop-shadow-sm mb-4"},Y={key:0,class:"block text-base font-medium text-slate-700"},Z={key:0,class:"ml-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 inline-flex items-center justify-center"},ee={key:1,class:"text-sm font-medium text-slate-600"},te={key:1,class:"mb-6 p-4 rounded-xl bg-red-100/80 border border-red-200 text-red-700 text-sm flex items-center gap-2 backdrop-blur-sm"},se={key:2,class:"mb-6"},ae={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm p-4 rounded-xl shadow-lg border border-white/30"},oe={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},le={class:"text-lg font-semibold text-slate-800"},re={class:"text-lg font-semibold text-slate-800"},ne={class:"mt-4 flex flex-wrap gap-3"},de=["disabled"],ie=["disabled"],ue=["disabled"],ce=["disabled"],pe={class:"bg-gradient-to-r from-white/40 via-white/30 to-white/20 backdrop-blur-sm rounded-xl shadow-lg overflow-hidden border border-white/30"},me={class:"overflow-x-auto"},ve={class:"w-full"},fe={class:"p-4 align-top"},ge={key:0,class:"text-slate-500 text-sm"},he={key:1,class:"space-y-3"},be={class:"flex items-start"},xe={key:0,class:"mr-2"},_e=["href"],we=["src"],ye={key:1,class:"mr-2 text-gray-500 text-[10px]"},ke={class:"flex-1"},Ue={class:"flex items-center gap-1 flex-wrap"},Se={class:"text-[11px] font-medium text-slate-700"},Fe={key:0,class:"inline-flex items-center px-1.5 py-0.5 bg-yellow-100 text-yellow-800 text-[9px] font-medium rounded-full"},Ce={key:1,class:"text-[10px] text-slate-600 italic"},De={class:"text-[11px] text-slate-700"},Te={key:0,class:"ml-1 px-1 py-0.5 bg-cyan-100 text-cyan-700 rounded text-[9px] font-medium"},$e={class:"text-[10px] text-slate-600"},ze={class:"mt-1 flex justify-end gap-1"},Ie={key:0,class:"text-green-600 text-[10px] font-semibold"},Ne={key:1,class:"text-red-600 text-[10px] font-semibold"},Ee=["onClick"],We=["onClick"],je={__name:"UpdateWallet",props:{deposits:{type:Array,default:()=>[]},selectedUserId:{type:[String,Number],default:null},balance:{type:[Number,String],default:0},frozen_balance:{type:[Number,String],default:0},userName:{type:String,default:null},mobile_number:{type:String,default:null}},setup(x){const i=x,g=B(),p=v([...i.deposits]),_=v(parseFloat(i.balance)||0),U=v(parseFloat(i.frozen_balance)||0),S=v(i.userName),F=v(i.mobile_number),d=v(""),n=v(""),T=N(()=>p.value.filter(a=>a.status==="pending").length),h=v(""),b=v(""),W=N(()=>({"bg-green-100 border-green-500 text-green-700":b.value==="success","bg-red-100 border-red-500 text-red-700":b.value==="error"}));A(()=>g.props.flash,a=>{a.success?(h.value=a.success,b.value="success"):a.error?(h.value=a.error,b.value="error"):(h.value="",b.value=""),h.value&&setTimeout(()=>{h.value="",g.props.flash.success&&(g.props.flash.success=null),g.props.flash.error&&(g.props.flash.error=null)},2e3)},{deep:!0});const m=async()=>{if(i.selectedUserId)try{const a=await fetch(`/admin/update-wallet?user_id=${i.selectedUserId}`,{headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);const t=await a.json();p.value=t.deposits||[],_.value=parseFloat(t.balance)||0,U.value=parseFloat(t.frozen_balance)||0,S.value=t.userName||"Unknown",F.value=t.mobile_number||"Unknown",n.value=""}catch(a){n.value=`Failed to fetch wallet data: ${a.message}. Please try again.`,setTimeout(()=>n.value="",5e3)}};P(()=>{m(),console.log("[UpdateWallet] Component mounted for user:",i.selectedUserId);const a=()=>{if(!window.Echo){console.log("[UpdateWallet] Echo not ready, waiting..."),setTimeout(a,100);return}if(!i.selectedUserId){console.log("[UpdateWallet] No user selected, skipping Echo setup");return}console.log("[UpdateWallet] Echo ready, setting up listeners"),window.Echo.channel("deposits").listen("DepositCreated",t=>{var e;console.log("[UpdateWallet] ✅ DepositCreated event received:",t),(e=t==null?void 0:t.deposit)!=null&&e.user_id&&String(t.deposit.user_id)===String(i.selectedUserId)&&(console.log("[UpdateWallet] Deposit is for current user, fetching data"),m())}).listen("DepositStatusUpdated",t=>{var e;if(console.log("[UpdateWallet] ✅ DepositStatusUpdated event received:",t),(e=t==null?void 0:t.deposit)!=null&&e.user_id&&String(t.deposit.user_id)===String(i.selectedUserId)){console.log("[UpdateWallet] Status update is for current user");const o=p.value.findIndex(c=>c.id===t.deposit.id);o!==-1&&(p.value[o].status=t.deposit.status,p.value=[...p.value]),m()}}),console.log("[UpdateWallet] Deposit channel listeners attached")};a()}),V(()=>{window.Echo&&window.Echo.leaveChannel("deposits")});const $=async(a,t)=>{if(t==="approve"){const e=p.value.find(o=>o.id===a);if(!e){n.value="Deposit not found.",setTimeout(()=>n.value="",3e3);return}try{const o=await fetch(`https://api.coinbase.com/v2/exchange-rates?currency=${e.symbol}`);if(!o.ok)throw new Error(`Failed to fetch exchange rate: ${o.status}`);const c=await o.json();if(!c.data||!c.data.rates||!c.data.rates.USDT)throw new Error("Invalid exchange rate data received");const z=parseFloat(c.data.rates.USDT),j=parseFloat(e.amount)*z;D.post(`/admin/update-deposit/${a}`,{action:t,converted_amount:j,original_amount:e.amount,symbol:e.symbol,exchange_rate:z,_token:g.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m()},onError:y=>{var I;if(y&&((I=y.message)!=null&&I.includes("419")||y.status===419)){window.location.reload();return}n.value=y.action||"Failed to approve deposit.",setTimeout(()=>n.value="",5e3),m()}})}catch(o){n.value=`Failed to get exchange rate: ${o.message}. Please try again.`,setTimeout(()=>n.value="",5e3);return}}else D.post(`/admin/update-deposit/${a}`,{action:t,_token:g.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m()},onError:e=>{var o;if(e&&((o=e.message)!=null&&o.includes("419")||e.status===419)){window.location.reload();return}n.value=e.action||"Failed to update deposit status.",setTimeout(()=>n.value="",5e3),m()}})},w=a=>{const t=parseFloat(d.value);if(isNaN(t)||t<=0){n.value="Please enter a valid amount greater than 0.",setTimeout(()=>n.value="",3e3);return}let e;a==="freeze"?e=route("admin.freeze-balance",i.selectedUserId):a==="unfreeze"?e=route("admin.unfreeze-balance",i.selectedUserId):e=`/admin/update-balance/${i.selectedUserId}`,D.post(e,{amount:t,action:a==="freeze"||a==="unfreeze"?"subtract":a,_token:g.props.csrf_token},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{m(),d.value="",n.value=""},onError:o=>{var c;if(o&&((c=o.message)!=null&&c.includes("419")||o.status===419)){window.location.reload();return}n.value=o.error||o.amount||o.action||"Failed to update balance. Please check the server configuration.",setTimeout(()=>n.value="",5e3),m()}})};return(a,t)=>(r(),l(C,null,[E(M(L),{title:"Update Wallet"}),E(K,null,{default:R(()=>[s("div",Q,[s("h1",X,[t[5]||(t[5]=k(" Update Wallet ",-1)),x.selectedUserId&&S.value?(r(),l("span",Y,[k(" for "+u(S.value)+" ",1),T.value>0?(r(),l("span",Z,u(T.value),1)):f("",!0)])):f("",!0),x.selectedUserId&&F.value?(r(),l("span",ee," Mobile: "+u(F.value),1)):f("",!0)]),h.value?(r(),l("div",{key:0,class:H([W.value,"mb-6 p-4 rounded-xl bg-green-100/80 border border-green-200 text-green-700 text-sm flex items-center gap-2 backdrop-blur-sm"])},u(h.value),3)):f("",!0),n.value?(r(),l("div",te,u(n.value),1)):f("",!0),x.selectedUserId?(r(),l("div",se,[s("div",ae,[s("div",oe,[s("div",null,[t[6]||(t[6]=s("p",{class:"text-sm font-medium text-slate-700"},"User Balance",-1)),s("p",le,"$"+u(_.value.toFixed(2)),1)]),s("div",null,[t[7]||(t[7]=s("p",{class:"text-sm font-medium text-slate-700"},"Frozen Balance",-1)),s("p",re,"$"+u(U.value.toFixed(2)),1)])]),q(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),type:"number",step:"0.01",min:"0.01",placeholder:"Enter amount",class:"mt-4 w-full max-w-md h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[G,d.value]]),s("div",ne,[s("button",{onClick:t[1]||(t[1]=e=>w("add")),class:"px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0}," Add ",8,de),s("button",{onClick:t[2]||(t[2]=e=>w("subtract")),class:"px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0||_.value<parseFloat(d.value)}," Subtract ",8,ie),s("button",{onClick:t[3]||(t[3]=e=>w("freeze")),class:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0||_.value<parseFloat(d.value)}," Freeze Balance ",8,ue),s("button",{onClick:t[4]||(t[4]=e=>w("unfreeze")),class:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white rounded-lg text-sm font-medium transition-all duration-300 transform hover:scale-[1.02] shadow-lg disabled:opacity-50",disabled:!d.value||parseFloat(d.value)<=0||U.value<parseFloat(d.value)}," Unfreeze Balance ",8,ce)])])])):f("",!0),s("div",pe,[s("div",me,[s("table",ve,[t[10]||(t[10]=s("thead",null,[s("tr",{class:"bg-white/20 text-slate-700 text-sm font-medium"},[s("th",{class:"p-4 text-left"},"Deposits")])],-1)),s("tbody",null,[s("tr",null,[s("td",fe,[p.value.length===0?(r(),l("div",ge,"No deposits")):(r(),l("div",he,[(r(!0),l(C,null,J(p.value,e=>{var o;return r(),l("div",{key:e.id,class:"bg-white/30 backdrop-blur-sm rounded-xl p-2 border border-white/30 shadow-lg"},[s("div",be,[e.slip_path?(r(),l("div",xe,[s("a",{href:"/storage/"+e.slip_path,target:"_blank"},[s("img",{src:"/storage/"+e.slip_path,alt:"Deposit Slip",class:"w-8 h-8 object-cover rounded"},null,8,we)],8,_e)])):(r(),l("div",ye,"No Image")),s("div",ke,[s("div",Ue,[s("div",Se,[t[8]||(t[8]=s("strong",null,"User:",-1)),k(" "+u(((o=e.user)==null?void 0:o.name)||"Unknown"),1)]),e.vip_level||e.title&&e.title.toLowerCase().includes("vip")?(r(),l("span",Fe," VIP ")):f("",!0),e.title?(r(),l("span",Ce,u(e.title),1)):f("",!0)]),s("div",De,[t[9]||(t[9]=s("strong",null,"Amount:",-1)),k(" "+u(e.symbol.toUpperCase()==="USDT"||e.symbol.toUpperCase()==="USDC"?parseFloat(e.amount).toFixed(2):e.amount)+" "+u(e.symbol.toUpperCase())+" ",1),(e.symbol.toUpperCase()==="USDT"||e.symbol.toUpperCase()==="USDC")&&e.network?(r(),l("span",Te,u(e.network),1)):f("",!0)]),s("div",$e,u(new Date(e.created_at).toLocaleString()),1),s("div",ze,[e.status==="approved"?(r(),l("span",Ie,"Approved")):e.status==="rejected"?(r(),l("span",Ne,"Rejected")):(r(),l(C,{key:2},[s("button",{onClick:c=>$(e.id,"approve"),class:"px-2 py-0.5 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded text-[10px] font-medium transition-all duration-200 shadow-lg"},"Approve",8,Ee),s("button",{onClick:c=>$(e.id,"reject"),class:"px-2 py-0.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded text-[10px] font-medium transition-all duration-200 shadow-lg"},"Reject",8,We)],64))])])])])}),128))]))])])])])])])])]),_:1})],64))}},Ve=O(je,[["__scopeId","data-v-98abeeb8"]]);export{Ve as default};
