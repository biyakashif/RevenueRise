import{u as De,r as f,c as Ie,q as Ue,s as je,p as Ge,w as X,a as v,k as b,e as i,o as g,b as ne,d as y,l as le,x as W,i as re,m as de,F as Z,j as ee,z as V,t as S,g as U,C as Ae,D as C,B as ue,n as ce}from"./app-B9zrzIaV.js";import{_ as Te}from"./AdminLayout-DU-wWOZ5.js";const Be={key:0,class:"bg-yellow-50 border-b border-yellow-200"},Fe={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-cyan-300/30 h-full overflow-y-auto"},Ke={class:"flex justify-between items-center mb-4"},Le={class:"flex space-x-2"},Pe={class:"flex h-[calc(100vh-8rem)]"},ze={class:"w-1/3 border-r border-white/20 overflow-y-auto"},We={class:"p-2"},Ve=["onClick"],Re={class:"flex items-center justify-between"},qe={class:"flex items-center space-x-3"},He={key:0,class:"w-10 h-10 rounded-full overflow-hidden border flex-shrink-0"},Qe=["src","alt"],Ye={key:1,class:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},Je={class:"flex items-center space-x-2"},Oe={class:"font-medium text-slate-800 flex items-center space-x-2"},Xe={key:0,class:"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full"},Ze={key:1,class:"bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs animate-pulse"},es={class:"text-xs text-slate-600"},ss={class:"flex items-center space-x-2"},ts={class:"flex flex-col space-y-1"},as=["onClick"],is=["onClick"],os=["onClick"],ns=["onClick"],ls=["onClick"],rs={class:"w-2/3 flex flex-col"},ds={key:0,class:"border-b border-white/20 p-3 bg-white/10 backdrop-blur-sm rounded-t-xl"},us={class:"flex items-center space-x-3"},cs={key:0,class:"w-10 h-10 rounded-full overflow-hidden border flex-shrink-0"},gs=["src","alt"],vs={key:1,class:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},_s={class:"font-medium text-slate-800"},hs={key:0,class:"ml-2 px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full"},ms={key:1,class:"ml-2 px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full"},fs={class:"text-xs text-slate-600"},ps={key:0,class:"w-8 h-8 rounded-full overflow-hidden border flex-shrink-0"},bs=["src","alt"],ws={key:1,class:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"},xs={key:0,class:"mb-2"},ys=["src","onClick"],ks={key:1,class:"mb-2 relative"},Ns=["onClick"],Cs=["src"],$s={key:2},Ms={key:2,class:"border-t border-white/20 p-3"},Ss={key:0,class:"text-center py-4 text-red-600"},Es=["onKeydown"],Ds={key:3,class:"flex-1 flex items-center justify-center text-slate-600"},Is={class:"relative max-w-4xl max-h-4xl"},Us=["src"],js=["src"],Gs={key:2,class:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-40"},As={key:3,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-40"},Ts={class:"bg-gradient-to-br from-cyan-400/20 via-blue-500/15 to-indigo-600/20 backdrop-blur-xl rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto border border-white/20 shadow-2xl"},Bs={key:0,class:"text-center py-8 text-white/70"},Fs={key:1,class:"space-y-3"},Ks={class:"font-medium text-white"},Ls={class:"text-sm text-white/70"},Ps={class:"text-xs text-white/50"},zs=["onClick"],qs={__name:"Support",setup(Ws){const m=De(),c=f([]),a=f(null),h=f([]),p=f(new Map),j=f(new Map),G=f(""),B=f(null),F=f(null),E=f(null),$=new Audio("/notification.mp3"),A=f(!1),R=f(!1),q=f(""),se=f(0),ge=f(0),ve=Ie(()=>{const t=q.value.toLowerCase();return c.value.filter(e=>{const s=e.name?e.name.toLowerCase():"",n=e.mobile_number?e.mobile_number.toString():"";return s.includes(t)||n.includes(t)}).map(e=>{var n;const s=((n=window.adminNotifications)==null?void 0:n.hasNotification(e.id,e.is_guest))||!1;return{...e,hasNotification:s,unread_count:s&&!e.unread_count?1:e.unread_count}}).sort((e,s)=>{if(e.hasNotification&&!s.hasNotification)return-1;if(!e.hasNotification&&s.hasNotification)return 1;const n=new Date(e.last_message_at||0);return new Date(s.last_message_at||0)-n})}),K=()=>{if(!R.value){A.value=!0;return}$.play().catch(t=>{console.error("Error playing notification sound:",t),A.value=!0})},H=async(t=!1)=>{const e=Date.now();if(!(!t&&e-se.value<1e3))try{se.value=e;const[s,n]=await Promise.all([C.get("/admin/chat/users"),C.get("/admin/guest-chat/users")]),d=(s.data||[]).map(l=>({...l,mobile_number:l.mobile_number!=null?String(l.mobile_number):l.mobile_number,unread_count:l.unread_count??0,is_guest:!1,is_blocked:l.is_blocked||!1})),r=(n.data||[]).map(l=>{const o={...l,mobile_number:l.mobile_number!=null?String(l.mobile_number):l.mobile_number,unread_count:l.unread_count??0,is_guest:!0,last_message_at:l.last_message_at};return j.value.set(l.session_id,o),o}),u=new Map;r.forEach(l=>{const o=l.id;u.set(o,{...l,is_guest:!0})}),d.forEach(l=>{const o=l.session_id||l.id;if(u.has(o)){const x=u.get(o);u.set(o,{...x,...l,is_guest:!0})}else u.set(o,l)});const _=Array.from(u.values()).reduce((l,o)=>(l.some(N=>o.session_id&&N.session_id===o.session_id||o.id&&N.id===o.id)||l.push(o),l),[]);c.value.length>0&&_.forEach(l=>{const o=c.value.find(x=>x.id===l.id&&x.is_guest===l.is_guest);o&&(l.unread_count||0)>(o.unread_count||0)&&(K(),"Notification"in window&&Notification.permission==="granted"&&new Notification("New Support Message",{body:`New message from ${l.name||"User"}`,icon:"/favicon.ico"}))}),c.value=_}catch(s){console.error("Error loading users:",s)}},w=new Set,D=()=>{ue(()=>{E.value&&(E.value.scrollTop=E.value.scrollHeight)})},_e=async t=>{try{a.value=t,ge.value=Date.now(),window.currentSelectedUser={id:t.id,session_id:t.session_id,is_guest:t.is_guest};const e=`${t.is_guest?"guest":"user"}-${t.id}`;window.adminNotifications&&window.adminNotifications.clearNotification(t.id,t.is_guest);const s=c.value.findIndex(n=>n.id===t.id&&n.is_guest===t.is_guest);if(s!==-1){const n=c.value[s];n.unread_count=0,n.hasNotification=!1,c.value.splice(s,1,{...n})}if(p.value.has(e)?h.value=p.value.get(e):h.value=[],w.clear(),h.value.forEach(n=>{w.add(String(n.id))}),p.value.has(e)&&ue(()=>{E.value&&(E.value.scrollTop=E.value.scrollHeight)}),!p.value.has(e)){let n;t.is_guest?n=`/admin/guest-chat/${t.id.replace("guest_","")}/messages`:n=`/admin/chat/${t.id}/messages`,C.get(n).then(d=>{var r,u;if(((r=a.value)==null?void 0:r.id)===t.id&&((u=a.value)==null?void 0:u.is_guest)===t.is_guest){const _=d.data.sort((l,o)=>new Date(l.created_at)-new Date(o.created_at));h.value=_,p.value.set(e,_),w.clear(),_.forEach(l=>{w.add(String(l.id))}),D()}}).catch(d=>{console.error("Error loading messages:",d)})}}catch(e){console.error("Error selecting user:",e)}},te=async()=>{var e,s;const t=G.value;try{if(!G.value.trim()&&!((e=B.value)!=null&&e.files[0])&&!((s=F.value)!=null&&s.files[0])||a.value.is_blocked)return;G.value="";let n;a.value.is_guest?n=`/admin/guest-chat/${a.value.id.replace("guest_","")}/broadcast`:n=`/admin/chat/${a.value.id}/broadcast`;const r=(await C.post(n,{message:t,recipient_id:a.value.id})).data;if(r&&r.id){const u={id:r.id,message:t,image_path:null,video_path:null,created_at:r.created_at,sender_id:m.props.auth.user.id,recipient_id:a.value.id};if(!w.has(String(r.id))){h.value.push(u),h.value.sort((l,o)=>new Date(l.created_at)-new Date(o.created_at));const _=`${a.value.is_guest?"guest":"user"}-${a.value.id}`;p.value.set(_,[...h.value]),D(),w.add(String(r.id))}}B.value&&(B.value.value=""),F.value&&(F.value.value="")}catch(n){G.value=t,console.error("Error sending message:",n),alert("Error sending message. Please try again.")}},he=async t=>{try{const e=t.target.files[0];if(!e||a.value.is_blocked)return;const s=new FormData;s.append("image",e);let n;a.value.is_guest?n=`/admin/guest-chat/${a.value.id.replace("guest_","")}/send`:n=`/admin/chat/${a.value.id}/send`;const r=(await C.post(n,s)).data;if(r&&r.id){const u={id:r.id,message:r.message||"",image_path:r.image_path,video_path:null,created_at:r.created_at,sender_id:m.props.auth.user.id,recipient_id:a.value.id};if(!w.has(String(r.id))){h.value.push(u),h.value.sort((l,o)=>new Date(l.created_at)-new Date(o.created_at));const _=`${a.value.is_guest?"guest":"user"}-${a.value.id}`;p.value.set(_,[...h.value]),D(),w.add(String(r.id))}}t.target.value=""}catch(e){console.error("Error uploading image:",e),alert("Error uploading image. Please try again.")}},ae=f(""),me=async t=>{const e=t.target.files[0];if(e&&e.size>30*1024*1024){ae.value="The video file size must not exceed 30MB.",t.target.value="";return}ae.value="";try{if(a.value.is_blocked)return;const s=new FormData;s.append("video",e);let n;a.value.is_guest?n=`/admin/guest-chat/${a.value.id.replace("guest_","")}/send`:n=`/admin/chat/${a.value.id}/send`;const r=(await C.post(n,s)).data;if(r&&r.id){const u={id:r.id,message:r.message||"",image_path:null,video_path:r.video_path,created_at:r.created_at,sender_id:m.props.auth.user.id,recipient_id:a.value.id};if(!w.has(String(r.id))){h.value.push(u),h.value.sort((l,o)=>new Date(l.created_at)-new Date(o.created_at));const _=`${a.value.is_guest?"guest":"user"}-${a.value.id}`;p.value.set(_,[...h.value]),D(),w.add(String(r.id))}}t.target.value=""}catch(s){console.error("Error uploading video:",s),alert("Error uploading video. Please try again.")}},Q=t=>{if(t&&t.target){t.target.style.display="none";const e=t.target.parentElement;e&&(e.innerHTML='<i class="fas fa-user text-gray-400"></i>',e.classList.add("flex","items-center","justify-center"))}};let T=null;Ue(()=>{if(window.currentSelectedUser=null,$.src="/notification.mp3",$.load(),localStorage.getItem("soundEnabled")==="1"?R.value=!0:A.value=!0,"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission(),c.value=[],j.value.clear(),window.Echo)try{window.Echo.leaveAllChannels()}catch{console.log("No existing channels to leave")}H(!0),window.Echo?(console.log("🔄 Setting up Echo listeners for admin chat..."),T=window.Echo.private(`chat.${m.props.auth.user.id}`).listen("NewChatMessage",e=>{if(console.log("📨 Received NewChatMessage event:",e),!(String(e.chat.sender_id)===String(m.props.auth.user.id))){K(),"Notification"in window&&Notification.permission==="granted"&&new Notification("New Support Message",{body:"New message from user",icon:"/favicon.ico"});let n=c.value.findIndex(d=>d.id===e.chat.sender_id&&!d.is_guest);if(n===-1){if(!c.value.some(r=>r.id===e.chat.sender_id)){const r={id:e.chat.sender_id,name:`User ${e.chat.sender_id}`,mobile_number:"",avatar_url:null,unread_count:1,is_guest:!1,last_message_at:e.chat.created_at,hasNotification:!0};c.value.push(r),window.adminNotifications.addNotification(e.chat.sender_id,!1),console.log("👥 Created new user from message:",r)}}else{const d=c.value[n];d.last_message_at=e.chat.created_at;const r=`user-${d.id}`;if(a.value&&!a.value.is_guest&&a.value.id===d.id){if(!w.has(String(e.chat.id))){const u={id:e.chat.id,message:e.chat.message,image_path:e.chat.image_path,video_path:e.chat.video_path,created_at:e.chat.created_at,sender_id:e.chat.sender_id,recipient_id:e.chat.recipient_id};h.value.push(u),h.value.sort((_,l)=>new Date(_.created_at)-new Date(l.created_at)),p.value.set(r,[...h.value]),D(),w.add(String(e.chat.id)),console.log("📨 Added user message to chat:",u)}d.unread_count=0,d.hasNotification=!1}else{const u=p.value.get(r)||[];if(!u.some(_=>_.id===e.chat.id)){const _={id:e.chat.id,message:e.chat.message,image_path:e.chat.image_path,video_path:e.chat.video_path,created_at:e.chat.created_at,sender_id:e.chat.sender_id,recipient_id:e.chat.recipient_id};u.push(_),u.sort((l,o)=>new Date(l.created_at)-new Date(o.created_at)),p.value.set(r,u)}d.unread_count=(d.unread_count||0)+1,d.hasNotification=!0,window.adminNotifications.addNotification(d.id,!1)}c.value.splice(n,1,{...d})}}}).listen("NewGuestChatMessage",e=>{var s,n;if(console.log("📨 Received NewGuestChatMessage on admin chat channel:",e),e.message&&e.message.sender_id&&e.message.is_guest){const d=String(e.message.sender_id)===String(m.props.auth.user.id),r=I.value.some(u=>u.session_id===e.message.sender_id);if(!d&&!r){K(),"Notification"in window&&Notification.permission==="granted"&&new Notification("New Support Message",{body:"New message from guest",icon:"/favicon.ico"});const u=e.message.sender_id;let _=j.value.get(u),l=-1;if(_)l=c.value.findIndex(o=>o.id===_.id&&o.is_guest),l===-1&&(c.value.push(_),l=c.value.length-1);else if(l=c.value.findIndex(o=>o.id===u&&o.is_guest),l===-1){const o={id:u,session_id:u,name:e.message.guest_name||`Guest ${u.substring(0,8)}`,mobile_number:e.message.guest_mobile||"N/A",avatar_url:null,unread_count:1,is_guest:!0,is_blocked:!1,last_message_at:e.message.created_at};j.value.set(u,o),c.value.push(o),l=c.value.length-1,console.log("👥 Created new guest user from admin chat channel:",o)}if(l!==-1){const o=c.value[l];o.last_message_at=e.message.created_at;const x=`guest-${o.id}`;if(console.log("🔍 Checking if guest is selected:",{selectedUserId:(s=a.value)==null?void 0:s.id,selectedUserIsGuest:(n=a.value)==null?void 0:n.is_guest,currentUserId:o.id,match:a.value&&a.value.is_guest&&a.value.id===o.id}),a.value&&a.value.is_guest&&a.value.id===o.id){if(!w.has(String(e.message.id))){const N={id:e.message.id,message:e.message.message,image_path:e.message.image_path||(e.message.is_image?e.message.message:null),video_path:e.message.video_path||null,created_at:e.message.created_at,sender_id:e.message.sender_id,recipient_id:m.props.auth.user.id,is_guest:!0};h.value.push(N),h.value.sort((M,O)=>new Date(M.created_at)-new Date(O.created_at)),p.value.set(x,[...h.value]),D(),w.add(String(e.message.id)),console.log("✅ Added guest message from admin chat channel to UI:",N)}o.unread_count=0,o.hasNotification=!1}else{const N=p.value.get(x)||[];if(!N.some(M=>M.id===e.message.id)){const M={id:e.message.id,message:e.message.message,image_path:e.message.image_path||(e.message.is_image?e.message.message:null),video_path:e.message.video_path||null,created_at:e.message.created_at,sender_id:e.message.sender_id,recipient_id:m.props.auth.user.id,is_guest:!0};N.push(M),N.sort((O,Ee)=>new Date(O.created_at)-new Date(Ee.created_at)),p.value.set(x,N),console.log("📦 Cached guest message for later:",M)}o.unread_count=(o.unread_count||0)+1,o.hasNotification=!0,window.adminNotifications.addNotification(o.id,!0)}c.value.splice(l,1,{...o})}}}}),window.Echo.private("guest-chat").listen("NewGuestChatMessage",e=>{if(console.log("📨 Received NewGuestChatMessage event:",e),e.message&&e.message.sender_id){const s=String(e.message.sender_id)===String(m.props.auth.user.id);if(e.message.is_guest===!0&&!s){K(),"Notification"in window&&Notification.permission==="granted"&&new Notification("New Support Message",{body:"New message from guest",icon:"/favicon.ico"});const d=e.message.sender_id;let r=j.value.get(d);if(r){let u=c.value.findIndex(_=>_.id===r.id&&_.is_guest);u===-1&&(c.value.push(r),u=c.value.length-1)}else{let u=c.value.findIndex(o=>o.id===d&&o.is_guest);if(u===-1){const o={id:d,session_id:d,name:e.message.guest_name||`Guest ${d.substring(0,8)}`,mobile_number:e.message.guest_mobile||"N/A",avatar_url:null,unread_count:1,is_guest:!0,is_blocked:!1,last_message_at:e.message.created_at};j.value.set(d,o),c.value.push(o),u=c.value.length-1,console.log("👥 Created new guest user from message:",o)}const _=c.value[u];_.last_message_at=e.message.created_at;const l=`guest-${_.id}`;if(a.value&&a.value.is_guest&&a.value.id===_.id){if(!w.has(String(e.message.id))){const o={id:e.message.id,message:e.message.message,image_path:e.message.image_path||(e.message.is_image?e.message.message:null),video_path:e.message.video_path||null,created_at:e.message.created_at,sender_id:e.message.sender_id,recipient_id:m.props.auth.user.id,is_guest:!0};h.value.push(o),h.value.sort((x,N)=>new Date(x.created_at)-new Date(N.created_at)),p.value.set(l,[...h.value]),D(),w.add(String(e.message.id)),console.log("📨 Added guest message to chat:",o)}_.unread_count=0,_.hasNotification=!1}else{const o=p.value.get(l)||[];if(!o.some(x=>x.id===e.message.id)){const x={id:e.message.id,message:e.message.message,image_path:e.message.image_path||(e.message.is_image?e.message.message:null),video_path:e.message.video_path||null,created_at:e.message.created_at,sender_id:e.message.sender_id,recipient_id:m.props.auth.user.id,is_guest:!0};o.push(x),o.sort((N,M)=>new Date(N.created_at)-new Date(M.created_at)),p.value.set(l,o)}_.unread_count=(_.unread_count||0)+1,_.hasNotification=!0,window.adminNotifications.addNotification(_.id,!0)}c.value.splice(u,1,{..._})}}}}),window.Echo.private(`chat.${m.props.auth.user.id}`).listen("ChatDeleted",e=>{var s,n;if(console.log("🗑️ Chat deleted:",e),c.value=c.value.filter(d=>e.is_guest?!(d.id===e.user_id&&d.is_guest):!(d.id===e.user_id&&!d.is_guest)),((s=a.value)==null?void 0:s.id)===e.user_id&&((n=a.value)==null?void 0:n.is_guest)===e.is_guest){a.value=null,h.value=[];const d=`${e.is_guest?"guest":"user"}-${e.user_id}`;p.value.delete(d)}}),console.log("✅ Echo listeners set up successfully")):console.log("❌ Echo not available, using polling fallback only");const t=()=>{$.play().then(()=>{$.pause(),$.currentTime=0}).catch(()=>{}),window.removeEventListener("click",t),window.removeEventListener("keydown",t),window.removeEventListener("touchstart",t)};return window.addEventListener("click",t),window.addEventListener("keydown",t),window.addEventListener("touchstart",t),()=>{}}),je(()=>{window.currentSelectedUser=null,T&&(T.stopListening("NewChatMessage"),T.stopListening("NewGuestChatMessage"),T.stopListening("ChatDeleted"))});const fe=()=>{$.play().then(()=>{$.pause(),$.currentTime=0,R.value=!0,A.value=!1,localStorage.setItem("soundEnabled","1")}).catch(()=>{A.value=!0})},L=f(!1),k=f(null),Y=f(!1),P=f(""),z=f(""),J=f(!1),I=f([]),pe=t=>{k.value=t,L.value=!0},be=()=>{k.value=null,L.value=!1},we=async()=>{var t,e;if(k.value)try{let s;if(k.value.is_guest?s=`/admin/guest-chat/${k.value.id.replace("guest_","")}/delete-history`:s=`/admin/chat/${k.value.id}/delete-history`,await C.delete(s),c.value=c.value.filter(n=>k.value.is_guest?!(n.id===k.value.id&&n.is_guest):!(n.id===k.value.id&&!n.is_guest)),((t=a.value)==null?void 0:t.id)===k.value.id&&((e=a.value)==null?void 0:e.is_guest)===k.value.is_guest){a.value=null,h.value=[];const n=`${k.value.is_guest?"guest":"user"}-${k.value.id}`;p.value.delete(n)}L.value=!1,k.value=null,setTimeout(()=>H(!0),500)}catch(s){console.error("Error deleting chat history:",s),alert("Failed to delete chat history. Please try again.")}},xe=async t=>{var e;try{const s=t.id.replace("guest_","");await C.post(`/admin/guest-chat/${s}/block`),c.value=c.value.filter(d=>d.id!==t.id),((e=a.value)==null?void 0:e.id)===t.id&&(a.value=null,h.value=[]);const n=`guest-${t.id}`;p.value.delete(n)}catch(s){console.error("Error blocking user:",s),alert("Failed to block user. Please try again.")}},ye=async t=>{var e;try{const s=t.id.replace("guest_","");await C.post(`/admin/guest-chat/${s}/unblock`),H(),((e=a.value)==null?void 0:e.id)===t.id&&(a.value={...a.value,is_blocked:!1})}catch(s){console.error("Error unblocking user:",s),alert("Failed to unblock user. Please try again.")}},ke=async()=>{try{const t=await C.get("/admin/guest-chat/blocked");I.value=t.data,J.value=!0}catch(t){console.error("Error loading blocked guests:",t)}},Ne=()=>{J.value=!1,I.value=[]},Ce=async t=>{try{await C.post(`/admin/guest-chat/${t}/unblock`),I.value=I.value.filter(e=>e.session_id!==t)}catch(e){console.error("Error unblocking guest:",e),alert("Failed to unblock guest. Please try again.")}},$e=t=>new Date(t).toLocaleString(),ie=(t,e)=>{P.value=t,z.value=e,Y.value=!0},oe=()=>{Y.value=!1,P.value="",z.value=""},Me=async t=>{if(confirm(`Are you sure you want to block ${t.name}?`))try{await ce.post(route("admin.users.block",t.id),{},{preserveScroll:!0,onSuccess:()=>{const e=c.value.findIndex(s=>s.id===t.id&&!s.is_guest);e!==-1&&(c.value[e].is_blocked=!0)}})}catch(e){console.error("Error blocking user:",e)}},Se=async t=>{if(confirm(`Are you sure you want to unblock ${t.name}?`))try{await ce.post(route("admin.users.unblock",t.id),{},{preserveScroll:!0,onSuccess:()=>{const e=c.value.findIndex(s=>s.id===t.id&&!s.is_guest);e!==-1&&(c.value[e].is_blocked=!1)}})}catch(e){console.error("Error unblocking user:",e)}};return(t,e)=>(g(),Ge(Te,null,{default:X(()=>[A.value?(g(),v("div",Be,[i("div",{class:"max-w-7xl mx-auto px-4 py-2 flex items-center justify-between text-sm"},[e[4]||(e[4]=i("div",{class:"text-yellow-800 flex items-center space-x-2"},[i("i",{class:"fas fa-bell mr-1"}),i("span",null,"Click enable to allow sound notifications.")],-1)),i("button",{onClick:fe,class:"px-3 py-1 bg-yellow-600 text-white rounded hover:bg-yellow-700"},"Enable sound")])])):b("",!0),i("div",Fe,[i("div",Ke,[e[8]||(e[8]=i("h1",{class:"text-lg font-bold text-slate-800 drop-shadow-sm"},"Support Chat",-1)),i("div",Le,[ne(y(le),{href:t.route("admin.auto-reply"),class:"px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm transition-all duration-200"},{default:X(()=>[...e[5]||(e[5]=[i("i",{class:"fas fa-robot mr-1"},null,-1),W(" Auto Reply ",-1)])]),_:1},8,["href"]),ne(y(le),{href:t.route("admin.blocked-users"),class:"px-3 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg text-sm transition-all duration-200"},{default:X(()=>[...e[6]||(e[6]=[i("i",{class:"fas fa-user-slash mr-1"},null,-1),W(" Block User ",-1)])]),_:1},8,["href"]),i("button",{onClick:ke,class:"px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm transition-all duration-200"},[...e[7]||(e[7]=[i("i",{class:"fas fa-ban mr-1"},null,-1),W(" Blocked Guests ",-1)])])])]),i("div",Pe,[i("div",ze,[i("div",We,[re(i("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>q.value=s),placeholder:"Search by name or mobile number",class:"w-full h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg"},null,512),[[de,q.value]])]),(g(!0),v(Z,null,ee(ve.value,s=>{var n,d;return g(),v("div",{key:`${s.is_guest?"guest":"user"}-${s.id}`,onClick:r=>_e(s),class:V(["relative p-4 hover:bg-white/10 cursor-pointer transition-all duration-200 rounded-xl mx-2 mb-2",{"bg-white/20":((n=a.value)==null?void 0:n.id)===s.id&&((d=a.value)==null?void 0:d.is_guest)===s.is_guest,"opacity-60":s.is_blocked,"border-l-4 border-red-500":s.is_blocked}])},[i("div",Re,[i("div",qe,[s.avatar_url?(g(),v("div",He,[i("img",{src:s.avatar_url.startsWith("/storage")||s.avatar_url.startsWith("/assets")?s.avatar_url:`/storage/${s.avatar_url}`,alt:s.name,class:"w-full h-full object-cover",onError:Q},null,40,Qe)])):(g(),v("div",Ye,[...e[9]||(e[9]=[i("i",{class:"fas fa-user text-gray-400"},null,-1)])])),i("div",Je,[i("div",null,[i("div",Oe,[i("span",null,S(s.name),1),s.is_guest?(g(),v("span",Xe,"Guest")):b("",!0),s.hasNotification?(g(),v("span",Ze," ! ")):b("",!0)]),i("div",es,S(s.mobile_number),1)])])]),i("div",ss,[i("div",ts,[s.is_guest&&!s.is_blocked?(g(),v("button",{key:0,onClick:U(r=>xe(s),["stop"]),class:"text-orange-500 text-xs hover:underline"}," Block ",8,as)):b("",!0),s.is_guest&&s.is_blocked?(g(),v("button",{key:1,onClick:U(r=>ye(s),["stop"]),class:"text-green-500 text-xs hover:underline"}," Unblock ",8,is)):b("",!0),!s.is_guest&&!s.is_blocked?(g(),v("button",{key:2,onClick:U(r=>Me(s),["stop"]),class:"text-orange-500 text-xs hover:underline"}," Block User ",8,os)):b("",!0),!s.is_guest&&s.is_blocked?(g(),v("button",{key:3,onClick:U(r=>Se(s),["stop"]),class:"text-green-500 text-xs hover:underline"}," Unblock User ",8,ns)):b("",!0),i("button",{onClick:U(r=>pe(s),["stop"]),class:"text-red-500 text-xs hover:underline"}," Delete Chat ",8,ls)])])])],10,Ve)}),128))]),i("div",rs,[a.value?(g(),v("div",ds,[i("div",us,[a.value.avatar_url?(g(),v("div",cs,[i("img",{src:a.value.avatar_url.startsWith("/storage")||a.value.avatar_url.startsWith("/assets")?a.value.avatar_url:`/storage/${a.value.avatar_url}`,alt:a.value.name,class:"w-full h-full object-cover border",onError:Q},null,40,gs)])):(g(),v("div",vs,[...e[10]||(e[10]=[i("i",{class:"fas fa-user text-gray-400"},null,-1)])])),i("div",null,[i("div",_s,[W(S(a.value.name)+" ",1),a.value.is_guest?(g(),v("span",hs,"Guest")):b("",!0),a.value.is_blocked?(g(),v("span",ms,"Blocked")):b("",!0)]),i("div",fs,S(a.value.mobile_number),1)])])])):b("",!0),a.value?(g(),v("div",{key:1,ref_key:"chatContainer",ref:E,class:"flex-1 overflow-y-auto p-3"},[(g(!0),v(Z,null,ee(h.value,s=>(g(),v("div",{key:s.id,class:V(["mb-3 flex",{"justify-end":s.sender_id===y(m).props.auth.user.id,"justify-start":s.sender_id!==y(m).props.auth.user.id}])},[i("div",{class:V(["flex items-start space-x-2 max-w-2xl",s.sender_id===y(m).props.auth.user.id?"flex-row-reverse space-x-reverse":""])},[s.sender_id===y(m).props.auth.user.id&&y(m).props.auth.user.avatar_url||s.sender_id!==y(m).props.auth.user.id&&a.value.avatar_url?(g(),v("div",ps,[i("img",{src:s.sender_id===y(m).props.auth.user.id?y(m).props.auth.user.avatar_url.startsWith("/storage")||y(m).props.auth.user.avatar_url.startsWith("/assets")?y(m).props.auth.user.avatar_url:`/storage/${y(m).props.auth.user.avatar_url}`:a.value.avatar_url.startsWith("/storage")||a.value.avatar_url.startsWith("/assets")?a.value.avatar_url:`/storage/${a.value.avatar_url}`,alt:s.sender_id===y(m).props.auth.user.id?"You":a.value.name,class:"w-full h-full object-cover",onError:Q},null,40,bs)])):(g(),v("div",ws,[...e[11]||(e[11]=[i("i",{class:"fas fa-user text-gray-400 text-xs"},null,-1)])])),i("div",{class:V(["rounded-lg p-3",s.sender_id===y(m).props.auth.user.id?"bg-purple-100":"bg-gray-100"])},[s.image_path?(g(),v("div",xs,[i("img",{src:s.image_path,alt:"chat image",class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:n=>ie(s.image_path,"image")},null,8,ys)])):b("",!0),s.video_path?(g(),v("div",ks,[i("video",{class:"w-32 h-32 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:n=>ie(s.video_path,"video")},[i("source",{src:s.video_path,type:"video/mp4"},null,8,Cs)],8,Ns),e[12]||(e[12]=i("div",{class:"absolute inset-0 flex items-center justify-center pointer-events-none"},[i("i",{class:"fas fa-play-circle text-white text-2xl opacity-80"})],-1))])):b("",!0),s.message?(g(),v("p",$s,S(s.message),1)):b("",!0)],2)],2)],2))),128))],512)):b("",!0),a.value?(g(),v("div",Ms,[a.value.is_blocked?(g(),v("div",Ss," This user is blocked. Unblock to send messages. ")):(g(),v("form",{key:1,onSubmit:U(te,["prevent"]),class:"flex space-x-2"},[i("input",{type:"file",ref_key:"imageInput",ref:B,class:"hidden",onChange:he,accept:"image/*"},null,544),i("button",{type:"button",onClick:e[1]||(e[1]=s=>t.$refs.imageInput.click()),class:"px-4 py-2 bg-white/20 backdrop-blur-sm rounded-lg hover:bg-white/30 transition-all duration-200 text-slate-700"},[...e[13]||(e[13]=[i("i",{class:"fas fa-image"},null,-1)])]),i("input",{type:"file",ref_key:"videoInput",ref:F,class:"hidden",onChange:me,accept:"video/mp4,video/x-matroska"},null,544),i("button",{type:"button",onClick:e[2]||(e[2]=s=>t.$refs.videoInput.click()),class:"px-4 py-2 bg-white/20 backdrop-blur-sm rounded-lg hover:bg-white/30 transition-all duration-200 text-slate-700"},[...e[14]||(e[14]=[i("i",{class:"fas fa-video"},null,-1)])]),re(i("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>G.value=s),type:"text",placeholder:"Type your message...",class:"flex-1 h-12 rounded-xl bg-white/50 border-0 focus:ring-2 focus:ring-cyan-400 text-slate-900 px-4 placeholder-slate-400 backdrop-blur-sm shadow-lg",onKeydown:Ae(U(te,["exact","prevent"]),["enter"])},null,40,Es),[[de,G.value]]),e[15]||(e[15]=i("button",{type:"submit",class:"px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg transition-all duration-300 transform hover:scale-[1.02] shadow-lg"}," Send ",-1))],32))])):(g(),v("div",Ds," Select a user to start chatting "))])])]),Y.value?(g(),v("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:oe},[i("div",Is,[i("button",{onClick:oe,class:"absolute -top-10 right-0 text-white text-2xl hover:text-gray-300"},[...e[16]||(e[16]=[i("i",{class:"fas fa-times"},null,-1)])]),z.value==="image"?(g(),v("img",{key:0,src:P.value,alt:"Full size image",class:"max-w-full max-h-screen object-contain"},null,8,Us)):b("",!0),z.value==="video"?(g(),v("video",{key:1,src:P.value,controls:"",autoplay:"",class:"max-w-full max-h-screen"},null,8,js)):b("",!0)])])):b("",!0),L.value?(g(),v("div",Gs,[i("div",{class:"bg-white p-6 rounded shadow-lg"},[e[17]||(e[17]=i("h3",{class:"text-lg font-semibold mb-4"},"Confirm Deletion",-1)),e[18]||(e[18]=i("p",null,"Are you sure you want to delete all chat history with this user?",-1)),i("div",{class:"mt-4 flex justify-end space-x-2"},[i("button",{onClick:be,class:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"},"Cancel"),i("button",{onClick:we,class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"},"Delete")])])])):b("",!0),J.value?(g(),v("div",As,[i("div",Ts,[i("div",{class:"flex justify-between items-center mb-4"},[e[20]||(e[20]=i("h3",{class:"text-lg font-semibold text-white"},"Blocked Guests",-1)),i("button",{onClick:Ne,class:"text-white/70 hover:text-white"},[...e[19]||(e[19]=[i("i",{class:"fas fa-times"},null,-1)])])]),I.value.length===0?(g(),v("div",Bs," No blocked guests ")):(g(),v("div",Fs,[(g(!0),v(Z,null,ee(I.value,s=>(g(),v("div",{key:s.id,class:"flex items-center justify-between p-3 bg-white/10 backdrop-blur-sm rounded-lg border border-white/20"},[i("div",null,[i("div",Ks,S(s.name),1),i("div",Ls,S(s.mobile_number),1),i("div",Ps,"Blocked: "+S($e(s.blocked_at)),1)]),i("button",{onClick:n=>Ce(s.session_id),class:"px-3 py-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded text-sm transform hover:scale-105 transition-all duration-200"}," Unblock ",8,zs)]))),128))]))])])):b("",!0)]),_:1}))}};export{qs as default};
